package com.yulun.controller.common;

import com.alibaba.fastjson.JSONObject;
import com.fh.controller.base.BaseController;
import com.fh.entity.Page;
import com.fh.util.*;
import com.xxgl.service.mng.ZxlbManager;
import com.yulun.service.*;
import com.yulun.service.impl.TrainrecoService;
import com.yulun.utils.TimeHandle;
import org.apache.commons.lang3.StringUtils;
import org.apache.http.HttpRequest;
import org.apache.http.HttpResponse;
import org.apache.poi.hssf.usermodel.HSSFRow;
import org.apache.poi.hssf.usermodel.HSSFSheet;
import org.apache.poi.hssf.usermodel.HSSFWorkbook;
import org.springframework.stereotype.Controller;
import org.springframework.web.bind.annotation.CrossOrigin;
import org.springframework.web.bind.annotation.RequestMapping;
import org.springframework.web.bind.annotation.RequestParam;
import org.springframework.web.bind.annotation.ResponseBody;
import org.springframework.web.multipart.MultipartFile;

import javax.annotation.Resource;
import javax.servlet.http.HttpServletRequest;
import javax.servlet.http.HttpServletResponse;
import java.io.OutputStream;
import java.net.URLDecoder;
import java.text.ParseException;
import java.text.SimpleDateFormat;
import java.util.Date;
import java.util.List;
import java.util.UUID;


@Controller
@CrossOrigin(allowedHeaders = "*", allowCredentials = "true")
@RequestMapping(value = "/api")
public class ExcelController extends BaseController {

    @Resource(name = "commnoService")
    private CommnoManager commnoManager;

    @Resource(name = "vipInfoService")
    private VipInfoManager vipInfoManager;

    @Resource(name = "zxlbService")
    private ZxlbManager zxlbService;

    @Resource(name = "consumerService")
    private ConsumerManager consumerManager;

    @Resource(name = "jobReferService")
    private JobReferManager jobReferManager;

    @Resource(name = "msgTempService")
    private MsgTempManager msgTempManager;

    @Resource(name="trainInfoService")
    private TrainInfoManager trainInfoService;

    @Resource(name="otherServiceService")
    private OtherServiceManager otherServiceService;

    @Resource(name="otherPersonService")
    private OtherPersonManager otherPersonService;

    @Resource(name="policyService")
    private PolicyManager policyService;

    @Resource(name="signupService")
    private SignupManager signupService;

    @Resource(name="guideService")
    private GuideManager guideService;

    @Resource(name="emPersonService")
    private EmPersonManager emPersonService;
    @Resource(name="trainrecoService")
    private TrainrecoService trainrecoService;

    @Resource(name = "revrecordService")
    private RevrecordManager revrecordManager;



    /**
     * 导入用户信息到EXCEL
     *
     * @return
     * @throws Exception
     */
    @RequestMapping(value = "/app_readComExcel")
    @CrossOrigin(allowedHeaders = "*", allowCredentials = "true")
    @ResponseBody()
    public String readComExcel(@RequestParam(value = "files", required = false) MultipartFile file, HttpServletRequest request) throws Exception {
        PageData pd = new PageData();
        JSONObject json = new JSONObject();
        try {
            PageData pd_stoken = new PageData();
            pd_stoken.put("TOKENID", request.getParameter("tokenid"));
            System.out.println(request.getParameter("tokenid"));
            PageData pd_token = zxlbService.findByTokenId(pd_stoken);
            if (pd_token != null) {
                if (null != file && !file.isEmpty()) {
                    String filePath = PathUtil.getClasspath() + Const.FILEPATHFILE;                                //文件上传路径
                    String fileName = FileUpload.fileUp(file, filePath, "ComExcel");                            //执行上传
                    List<PageData> listPd = (List) ObjectExcelRead.readExcel(filePath, fileName, 2, 0, 0);        //执行读EXCEL操作,读出的数据导入List 2:从第3行开始；0:从第A列开始；0:第0个sheet
                    /*存入数据库操作======================================*/
                    for (int i = 0; i < listPd.size(); i++) {
                        pd.put("name", listPd.get(i).getString("var1"));
                        pd.put("phone", listPd.get(i).getString("var2"));
                        pd.put("age", listPd.get(i).getString("var3"));
                        pd.put("sex", listPd.get(i).getString("var4"));
                        pd.put("cardtype", listPd.get(i).getString("var5"));
                        pd.put("idcard", listPd.get(i).getString("var6"));
                        pd.put("address", listPd.get(i).getString("var7"));
                        commnoManager.insertCommon(pd);

                    }
                    json.put("success", "true");
                }

            } else {
                json.put("success", "false");
                json.put("msg", "登录超时，请重新登录");
            }
        } catch (Exception e) {
            json.put("success", "false");
        }
        return json.toString();
    }

    /**
     * 导入用户信息到EXCEL
     *
     * @return
     * @throws Exception
     */
    @RequestMapping(value = "/app_readVipExcel")
    @CrossOrigin(allowedHeaders = "*", allowCredentials = "true")
    @ResponseBody()
    public String readVipExcel(@RequestParam(value = "files", required = false) MultipartFile file, HttpServletRequest request) throws Exception {
        PageData pd = new PageData();
        JSONObject json = new JSONObject();
        try {
            PageData pd_stoken = new PageData();
            pd_stoken.put("TOKENID", request.getParameter("tokenid"));
            PageData pd_token = zxlbService.findByTokenId(pd_stoken);
            if (pd_token != null) {

                if (null != file && !file.isEmpty()) {
                    String filePath = PathUtil.getClasspath() + Const.FILEPATHFILE;                                //文件上传路径
                    String fileName = FileUpload.fileUp(file, filePath, "VipExcel");                            //执行上传
                    List<PageData> listPd = (List) ObjectExcelRead.readExcel(filePath, fileName, 2, 0, 0);        //执行读EXCEL操作,读出的数据导入List 2:从第3行开始；0:从第A列开始；0:第0个sheet
                    /*存入数据库操作======================================*/
                    for (int i = 0; i < listPd.size(); i++) {
                        pd.put("id", getUUID32());
                        pd.put("name", listPd.get(i).getString("var1"));
                        pd.put("sex", listPd.get(i).getString("var2"));
                        pd.put("idcard", listPd.get(i).getString("var3"));
                        pd.put("recepdep", listPd.get(i).getString("var4"));
                        pd.put("clevel", listPd.get(i).getString("var5"));
                        pd.put("birthday", listPd.get(i).getString("var6"));
                        pd.put("position", listPd.get(i).getString("var7"));
                        pd.put("place", listPd.get(i).getString("var8"));
                        pd.put("waiter", listPd.get(i).getString("var9"));
                        pd.put("isimport", listPd.get(i).getString("var10"));
                        pd.put("isusecard", listPd.get(i).getString("var11"));
                        pd.put("ortherinfo", listPd.get(i).getString("var12"));
                        pd.put("ctype", listPd.get(i).getString("var13"));
                        pd.put("favorite", listPd.get(i).getString("var14"));
                        pd.put("result", listPd.get(i).getString("var15"));
                        vipInfoManager.insertVipInfo(pd);

                    }
                    json.put("success", "true");
                }
            } else {
                json.put("success", "false");
                json.put("msg", "登录超时，请重新登录");
            }


        } catch (Exception e) {
            json.put("success", "false");
        }
        return json.toString();
    }

    @RequestMapping(value = "/downComExcel")
    @CrossOrigin(allowedHeaders = "*", allowCredentials = "true")
    @ResponseBody()
    public void downComExcel(HttpServletResponse response) throws Exception {
        FileDownload.fileDownload(response, PathUtil.getClasspath() + Const.FILEPATHFILE + "ComExcel.xls", "ComExcel.xls");
    }

    @RequestMapping(value = "/downVipExcel")
    @CrossOrigin(allowedHeaders = "*", allowCredentials = "true")
    @ResponseBody()
    public void downVipExcel(HttpServletResponse response) throws Exception {
        FileDownload.fileDownload(response, PathUtil.getClasspath() + Const.FILEPATHFILE + "VipExcel.xls", "VipExcel.xls");
    }

    public String getUUID32() {
        String uuid = UUID.randomUUID().toString();
        uuid = uuid.replace("-", "");
        return uuid;
    }


    /**
     * 导出到Excel
     */
    @RequestMapping("/app_exportComExcel")
    @CrossOrigin(allowedHeaders = "*", allowCredentials = "true")
    @ResponseBody()
    public String exportExcel(HttpServletResponse response, HttpServletRequest request) throws Exception {

        JSONObject json = new JSONObject();
        try {
            PageData pd_stoken = new PageData();
            pd_stoken.put("TOKENID", request.getParameter("tokenid"));
            PageData pd_token = zxlbService.findByTokenId(pd_stoken);
            if (pd_token != null) {
                PageData pd = new PageData();
                Page page = new Page();
                URLDecoder urlDecoder = new URLDecoder();
                String name = pd.getString("name");
                String phone = pd.getString("phone");
                String idcard = pd.getString("idcard");
                String type = pd.getString("type");
                String keywords = pd.getString("keywords");
                String pageIndex = pd.getString("pageIndex");
                String pageSize = pd.getString("pageSize");
                String name1 = name == null ? "" : urlDecoder.decode(name, "utf-8");
                String phone1 = name == null ? "" : urlDecoder.decode(phone, "utf-8");
                String idcard1 = name == null ? "" : urlDecoder.decode(idcard, "utf-8");
                String type1 = name == null ? "" : urlDecoder.decode(type, "utf-8");
                String keywords1 = name == null ? "" : urlDecoder.decode(keywords, "utf-8");
                String pageIndex1 = name == null ? "" : urlDecoder.decode(pageIndex, "utf-8");
                String pageSize1 = name == null ? "" : urlDecoder.decode(pageSize, "utf-8");
                pd.put("name", name1);
                pd.put("phone", phone1);
                pd.put("idcard", idcard1);
                pd.put("type", type1);
                pd.put("keywords", keywords1);
                pd.put("pageIndex", pageIndex1);
                pd.put("pageSize", pageSize1);
                page.setPd(pd);
                System.out.println(pd);
                List<PageData> clist = commnoManager.findAlllistPage(page);
                System.out.println(clist);
                if (clist.size() > 0) {
                    //创建excel文件
                    HSSFWorkbook wb = new HSSFWorkbook();
                    //创建sheet页
                    HSSFSheet sheet = wb.createSheet("普客信息记录");
                    //创建标题行
                    HSSFRow titleRow = sheet.createRow(0);
                    titleRow.createCell((short) 0).setCellValue("客户姓名");
                    titleRow.createCell((short) 1).setCellValue("客户电话");
                    titleRow.createCell((short) 2).setCellValue("年龄");
                    titleRow.createCell((short) 3).setCellValue("性别");
                    titleRow.createCell((short) 4).setCellValue("证件类型");
                    titleRow.createCell((short) 5).setCellValue("证件号码");
                    titleRow.createCell((short) 6).setCellValue("所在区域");
                    for (PageData pd1 : clist) {
                        HSSFRow dataRow = sheet.createRow(sheet.getLastRowNum() + 1);
                        dataRow.createCell((short) 0).setCellValue(pd1.getString("name"));
                        dataRow.createCell((short) 1).setCellValue(pd1.getString("phone"));
                        dataRow.createCell((short) 2).setCellValue(pd1.getString("age"));
                        dataRow.createCell((short) 3).setCellValue(pd1.getString("sex"));
                        dataRow.createCell((short) 4).setCellValue(pd1.getString("cardtype"));
                        dataRow.createCell((short) 5).setCellValue(pd1.getString("idcard"));
                        dataRow.createCell((short) 6).setCellValue(pd1.getString("address"));
                    }
                    // 设置下载时客户端Excel的名称
                    String filename = new SimpleDateFormat("yyyyMMdd").format(new Date()) + "-CUSTINFO.xls";
                    //设置下载的文件
                    System.out.println(filename);
                    response.setCharacterEncoding("UTF-8");
                    response.setContentType("application/vnd.ms-excel");
                    response.setHeader("Content-disposition", "attachment;filename=" + filename);
                    OutputStream ouputStream = response.getOutputStream();//打开流
                    wb.write(ouputStream); //在excel内写入流
                    ouputStream.flush();// 刷新流
                    ouputStream.close();// 关闭流
                }

            } else {
                json.put("success", "false");
                json.put("msg", "登录超时，请重新登录");
            }

        } catch (Exception e) {
            json.put("success", "false");
        }
        return json.toString();
    }

    @RequestMapping(value = "/exportgraduateExcel", produces = {"application/json;charset=UTF-8"})
    @CrossOrigin(allowedHeaders = "*", allowCredentials = "true")
    @ResponseBody()
    public String exportgraduateExcel(HttpServletResponse response, HttpServletRequest request) throws Exception {

        JSONObject json = new JSONObject();
        try {
            PageData pd_stoken = new PageData();
            pd_stoken.put("TOKENID", request.getParameter("tokenid"));
            PageData pd_token = zxlbService.findByTokenId(pd_stoken);
            if (pd_token != null) {
                PageData pd = new PageData();
                Page page = new Page();
                URLDecoder urlDecoder = new URLDecoder();
                String jobtype = pd.getString("jobtype");
                String starttime = pd.getString("starttime");
                String endtime = pd.getString("endtime");
                String pageIndex = "0";
                String pageSize = "999999999";
                String jobtype1 = jobtype == null ? "" : urlDecoder.decode(jobtype, "utf-8");
                String starttime1 = starttime == null ? "" : urlDecoder.decode(starttime, "utf-8");
                String endtime1 = endtime == null ? "" : urlDecoder.decode(endtime, "utf-8");

                String pageIndex1 = pageIndex == null ? "" : urlDecoder.decode(pageIndex, "utf-8");
                String pageSize1 = pageSize == null ? "" : urlDecoder.decode(pageSize, "utf-8");
                pd.put("jobtype", jobtype1);
                pd.put("starttime", starttime1);
                pd.put("endtime", endtime1);
                pd.put("pageIndex", pageIndex1);
                pd.put("pageSize", pageSize1);
                page.setPd(pd);
                System.out.println(pd);
                List<PageData> clist = consumerManager.findgraduate(pd);
                System.out.println(clist);

                //创建excel文件
                HSSFWorkbook wb = new HSSFWorkbook();
                //创建sheet页
                HSSFSheet sheet = wb.createSheet("高校毕业生");
                //创建标题行
                HSSFRow titleRow = sheet.createRow(0);
                titleRow.createCell((short) 0).setCellValue("报到时间");
                titleRow.createCell((short) 1).setCellValue("姓名");
                titleRow.createCell((short) 2).setCellValue("性别");
                titleRow.createCell((short) 3).setCellValue("身份证号码");
                titleRow.createCell((short) 4).setCellValue("毕业院校");
                titleRow.createCell((short) 5).setCellValue("毕业日期");
                titleRow.createCell((short) 6).setCellValue("学历");
                titleRow.createCell((short) 7).setCellValue("所学专业");
                titleRow.createCell((short) 8).setCellValue("入学前户口所在地");
                titleRow.createCell((short) 9).setCellValue("联系电话");
                titleRow.createCell((short) 10).setCellValue("应急联系电话");
                titleRow.createCell((short) 11).setCellValue("就业地意向");
                titleRow.createCell((short) 12).setCellValue("就业状态");
                titleRow.createCell((short) 13).setCellValue("就业单位");
                titleRow.createCell((short) 14).setCellValue("备注");
                if (clist.size() > 0) {



                    for (PageData pd1 : clist) {
                        HSSFRow dataRow = sheet.createRow(sheet.getLastRowNum() + 1);
                        dataRow.createCell((short) 0).setCellValue(pd1.getString("arrtime"));
                        dataRow.createCell((short) 1).setCellValue(pd1.getString("name"));
                        dataRow.createCell((short) 2).setCellValue(pd1.getString("sex"));
                        dataRow.createCell((short) 3).setCellValue(pd1.getString("cardid"));
                        dataRow.createCell((short) 4).setCellValue(pd1.getString("school"));
                        dataRow.createCell((short) 5).setCellValue(pd1.getString("gradate"));
                        dataRow.createCell((short) 6).setCellValue(pd1.getString("edubg"));
                        dataRow.createCell((short) 7).setCellValue(pd1.getString("major"));
                        dataRow.createCell((short) 8).setCellValue(pd1.getString("address"));
                        dataRow.createCell((short) 9).setCellValue(pd1.getString("lxtel"));
                        dataRow.createCell((short) 10).setCellValue(pd1.getString("extel"));
                        dataRow.createCell((short) 11).setCellValue(pd1.getString("jobadd"));
                        String jobtype2 = pd1.getString("jobtype");
                        if (jobtype2.equals("0")){
                            dataRow.createCell((short) 12).setCellValue("失业");
                        }else if (jobtype2.equals("1")){
                            dataRow.createCell((short) 12).setCellValue("就业");
                        }

                        dataRow.createCell((short) 13).setCellValue(pd1.getString("jobunit"));
                        dataRow.createCell((short) 14).setCellValue(pd1.getString("remark"));

                    }

                }
                // 设置下载时客户端Excel的名称
                String filename = new SimpleDateFormat("yyyyMMdd").format(new Date()) + "-gxbys.xls";
                //设置下载的文件
                System.out.println(filename);
                response.setCharacterEncoding("UTF-8");
                response.setContentType("application/vnd.ms-excel");
                response.setHeader("Content-disposition", "attachment;filename=" + filename);
                OutputStream ouputStream = response.getOutputStream();//打开流
                wb.write(ouputStream); //在excel内写入流
                ouputStream.flush();// 刷新流
                ouputStream.close();// 关闭流

            } else {
                json.put("success", "false");
                json.put("msg", "登录超时，请重新登录");
            }

        } catch (Exception e) {
            json.put("success", "false");
        }
        return json.toString();
    }

    @RequestMapping(value = "/readgraduateExcel", produces = {"application/json;charset=UTF-8"})
    @CrossOrigin(allowedHeaders = "*", allowCredentials = "true")
    @ResponseBody()
    public String readgraduateExcel(@RequestParam(value = "files", required = false) MultipartFile file, HttpServletRequest request) throws Exception {
        PageData pd = new PageData();
        JSONObject json = new JSONObject();
        try {
            PageData pd_stoken = new PageData();
            pd_stoken.put("TOKENID", request.getParameter("tokenid"));
            System.out.println(request.getParameter("tokenid"));
            PageData pd_token = zxlbService.findByTokenId(pd_stoken);
            String zxyh = pd_token.getString("zxyh");
            if (pd_token != null) {
                if (null != file && !file.isEmpty()) {
                    String filePath = PathUtil.getClasspath() + Const.FILEPATHFILE;                                //文件上传路径
                    String fileName = FileUpload.fileUp(file, filePath, "ComExcel");                            //执行上传
                    List<PageData> listPd = (List) ObjectExcelRead2.readExcel(filePath, fileName, 1, 0, 0);        //执行读EXCEL操作,读出的数据导入List 2:从第3行开始；0:从第A列开始；0:第0个sheet
                    /*检查字段操作======================================*/
                    boolean check = true;
                    String str = "";
//                    for (int i = 0; i < listPd.size(); i++) {
//                        String var0 = listPd.get(i).getString("var0").trim();
//
//                        String var14 = listPd.get(i).getString("var14").trim();
//                        if (!var0.equals("报到时间")) {
//                            check = false;
//                            str = str + "模板格式错误";
//                            break;
//                        }
//                        if (!var14.equals("备注")){
//                            check = false;
//                            str = str + "模板格式错误";
//                            break;
//                        }
//                        System.out.println(var0);
//                        System.out.println(var14);
//                    }
                    for (int i = 0; i < listPd.size(); i++) {
                        String var0 = listPd.get(i).getString("var0");
                        String var1 = listPd.get(i).getString("var1");
                        String var3 = listPd.get(i).getString("var3");
                        String var9 = listPd.get(i).getString("var9");
                        String var10 = listPd.get(i).getString("var10");
                        String var12 = listPd.get(i).getString("var12");
                        System.out.println(var0);
                        if (var0.equals("")) {
                            check = false;
                            str = str + "报到时间不能为空;";
                            break;
                        } else if (var1.equals("")) {
                            check = false;
                            str = str + "姓名不能为空;";
                            break;
                        } else if (var3.equals("")) {
                            check = false;
                            str = str + "身份证号码不能为空;";
                            break;
                        } else if (var9.equals("")) {
                            check = false;
                            str = str + "联系电话不能为空;";
                            break;
                        } else if (var10.equals("")) {
                            check = false;
                            str = str + "应急联系电话不能为空;";
                            break;
                        } else if (var12.equals("")) {
                            check = false;
                            str = str + "就业状态不能为空;";
                            break;
                        }
//                        PageData pd1 = new PageData();
//                        pd1.put("name",var12);
//                        PageData dic = consumerManager.getDIC(pd1);
//                        if (dic==null){
//                            str = str + "无此就业状态;";
//                            check = false;
//                            break;
//                        }

                    }
                    /*存入数据库操作======================================*/

                    if (check == true) {
                        for (int i = 0; i < listPd.size(); i++) {
                            pd.put("arrtime", listPd.get(i).getString("var0"));
                            pd.put("name", listPd.get(i).getString("var1"));
                            pd.put("sex", listPd.get(i).getString("var2"));
                            pd.put("cardid", listPd.get(i).getString("var3"));
                            pd.put("school", listPd.get(i).getString("var4"));
                            pd.put("gradate", listPd.get(i).getString("var5"));
                            pd.put("edubg", listPd.get(i).getString("var6"));
                            pd.put("major", listPd.get(i).getString("var7"));
                            pd.put("addr", listPd.get(i).getString("var8"));
                            pd.put("tel", listPd.get(i).getString("var9"));
                            pd.put("lxtel", listPd.get(i).getString("var9"));
                            pd.put("extel", listPd.get(i).getString("var10"));
                            pd.put("jobadd", listPd.get(i).getString("var11"));
                            String var12 = listPd.get(i).getString("var12");
                            if (var12.equals("就业")){
                                pd.put("jobtype", "1");
                            }else if(var12.equals("失业")){
                                pd.put("jobtype", "0");
                            }
//                            PageData pd1 = new PageData();
//                            pd1.put("name",var12);
//                            PageData dic = consumerManager.getDIC(pd1);
//                            if (dic!=null){
//                                pd.put("jobtype", dic.getString("DICTIONARIES_ID"));
//                            }else {
//                                str = str + "无此就业状态;";
//                                json.put("msg", str);
//                                break;
//                            }
                            pd.put("jobunit", listPd.get(i).getString("var13"));
                            pd.put("remark", listPd.get(i).getString("var14"));
                            pd.put("isimpot", '1');
                            pd.put("cate","7c2896ad53df4440b81c251231b196fd");
                            pd.put("czdate", getTime());
                            pd.put("czman", zxyh);
                            pd.put("uid", getUUID32());

//                            consumerManager.insertgraduate(pd);
                            consumerManager.savegraduate(pd);
                            consumerManager.savePerson(pd);
                        }
                        json.put("success", "true");
                    } else if (check == false) {
                        json.put("msg", str);
                    }
                }

            } else {
                json.put("success", "false");
                json.put("msg", "登录超时，请重新登录");
            }
        } catch (Exception e) {
            json.put("success", "false");
        }
        return json.toString();
    }

    @RequestMapping(value = "/exportpovertyExcel", produces = {"application/json;charset=UTF-8"})
    @CrossOrigin(allowedHeaders = "*", allowCredentials = "true")
    @ResponseBody()
    public String exportpovertyExcel(HttpServletResponse response, HttpServletRequest request) throws Exception {

        JSONObject json = new JSONObject();
        try {
            PageData pd_stoken = new PageData();
            pd_stoken.put("TOKENID", request.getParameter("tokenid"));
            PageData pd_token = zxlbService.findByTokenId(pd_stoken);
            if (pd_token != null) {
                PageData pd = new PageData();
                Page page = new Page();
                URLDecoder urlDecoder = new URLDecoder();
                String starttime = pd.getString("starttime");
                String endtime = pd.getString("endtime");
                String pageIndex = "0";
                String pageSize = "999999999";
                String starttime1 = starttime == null ? "" : urlDecoder.decode(starttime, "utf-8");
                String endtime1 = endtime == null ? "" : urlDecoder.decode(endtime, "utf-8");
                String pageIndex1 = pageIndex == null ? "" : urlDecoder.decode(pageIndex, "utf-8");
                String pageSize1 = pageSize == null ? "" : urlDecoder.decode(pageSize, "utf-8");
                pd.put("starttime", starttime1);
                pd.put("endtime", endtime1);
                pd.put("pageIndex", pageIndex1);
                pd.put("pageSize", pageSize1);
                page.setPd(pd);
                System.out.println(pd);
                List<PageData> clist = consumerManager.findpoverty(pd);
                System.out.println(clist);
                //创建excel文件
                HSSFWorkbook wb = new HSSFWorkbook();
                //创建sheet页
                HSSFSheet sheet = wb.createSheet("建档立卡贫困人员");
                //创建标题行
                HSSFRow titleRow = sheet.createRow(0);
                titleRow.createCell((short) 0).setCellValue("入库时间");
                titleRow.createCell((short) 1).setCellValue("姓名");
                titleRow.createCell((short) 2).setCellValue("联系电话");
                titleRow.createCell((short) 3).setCellValue("备注");
                if (clist.size() > 0) {

                    for (PageData pd1 : clist) {
                        HSSFRow dataRow = sheet.createRow(sheet.getLastRowNum() + 1);
                        dataRow.createCell((short) 0).setCellValue(pd1.getString("cztime"));
                        dataRow.createCell((short) 1).setCellValue(pd1.getString("name"));
                        dataRow.createCell((short) 2).setCellValue(pd1.getString("tel"));
                        dataRow.createCell((short) 3).setCellValue(pd1.getString("remark"));
                    }

                }
                // 设置下载时客户端Excel的名称
                String filename = new SimpleDateFormat("yyyyMMdd").format(new Date()) + "-jdlkry.xls";
                //设置下载的文件
                System.out.println(filename);
                response.setCharacterEncoding("UTF-8");
                response.setContentType("application/vnd.ms-excel");
                response.setHeader("Content-disposition", "attachment;filename=" + filename);
                OutputStream ouputStream = response.getOutputStream();//打开流
                wb.write(ouputStream); //在excel内写入流
                ouputStream.flush();// 刷新流
                ouputStream.close();// 关闭流

            } else {
                json.put("success", "false");
                json.put("msg", "登录超时，请重新登录");
            }

        } catch (Exception e) {
            json.put("success", "false");
        }
        return json.toString();
    }

    @RequestMapping(value = "/readpovertyExcel", produces = {"application/json;charset=UTF-8"})
    @CrossOrigin(allowedHeaders = "*", allowCredentials = "true")
    @ResponseBody()
    public String readpovertyExcel(@RequestParam(value = "files", required = false) MultipartFile file, HttpServletRequest request) throws Exception {
        PageData pd = new PageData();
        JSONObject json = new JSONObject();
        try {
            PageData pd_stoken = new PageData();
            pd_stoken.put("TOKENID", request.getParameter("tokenid"));
            System.out.println(request.getParameter("tokenid"));
            PageData pd_token = zxlbService.findByTokenId(pd_stoken);
            String zxyh = pd_stoken.getString("zxyh");
            if (pd_token != null) {
                if (null != file && !file.isEmpty()) {
                    String filePath = PathUtil.getClasspath() + Const.FILEPATHFILE;                                //文件上传路径
                    String fileName = FileUpload.fileUp(file, filePath, "ComExcel");                            //执行上传
                    List<PageData> listPd = (List) ObjectExcelRead2.readExcel(filePath, fileName, 1, 0, 0);        //执行读EXCEL操作,读出的数据导入List 2:从第3行开始；0:从第A列开始；0:第0个sheet

                    /*检查字段操作======================================*/
                    boolean check = true;
                    String str = "";
//                    for (int i = 0; i < listPd.size(); i++) {
//                        String var0 = listPd.get(i).getString("var0");
//                        String var2 = listPd.get(i).getString("var2");
//                        if (!var0.equals("姓名")) {
//                            check = false;
//                            str = str + "模板格式错误";
//                            break;
//                        }
//                        if (!var2.equals("备注")) {
//                            check = false;
//                            str = str + "模板格式错误";
//                            break;
//                        }
//                    }
                    for (int i = 0; i < listPd.size(); i++) {
                        String var0 = listPd.get(i).getString("var0");
                        String var1 = listPd.get(i).getString("var1");
                        if ("".equals(var0)) {
                            check = false;
                            str = str + "姓名不能为空;";
                            break;
                        } else if ("".equals(var1)) {
                            check = false;
                            str = str + "联系方式不能为空;";
                            break;
                        }
                    }

                    /*存入数据库操作======================================*/
                    if (check == true) {
                        for (int i = 0; i < listPd.size(); i++) {
                            pd.put("cztime", getTime());
                            pd.put("name", listPd.get(i).getString("var0"));
                            pd.put("tel", listPd.get(i).getString("var1"));
                            pd.put("lxtel", listPd.get(i).getString("var1"));
                            pd.put("remark", listPd.get(i).getString("var2"));
                            pd.put("cate", "a6d55a9451534e14aefd082634f78ad9");
                            pd.put("czman", zxyh);
                            pd.put("uid", getUUID32());
                            pd.put("isimpot", "1");
//                            consumerManager.insertpoverty(pd);
                            consumerManager.savePerson(pd);
                        }
                        json.put("success", "true");
                    } else if (check == false) {
                        json.put("msg", str);
                    }

                }

            } else {
                json.put("success", "false");
                json.put("msg", "登录超时，请重新登录");
            }
        } catch (Exception e) {
            json.put("success", "false");
        }
        return json.toString();
    }

    @RequestMapping(value = "/exportsbbtryExcel", produces = {"application/json;charset=UTF-8"})
    @CrossOrigin(allowedHeaders = "*", allowCredentials = "true")
    @ResponseBody()
    public String exportsbbtryExcel(HttpServletResponse response, HttpServletRequest request) throws Exception {

        JSONObject json = new JSONObject();
        try {
            PageData pd_stoken = new PageData();
            pd_stoken.put("TOKENID", request.getParameter("tokenid"));
            PageData pd_token = zxlbService.findByTokenId(pd_stoken);
            if (pd_token != null) {
                PageData pd = new PageData();
                Page page = new Page();
                URLDecoder urlDecoder = new URLDecoder();
                String starttime = pd.getString("starttime");
                String endtime = pd.getString("endtime");
                String pageIndex = "0";
                String pageSize = "999999999";
                String starttime1 = starttime == null ? "" : urlDecoder.decode(starttime, "utf-8");
                String endtime1 = endtime == null ? "" : urlDecoder.decode(endtime, "utf-8");
                String pageIndex1 = pageIndex == null ? "" : urlDecoder.decode(pageIndex, "utf-8");
                String pageSize1 = pageSize == null ? "" : urlDecoder.decode(pageSize, "utf-8");
                pd.put("starttime", starttime1);
                pd.put("endtime", endtime1);
                pd.put("pageIndex", pageIndex1);
                pd.put("pageSize", pageSize1);
                page.setPd(pd);
                System.out.println(pd);
                List<PageData> clist = consumerManager.findsbbtry(pd);
                System.out.println(clist);
                //创建excel文件
                HSSFWorkbook wb = new HSSFWorkbook();
                //创建sheet页
                HSSFSheet sheet = wb.createSheet("社保补贴人员");
                //创建标题行
                HSSFRow titleRow = sheet.createRow(0);
                titleRow.createCell((short) 0).setCellValue("入库时间");
                titleRow.createCell((short) 1).setCellValue("姓名");
                titleRow.createCell((short) 2).setCellValue("联系电话");
                titleRow.createCell((short) 3).setCellValue("备注");

                if (clist.size() > 0) {


                    for (PageData pd1 : clist) {
                        HSSFRow dataRow = sheet.createRow(sheet.getLastRowNum() + 1);
                        dataRow.createCell((short) 0).setCellValue(pd1.getString("cztime"));
                        dataRow.createCell((short) 1).setCellValue(pd1.getString("name"));
                        dataRow.createCell((short) 2).setCellValue(pd1.getString("tel"));
                        dataRow.createCell((short) 3).setCellValue(pd1.getString("remark"));
                    }

                }
                // 设置下载时客户端Excel的名称
                String filename = new SimpleDateFormat("yyyyMMdd").format(new Date()) + "-sbbtry.xls";
                //设置下载的文件
                System.out.println(filename);
                response.setCharacterEncoding("UTF-8");
                response.setContentType("application/vnd.ms-excel");
                response.setHeader("Content-disposition", "attachment;filename=" + filename);
                OutputStream ouputStream = response.getOutputStream();//打开流
                wb.write(ouputStream); //在excel内写入流
                ouputStream.flush();// 刷新流
                ouputStream.close();// 关闭流

            } else {
                json.put("success", "false");
                json.put("msg", "登录超时，请重新登录");
            }

        } catch (Exception e) {
            json.put("success", "false");
        }
        return json.toString();
    }

    @RequestMapping(value = "/readsbbtryExcel", produces = {"application/json;charset=UTF-8"})
    @CrossOrigin(allowedHeaders = "*", allowCredentials = "true")
    @ResponseBody()
    public String readsbbtryExcel(@RequestParam(value = "files", required = false) MultipartFile file, HttpServletRequest request) throws Exception {
        PageData pd = new PageData();
        JSONObject json = new JSONObject();
        try {
            PageData pd_stoken = new PageData();
            pd_stoken.put("TOKENID", request.getParameter("tokenid"));
            System.out.println(request.getParameter("tokenid"));
            PageData pd_token = zxlbService.findByTokenId(pd_stoken);
            String zxyh = pd_token.getString("zxyh");
            if (pd_token != null) {
                if (null != file && !file.isEmpty()) {
                    String filePath = PathUtil.getClasspath() + Const.FILEPATHFILE;                                //文件上传路径
                    String fileName = FileUpload.fileUp(file, filePath, "ComExcel");                            //执行上传
                    List<PageData> listPd = (List) ObjectExcelRead2.readExcel(filePath, fileName, 1, 0, 0);        //执行读EXCEL操作,读出的数据导入List 2:从第3行开始；0:从第A列开始；0:第0个sheet
                    /*检查字段操作======================================*/
                    boolean check = true;
                    String str = "";
//                    for (int i = 0; i < listPd.size(); i++) {
//                        String var0 = listPd.get(i).getString("var0");
//                        String var2 = listPd.get(i).getString("var2");
//                        if (!var0.equals("姓名")) {
//                            check = false;
//                            str = str + "模板格式错误";
//                            break;
//                        }
//                        if (!var2.equals("备注")) {
//                            check = false;
//                            str = str + "模板格式错误";
//                            break;
//                        }
//                    }
                    for (int i = 0; i < listPd.size(); i++) {
                        String var0 = listPd.get(i).getString("var0");
                        String var1 = listPd.get(i).getString("var1");
                        if ("".equals(var0) || var0 == null) {
                            check = false;
                            str = str + "姓名不能为空;";
                            break;
                        } else if ("".equals(var1) || var1 == null) {
                            check = false;
                            str = str + "联系电话不能为空;";
                            break;
                        }

                    }
                    /*存入数据库操作======================================*/
                    if (check == true) {
                        for (int i = 0; i < listPd.size(); i++) {
                            pd.put("cztime", getTime());
                            pd.put("name", listPd.get(i).getString("var0"));
                            pd.put("tel", listPd.get(i).getString("var1"));
                            pd.put("remark", listPd.get(i).getString("var2"));
                            pd.put("cate", "54acc890c8bc433ca53dc19b06d71857");
                            pd.put("czman", zxyh);
                            pd.put("uid", getUUID32());
                            pd.put("isimpot", "1");
                            consumerManager.savePerson(pd);
                        }
                        json.put("success", "true");
                    } else if (check == false) {
                        json.put("msg", str);
                    }

                }

            } else {
                json.put("success", "false");
                json.put("msg", "登录超时，请重新登录");
            }
        } catch (Exception e) {
            json.put("success", "false");
        }
        return json.toString();
    }

    @RequestMapping(value = "/exportjzbtryExcel", produces = {"application/json;charset=UTF-8"})
    @CrossOrigin(allowedHeaders = "*", allowCredentials = "true")
    @ResponseBody()
    public String exportjzbtryExcel(HttpServletResponse response, HttpServletRequest request) throws Exception {

        JSONObject json = new JSONObject();
        try {
            PageData pd_stoken = new PageData();
            pd_stoken.put("TOKENID", request.getParameter("tokenid"));
            PageData pd_token = zxlbService.findByTokenId(pd_stoken);
            if (pd_token != null) {
                PageData pd = new PageData();
                Page page = new Page();
                URLDecoder urlDecoder = new URLDecoder();
                String starttime = pd.getString("starttime");
                String endtime = pd.getString("endtime");
                String level = pd.getString("level");
                String pageIndex = "0";
                String pageSize = "999999999";
                String starttime1 = starttime == null ? "" : urlDecoder.decode(starttime, "utf-8");
                String endtime1 = endtime == null ? "" : urlDecoder.decode(endtime, "utf-8");
                String level1 = level == null ? "" : urlDecoder.decode(level, "utf-8");
                String pageIndex1 = pageIndex == null ? "" : urlDecoder.decode(pageIndex, "utf-8");
                String pageSize1 = pageSize == null ? "" : urlDecoder.decode(pageSize, "utf-8");
                pd.put("starttime", starttime1);
                pd.put("endtime", endtime1);
                pd.put("level", level1);
                pd.put("pageIndex", pageIndex1);
                pd.put("pageSize", pageSize1);
                page.setPd(pd);
                System.out.println(pd);
                List<PageData> clist = consumerManager.findjzbtry(pd);
                System.out.println(clist);

                //创建excel文件
                HSSFWorkbook wb = new HSSFWorkbook();
                //创建sheet页
                HSSFSheet sheet = wb.createSheet("见证补贴人员");
                //创建标题行
                HSSFRow titleRow = sheet.createRow(0);
                titleRow.createCell((short) 0).setCellValue("入库时间");
                titleRow.createCell((short) 1).setCellValue("姓名");
                titleRow.createCell((short) 2).setCellValue("身份证号码");
                titleRow.createCell((short) 3).setCellValue("工种");
                titleRow.createCell((short) 4).setCellValue("证书");
                titleRow.createCell((short) 5).setCellValue("等级");
                titleRow.createCell((short) 6).setCellValue("联系电话");
                titleRow.createCell((short) 7).setCellValue("所属地区");
                titleRow.createCell((short) 8).setCellValue("备注");
                if (clist.size() > 0) {


                    for (PageData pd1 : clist) {
                        HSSFRow dataRow = sheet.createRow(sheet.getLastRowNum() + 1);
                        dataRow.createCell((short) 0).setCellValue(pd1.getString("cztime"));
                        dataRow.createCell((short) 1).setCellValue(pd1.getString("name"));
                        dataRow.createCell((short) 2).setCellValue(pd1.getString("cardid"));
                        dataRow.createCell((short) 3).setCellValue(pd1.getString("gwflname"));
                        dataRow.createCell((short) 4).setCellValue(pd1.getString("credenname"));
                        dataRow.createCell((short) 5).setCellValue(pd1.getString("levelname"));
                        dataRow.createCell((short) 6).setCellValue(pd1.getString("tel"));
                        dataRow.createCell((short) 7).setCellValue(pd1.getString("address"));
                        dataRow.createCell((short) 8).setCellValue(pd1.getString("remark"));

                    }

                }
                // 设置下载时客户端Excel的名称
                String filename = new SimpleDateFormat("yyyyMMdd").format(new Date()) + "-jzbtry.xls";
                //设置下载的文件
                System.out.println(filename);
                response.setCharacterEncoding("UTF-8");
                response.setContentType("application/vnd.ms-excel");
                response.setHeader("Content-disposition", "attachment;filename=" + filename);
                OutputStream ouputStream = response.getOutputStream();//打开流
                wb.write(ouputStream); //在excel内写入流
                ouputStream.flush();// 刷新流
                ouputStream.close();// 关闭流

            } else {
                json.put("success", "false");
                json.put("msg", "登录超时，请重新登录");
            }

        } catch (Exception e) {
            json.put("success", "false");
        }
        return json.toString();
    }

    @RequestMapping(value = "/readjzbtryExcel", produces = {"application/json;charset=UTF-8"})
    @CrossOrigin(allowedHeaders = "*", allowCredentials = "true")
    @ResponseBody()
    public String readjzbtryExcel(@RequestParam(value = "files", required = false) MultipartFile file, HttpServletRequest request) throws Exception {
        PageData pd = new PageData();
        JSONObject json = new JSONObject();
        try {
            PageData pd_stoken = new PageData();
            pd_stoken.put("TOKENID", request.getParameter("tokenid"));
            System.out.println(request.getParameter("tokenid"));
            PageData pd_token = zxlbService.findByTokenId(pd_stoken);
            String zxyh = pd_token.getString("zxyh");
            if (pd_token != null) {
                if (null != file && !file.isEmpty()) {
                    String filePath = PathUtil.getClasspath() + Const.FILEPATHFILE;                                //文件上传路径
                    String fileName = FileUpload.fileUp(file, filePath, "ComExcel");                            //执行上传
                    List<PageData> listPd = (List) ObjectExcelRead2.readExcel(filePath, fileName, 1, 0, 0);        //执行读EXCEL操作,读出的数据导入List 2:从第3行开始；0:从第A列开始；0:第0个sheet
                    /*检查字段操作======================================*/
                    boolean check = true;
                    String str = "";
//                    for (int i = 0; i < listPd.size(); i++) {
//                        String var0 = listPd.get(i).getString("var0");
//                        String var8 = listPd.get(i).getString("var8");
//                        if (!var0.equals("入库时间")) {
//                            check = false;
//                            str = str + "模板格式错误";
//                            break;
//                        }
//                        if (!var8.equals("备注")) {
//                            check = false;
//                            str = str + "模板格式错误";
//                            break;
//                        }
//                    }
                    for (int i = 0; i < listPd.size(); i++) {
                        String var0 = listPd.get(i).getString("var0");
                        String var1 = listPd.get(i).getString("var1");
                        String var3 = listPd.get(i).getString("var3");
                        String var4 = listPd.get(i).getString("var4");
                        if ("".equals(var0) || var0 == null) {
                            check = false;
                            str = str + "姓名不能为空;";
                            break;
                        } else if ("".equals(var1) || var1 == null) {
                            check = false;
                            str = str + "身份证号码不能为空;";
                            break;
                        } else if ("".equals(var3) || var3 == null) {
                            check = false;
                            str = str + "证书不能为空;";
                            break;
                        } else if ("".equals(var4) || var4 == null) {
                            check = false;
                            str = str + "等级不能为空;";
                            break;
                        }

                        PageData pd1 = new PageData();
                        pd1.put("name",var3);
                        pd1.put("level","031-___");
                        PageData dic = consumerManager.getDIC(pd1);
                        System.out.println(dic);
                        if (dic==null){
                            str = str + "查无此证书;";
                            check = false;
                            break;
                        }
                        PageData pd2 = new PageData();
                        pd2.put("name",var4);
                        pd2.put("level",dic.getString("BIANMA")+"-__");
                        PageData dic2 = consumerManager.getDIC(pd2);
                        if (dic2==null){
                            str = str + "查无此等级;";
                            check = false;
                            break;
                        }
                    }

                    /*存入数据库操作======================================*/
                    if (check == true) {
                        for (int i = 0; i < listPd.size(); i++) {
                            pd.put("cztime", getTime());
                            pd.put("name", listPd.get(i).getString("var0"));
                            pd.put("cardid", listPd.get(i).getString("var1"));
                            String var2 = listPd.get(i).getString("var2");
                            PageData pageData = new PageData();
                            pageData.put("name",var2);
                            PageData getjobtype = consumerManager.getDIC(pageData);
                            if (getjobtype!=null){
                                var2=getjobtype.get("DICTIONARIES_ID").toString();
                            }else {
                                var2="暂无";
                            }
                            pd.put("jobvar", var2);
                            String var3 = listPd.get(i).getString("var3");
                            PageData pd1 = new PageData();
                            pd1.put("name",var3);
                            pd1.put("level","031-___");
                            PageData dic = consumerManager.getDIC(pd1);
                            if (dic!=null){
                                pd.put("creden", dic.getString("DICTIONARIES_ID"));
                            }else {
                                str = str + "查无此证书;";
                                json.put("msg", str);
                                break;
                            }
                            String var4 = listPd.get(i).getString("var4");
                            PageData pd2 = new PageData();
                            pd2.put("level",dic.getString("BIANMA")+"-__");
                            pd2.put("name",var4);
                            PageData dic2 = consumerManager.getDIC(pd2);
                            if (dic2!=null){
                                pd.put("level", dic2.getString("DICTIONARIES_ID"));
                            }else {
                                str = str + "查无此等级;";
                                json.put("msg", str);
                                break;
                            }
                            pd.put("tel", listPd.get(i).getString("var5"));
                            pd.put("lxtel", listPd.get(i).getString("var5"));
                            pd.put("addr", listPd.get(i).getString("var6"));
                            pd.put("remark", listPd.get(i).getString("var7"));
                            pd.put("cate", "7b95e900ca3a4eee943cb3ca11e51fd1");
                            pd.put("czman", zxyh);
                            pd.put("uid", getUUID32());
                            pd.put("isimpot", "1");
//                            consumerManager.insertjzbtry(pd);
                            consumerManager.savePerson(pd);
                            trainrecoService.insertTrainreco(pd);
                        }
                        json.put("success", "true");
                    } else if (check == false) {
                        json.put("msg", str);
                    }

                }

            } else {
                json.put("success", "false");
                json.put("msg", "登录超时，请重新登录");
            }
        } catch (Exception e) {
            json.put("success", "false");
        }
        return json.toString();
    }

    @RequestMapping(value = "/exportcompanyExcel", produces = {"application/json;charset=UTF-8"})
    @CrossOrigin(allowedHeaders = "*", allowCredentials = "true")
    @ResponseBody()
    public String exportcompanyExcel(HttpServletResponse response, HttpServletRequest request) throws Exception {

        JSONObject json = new JSONObject();
        try {
            PageData pd_stoken = new PageData();
            pd_stoken.put("TOKENID", request.getParameter("tokenid"));
            PageData pd_token = zxlbService.findByTokenId(pd_stoken);
            if (pd_token != null) {
                PageData pd = new PageData();
                Page page = new Page();
                URLDecoder urlDecoder = new URLDecoder();
                String name = pd.getString("name");
                String qytype = pd.getString("qytype");
                String lxr = pd.getString("lxr");
                String lxtel = pd.getString("lxtel");
                String keywords = pd.getString("keywords");
                String pageIndex = "0";
                String pageSize = "999999999";
                String name1 = name == null ? "" : urlDecoder.decode(name, "utf-8");
                String qytype1 = qytype == null ? "" : urlDecoder.decode(qytype, "utf-8");
                String lxr1 = lxr == null ? "" : urlDecoder.decode(lxr, "utf-8");
                String lxtel1 = lxtel == null ? "" : urlDecoder.decode(lxtel, "utf-8");
                String keywords1 = keywords == null ? "" : urlDecoder.decode(keywords, "utf-8");

                String pageIndex1 = name == null ? "" : urlDecoder.decode(pageIndex, "utf-8");
                String pageSize1 = name == null ? "" : urlDecoder.decode(pageSize, "utf-8");
                pd.put("name", name1);
                pd.put("qytype", qytype1);
                pd.put("lxr", lxr1);
                pd.put("lxtel", lxtel1);
                pd.put("keywords", keywords1);

                pd.put("pageIndex", pageIndex1);
                pd.put("pageSize", pageSize1);
                page.setPd(pd);
                System.out.println(pd);
                List<PageData> clist = consumerManager.findcompany(pd);

                //创建excel文件
                HSSFWorkbook wb = new HSSFWorkbook();
                //创建sheet页
                HSSFSheet sheet = wb.createSheet("企业招聘信息");
                //创建标题行
                HSSFRow titleRow = sheet.createRow(0);
                titleRow.createCell((short) 0).setCellValue("企业编号");
                titleRow.createCell((short) 1).setCellValue("企业名称");
                titleRow.createCell((short) 2).setCellValue("企业类型");
                titleRow.createCell((short) 3).setCellValue("联系人");
                titleRow.createCell((short) 4).setCellValue("联系电话");
                titleRow.createCell((short) 5).setCellValue("备用联系人");
                titleRow.createCell((short) 6).setCellValue("备用联系电话");
                titleRow.createCell((short) 7).setCellValue("企业地址");
                titleRow.createCell((short) 8).setCellValue("企业邮箱");

                titleRow.createCell((short) 9).setCellValue("招聘工种");
                titleRow.createCell((short) 10).setCellValue("岗位性质");
                titleRow.createCell((short) 11).setCellValue("招工人数");
                titleRow.createCell((short) 12).setCellValue("岗位要求");
                titleRow.createCell((short) 13).setCellValue("学历要求");
                titleRow.createCell((short) 14).setCellValue("专业要求");
                titleRow.createCell((short) 15).setCellValue("性别要求");
                titleRow.createCell((short) 16).setCellValue("年龄要求");
                titleRow.createCell((short) 17).setCellValue("工资待遇");
                titleRow.createCell((short) 18).setCellValue("其他说明");
                if (clist.size() > 0) {


                    for (PageData pageData : clist) {
                        String uid = pageData.getString("uid");
                        PageData data = new PageData();
                        data.put("uid", uid);
                        List<PageData> employ = consumerManager.findemployreg(data);
                        List<PageData> company = consumerManager.findcompany(data);
                        for (PageData pd1 : employ) {
                            HSSFRow dataRow = sheet.createRow(sheet.getLastRowNum() + 1);
                            dataRow.createCell((short) 0).setCellValue(pd1.size());
                            dataRow.createCell((short) 1).setCellValue(company.get(0).getString("name"));
                            dataRow.createCell((short) 2).setCellValue(company.get(0).getString("qytypename"));
                            dataRow.createCell((short) 3).setCellValue(company.get(0).getString("lxr"));
                            dataRow.createCell((short) 4).setCellValue(company.get(0).getString("lxtel"));
                            dataRow.createCell((short) 5).setCellValue(company.get(0).getString("bylxr"));
                            dataRow.createCell((short) 6).setCellValue(company.get(0).getString("bylxtel"));
                            dataRow.createCell((short) 7).setCellValue(company.get(0).getString("addr"));
                            dataRow.createCell((short) 8).setCellValue(company.get(0).getString("email"));

                            dataRow.createCell((short) 9).setCellValue(pd1.getString("gwflname"));
                            dataRow.createCell((short) 10).setCellValue(pd1.getString("jobtypename"));
                            dataRow.createCell((short) 11).setCellValue(pd1.getString("zgrs"));
                            dataRow.createCell((short) 12).setCellValue(pd1.getString("gwyq"));
                            dataRow.createCell((short) 13).setCellValue(pd1.getString("xlname"));
                            dataRow.createCell((short) 14).setCellValue(pd1.getString("zyyq"));
                            String sex = pd1.getString("sex");
                            if(sex.equals("1")){
                                sex="男";
                            }else if (sex.equals("2")){
                                sex="女";
                            }else{
                                sex="";
                            }
                            dataRow.createCell((short) 15).setCellValue(sex);
                            dataRow.createCell((short) 16).setCellValue(pd1.getString("age"));
                            dataRow.createCell((short) 17).setCellValue(pd1.getString("gzdyname"));
                            dataRow.createCell((short) 18).setCellValue(pd1.getString("remark"));

                        }
                    }


                }
                // 设置下载时客户端Excel的名称
                String filename = new SimpleDateFormat("yyyyMMdd").format(new Date()) + "-company.xls";
                //设置下载的文件
                System.out.println(filename);
                response.setCharacterEncoding("UTF-8");
                response.setContentType("application/vnd.ms-excel");
                response.setHeader("Content-disposition", "attachment;filename=" + filename);
                OutputStream ouputStream = response.getOutputStream();//打开流
                wb.write(ouputStream); //在excel内写入流
                ouputStream.flush();// 刷新流
                ouputStream.close();// 关闭流

            } else {
                json.put("success", "false");
                json.put("msg", "登录超时，请重新登录");
            }

        } catch (Exception e) {
            json.put("success", "false");
        }
        return json.toString();
    }

    @RequestMapping(value = "/readcompanyExcel", produces = {"application/json;charset=UTF-8"})
    @CrossOrigin(allowedHeaders = "*", allowCredentials = "true")
    @ResponseBody()
    public String readcompanyExcel(@RequestParam(value = "files", required = false) MultipartFile file, HttpServletRequest request) throws Exception {
        PageData pd = new PageData();
        JSONObject json = new JSONObject();
//        try {
        PageData pd_stoken = new PageData();
        pd_stoken.put("TOKENID", request.getParameter("tokenid"));
        System.out.println(request.getParameter("tokenid"));
        PageData pd_token = zxlbService.findByTokenId(pd_stoken);
        String czman = pd_stoken.getString("ZXYH");
        if (pd_token != null) {
            System.out.println(file);
            if (null != file && !file.isEmpty()) {
                String filePath = PathUtil.getClasspath() + Const.FILEPATHFILE;                                //文件上传路径
                String fileName = FileUpload.fileUp(file, filePath, "ComExcel");                            //执行上传
                List<PageData> listPd = (List) ObjectExcelRead2.readExcel(filePath, fileName, 1, 0, 0);        //执行读EXCEL操作,读出的数据导入List 2:从第3行开始；0:从第A列开始；0:第0个sheet
                /*检查字段操作======================================*/
                boolean check = true;
                String str = "";

                for (int i = 0; i < listPd.size(); i++) {
                    String var1 = listPd.get(i).getString("var1");
                    String var3 = listPd.get(i).getString("var3");
                    String var4 = listPd.get(i).getString("var4");
                    String var9 = listPd.get(i).getString("var9");
                    String var16 = listPd.get(i).getString("var16");
                    if ("".equals(var1) || var1 == null) {
                        check = false;
                        str = str + "企业名称不能为空;";
                        break;
                    } else if ("".equals(var3) || var3 == null) {
                        check = false;
                        str = str + "联系人不能为空;";
                        break;
                    } else if ("".equals(var4) || var4 == null) {
                        check = false;
                        str = str + "联系电话不能为空;";
                        break;
                    } else if ("".equals(var9) || var9 == null) {
                        check = false;
                        str = str + "招聘工种不能为空;";
                        break;
                    } else if (var16.equals("") ) {
                        check = false;
                        str = str + "年龄不能为空;";
                        break;
                    }
//                        String var2 = listPd.get(i).getString("var2");
//                        PageData pd1 = new PageData();
//                        pd1.put("name",var2);
//                        PageData dic = consumerManager.getDIC(pd1);
//                        if (dic==null){
//                            str = str + "查无此企业类型;";
//                            check = false;
//                            break;
//                        }
//
//                        String var10 = listPd.get(i).getString("var10");
//                        PageData pd2 = new PageData();
//                        pd2.put("name",var10);
//                        System.out.println(var10);
//                        PageData dic3 = consumerManager.getDIC(pd2);
//                        if (dic3==null){
//                            str = str + "查无此岗位性质;";
//                            check = false;
//                            break;
//                        }
//
//                        PageData pd3 = new PageData();
//                        pd3.put("gwflname",var9);
//
//                        PageData getjobtype = consumerManager.getjobtype(pd3);
//                        if (getjobtype==null) {
//                            str = str + "查无此岗位工种;";
//                            check = false;
//                            break;
//                        }
//                        String var13 = listPd.get(i).getString("var13");
//                        PageData pd4 = new PageData();
//                        pd4.put("name",var13);
//                        PageData dic4 = consumerManager.getDIC(pd4);
//                        if (dic4==null) {
//                            str = str + "查无此学历;";
//                            check = false;
//                            break;
//                        }
//                        String var17 = listPd.get(i).getString("var17");
//                        PageData pd5 = new PageData();
//                        pd5.put("name",var17);
//                        PageData dic5 = consumerManager.getDIC(pd5);
//                        if (dic5==null) {
//                            str = str + "查无此工资待遇;";
//                            check = false;
//                            break;
//                        }

                }

                if (check == true) {
                    System.out.println("执行了2");

                    /*存入数据库操作======================================*/
                    for (int i = 0; i < listPd.size(); i++) {
                        PageData pageData = new PageData();
                        String var4 = listPd.get(i).getString("var4").trim();
                        String var1 = listPd.get(i).getString("var1").trim();
                        pageData.put("tel", var4);
                        pageData.put("name", var1);
                        List<PageData> findcompany = consumerManager.findcompany(pageData);
                        System.out.println(findcompany);

                        if (findcompany.isEmpty() ) {
                            PageData data1 = new PageData();
                            data1.put("uid", this.getUUID32());
                            data1.put("name", listPd.get(i).getString("var1"));

                            String var2 = listPd.get(i).getString("var2");
                            PageData pd1 = new PageData();
                            pd1.put("name",var2);
                            PageData dic = consumerManager.getDIC(pd1);
                            if (dic!=null){
                                data1.put("qytype", dic.getString("DICTIONARIES_ID"));
                            }else {
//                                    str = str + "查无此企业类型;";
//                                    json.put("msg", str);
//                                    break;
                                data1.put("qytype", "暂无");
                            }
                            data1.put("lxr", listPd.get(i).getString("var3"));
                            data1.put("tel", listPd.get(i).getString("var4"));
                            data1.put("lxtel", listPd.get(i).getString("var4"));
                            data1.put("bylxr", listPd.get(i).getString("var5"));
                            data1.put("bylxtel", listPd.get(i).getString("var6"));
                            data1.put("addr", listPd.get(i).getString("var7"));
                            data1.put("email", listPd.get(i).getString("var8"));
                            data1.put("czman", czman);
                            data1.put("czdate", getTime());
                            data1.put("isimpot", "1");
                            System.out.println(data1);
                            consumerManager.insertcompany(data1);

                        }

                    }
                    for (int i = 0; i < listPd.size(); i++) {
                        PageData pageData = new PageData();
                        String var4 = listPd.get(i).getString("var4").trim();
                        String var1 = listPd.get(i).getString("var1").trim();
                        pageData.put("tel", var4);
                        pageData.put("name", var1);
                        List<PageData> findcompany = consumerManager.findcompany(pageData);
                        if (!findcompany.isEmpty()) {
                            PageData data1 = new PageData();
                            data1.put("uid", findcompany.get(0).getString("uid"));
                            String var9 = listPd.get(i).getString("var9");

                            PageData pd1 = new PageData();
                            pd1.put("gwflname",var9);
                            PageData getjobtype = consumerManager.getjobtype(pd1);

                            if (getjobtype!=null){
                                data1.put("jobname", Integer.parseInt(getjobtype.get("code").toString()));
                            }else {
//                                    str = str + "查无此岗位工种;";
//                                    json.put("msg", str);
//                                    break;
                                data1.put("jobname", "暂无");
                            }
                            String var10 = listPd.get(i).getString("var10");
                            PageData pd2 = new PageData();
                            pd2.put("name",var10);
                            pd2.put("bianma","022");
                            PageData dic = consumerManager.getDIC(pd2);
                            if (dic!=null){
                                data1.put("jobtype", dic.getString("DICTIONARIES_ID"));
                            }else {
//                                    str = str + "查无此岗位性质;";
//                                    json.put("msg", str);
//                                    break;
                                data1.put("jobtype", "暂无");
                            }
                            data1.put("zgrs", listPd.get(i).getString("var11"));
                            data1.put("gwyq", listPd.get(i).getString("var12"));
                            String var13 = listPd.get(i).getString("var13");
                            PageData pd3 = new PageData();
                            pd3.put("name",var13);
                            PageData dic3 = consumerManager.getDIC(pd3);
                            if (dic3!=null){
                                data1.put("xl", dic3.getString("DICTIONARIES_ID"));
                            }else {
//                                    str = str + "查无此学历;";
//                                    json.put("msg", str);
//                                    break;
                                data1.put("xl", "暂无");
                            }
                            data1.put("zyyq", listPd.get(i).getString("var14"));
                            String var15 = listPd.get(i).getString("var15");
                            if (var15.equals("男")){
                                data1.put("sex", "1");
                            }else if (var15.equals("女")){
                                data1.put("sex", "2");
                            }else if (var15.equals("均可")){
                                data1.put("sex", "0");
                            }
//                                PageData pd4 = new PageData();
//                                pd4.put("name",var15);
//                                PageData dic4 = consumerManager.getDIC(pd4);
//                                if (dic4!=null){
//                                    data1.put("sex", dic4.getString("DICTIONARIES_ID"));
//                                }else {
//                                   str = str + "查无此学历;";
//                                   json.put("msg", str);
//                                   break;
//                                    data1.put("sex", "");
//                                }
                            String var16 = listPd.get(i).getString("var16");
                            if (var16.contains("-")){
                                String[] split = var16.split("-");
                                data1.put("agestart", split[0]);
                                data1.put("ageend", split[1]);
                            }else if (var16.equals("不限")){
                                data1.put("agestart", 0);
                                data1.put("ageend", 100);
                            }else {

                            }


                            String var17 = listPd.get(i).getString("var17");
                            PageData pd5 = new PageData();
                            pd5.put("name",var17);
                            PageData dic5 = consumerManager.getDIC(pd5);
                            if (dic5!=null){
                                data1.put("gzdy", dic5.getString("DICTIONARIES_ID"));
                            }else {
//                                    str = str + "查无此工资待遇;";
//                                    json.put("msg", str);
//                                    break;
                                data1.put("gzdy", "暂无");
                            }

                            data1.put("remark", listPd.get(i).getString("var18"));
                            data1.put("czman", czman);
                            data1.put("czdate", getTime());
                            data1.put("isimpot", "1");
                            System.out.println(data1);
                            consumerManager.insertemployreg(data1);
                            System.out.println("执行了3");
                        }
                    }

                    json.put("success", "true");
                } else if (check == false) {
                    json.put("msg", str);
                }
            }

        } else {
            json.put("success", "false");
            json.put("msg", "登录超时，请重新登录");
        }
//        } catch (Exception e) {
//            System.out.println("执行了4");
//            json.put("success", "false");
//        }
        return json.toString();
    }


    @RequestMapping(value = "/exportpersonExcel", produces = {"application/json;charset=UTF-8"})
    @CrossOrigin(allowedHeaders = "*", allowCredentials = "true")
    @ResponseBody()
    public JSONObject exportpersonExcel(HttpServletResponse response, HttpServletRequest request) throws Exception {

        JSONObject json = new JSONObject();
        System.out.println(request.getParameter("tokenid"));
        try {
            PageData pd_stoken = new PageData();
            pd_stoken.put("TOKENID", request.getParameter("tokenid"));
            PageData pd_token = zxlbService.findByTokenId(pd_stoken);
            if (pd_token != null) {
                PageData pd = new PageData();
                Page page = new Page();
                URLDecoder urlDecoder = new URLDecoder();
                String name = pd.getString("name");
                String age = pd.getString("age");
                String sex = pd.getString("sex");
                String xl = pd.getString("xl");
                String isjob = pd.getString("isjob");
                String jobtype = pd.getString("jobtype");
                String jobname = pd.getString("jobname");
                String qwxz = pd.getString("qwxz");
                String pageIndex = "0";
                String pageSize = "999999999";
                String name1 = name == null ? "" : urlDecoder.decode(name, "utf-8");
                String age1 = age == null ? "" : urlDecoder.decode(age, "utf-8");
                String sex1 = sex == null ? "" : urlDecoder.decode(sex, "utf-8");
                String xl1 = xl == null ? "" : urlDecoder.decode(xl, "utf-8");
                String isjob1 = isjob == null ? "" : urlDecoder.decode(isjob, "utf-8");
                String jobtype1 = jobtype == null ? "" : urlDecoder.decode(jobtype, "utf-8");
                String jobname1 = jobname == null ? "" : urlDecoder.decode(jobname, "utf-8");
                String qwxz1 = qwxz == null ? "" : urlDecoder.decode(qwxz, "utf-8");
                String pageIndex1 = name == null ? "" : urlDecoder.decode(pageIndex, "utf-8");
                String pageSize1 = name == null ? "" : URLDecoder.decode(pageSize, "utf-8");
                pd.put("name", name1);
                pd.put("age", age1);
                pd.put("sex", sex1);
                pd.put("xl", xl1);
                pd.put("isjob", isjob1);
                pd.put("jobtype", jobtype1);
                pd.put("jobname", jobname1);
                pd.put("qwxz", qwxz1);
                pd.put("pageIndex", pageIndex1);
                pd.put("pageSize", pageSize1);
                page.setPd(pd);
                System.out.println(pd);
                List<PageData> clist = jobReferManager.getjob(pd);

                System.out.println(clist);
                //创建excel文件
                HSSFWorkbook wb = new HSSFWorkbook();
                //创建sheet页
                HSSFSheet sheet = wb.createSheet("求职登记汇总");
                //创建标题行
                HSSFRow titleRow = sheet.createRow(0);
                titleRow.createCell((short) 0).setCellValue("姓名");
                titleRow.createCell((short) 1).setCellValue("身份证号");
                titleRow.createCell((short) 2).setCellValue("性别");
                titleRow.createCell((short) 3).setCellValue("年龄");
                titleRow.createCell((short) 4).setCellValue("联系电话");
                titleRow.createCell((short) 5).setCellValue("学历");
                titleRow.createCell((short) 6).setCellValue("专业");
                titleRow.createCell((short) 7).setCellValue("籍贯");
                titleRow.createCell((short) 8).setCellValue("就业状态");
                titleRow.createCell((short) 9).setCellValue("邮箱");
                titleRow.createCell((short) 10).setCellValue("岗位性质");
                titleRow.createCell((short) 11).setCellValue("岗位名称");
                titleRow.createCell((short) 12).setCellValue("期望薪资");
                titleRow.createCell((short) 13).setCellValue("工作地点");
                titleRow.createCell((short) 14).setCellValue("其他要求");
                if (clist.size() > 0) {


                    for (PageData pd1 : clist) {

                        HSSFRow dataRow = sheet.createRow(sheet.getLastRowNum() + 1);
                        dataRow.createCell((short) 0).setCellValue(pd1.getString("name"));
                        dataRow.createCell((short) 1).setCellValue(pd1.getString("cardid"));
                        String sex2 = pd1.getString("sex");
                        if(sex2.equals("1")){
                            sex2="男";
                        }else if (sex2.equals("2")){
                            sex2="女";
                        }else{
                            sex2="";
                        }
                        dataRow.createCell((short) 2).setCellValue(sex2);
                        dataRow.createCell((short) 3).setCellValue(pd1.getString("age"));
                        dataRow.createCell((short) 4).setCellValue(pd1.getString("lxtel"));
                        dataRow.createCell((short) 5).setCellValue(pd1.getString("xlname"));
                        dataRow.createCell((short) 6).setCellValue(pd1.getString("zy"));
                        dataRow.createCell((short) 7).setCellValue(pd1.getString("jg"));
                        String isjob2 = pd1.getString("isjob");
                        if (isjob2.equals("0")){
                            isjob2="失业";
                        }else if (isjob2.equals("1")){
                            isjob2="就业";
                        }else {
                            isjob2="";
                        }
                        dataRow.createCell((short) 8).setCellValue(isjob2);
                        dataRow.createCell((short) 9).setCellValue(pd1.getString("email"));
                        dataRow.createCell((short) 10).setCellValue(pd1.getString("jobtypename"));
                        dataRow.createCell((short) 11).setCellValue(pd1.getString("gwflname"));
                        dataRow.createCell((short) 12).setCellValue(pd1.getString("qwxzname"));
                        dataRow.createCell((short) 13).setCellValue(pd1.getString("jobaddr"));
                        dataRow.createCell((short) 14).setCellValue(pd1.getString("remark"));
                    }



                }
                // 设置下载时客户端Excel的名称
                String filename = new SimpleDateFormat("yyyyMMdd").format(new Date()) + "-qzdj.xls";
                //设置下载的文件
                System.out.println(filename);
                response.setCharacterEncoding("UTF-8");
                response.setContentType("application/vnd.ms-excel");
                response.setHeader("Content-disposition", "attachment;filename=" + filename);
                OutputStream ouputStream = response.getOutputStream();//打开流
                wb.write(ouputStream); //在excel内写入流
                ouputStream.flush();// 刷新流
                ouputStream.close();// 关闭流

            } else {
                json.put("success", "false");
                json.put("msg", "登录超时，请重新登录");
            }

        } catch (Exception e) {
            json.put("success", "false");
        }
        return json;
    }


    @RequestMapping(value = "/readpersonExcel", produces = {"application/json;charset=UTF-8"})
    @CrossOrigin(allowedHeaders = "*", allowCredentials = "true")
    @ResponseBody()
    public String readpersonExcel(@RequestParam(value = "files", required = false) MultipartFile file, HttpServletRequest request) throws Exception {
        PageData pd = new PageData();
        JSONObject json = new JSONObject();
        try {
            PageData pd_stoken = new PageData();
            pd_stoken.put("TOKENID", request.getParameter("tokenid"));
            System.out.println(request.getParameter("tokenid"));
            PageData pd_token = zxlbService.findByTokenId(pd_stoken);
            String czman = pd_stoken.getString("ZXYH");
            if (pd_token != null) {
                if (null != file && !file.isEmpty()) {
                    String filePath = PathUtil.getClasspath() + Const.FILEPATHFILE;                                //文件上传路径
                    String fileName = FileUpload.fileUp(file, filePath, "Excel");                            //执行上传
                    List<PageData> listPd = (List) ObjectExcelRead2.readExcel(filePath, fileName, 1, 0, 0);        //执行读EXCEL操作,读出的数据导入List 2:从第3行开始；0:从第A列开始；0:第0个sheet
                    /*检查字段操作======================================*/
                    boolean check = true;
                    String str = "";
                    System.out.println("执行了1");
                    for (int i = 0; i < listPd.size(); i++) {

                        String var0 = listPd.get(i).getString("var0");
                        String var2 = listPd.get(i).getString("var2");
                        String var3 = listPd.get(i).getString("var3");
                        String var4 = listPd.get(i).getString("var4");
                        String var11 = listPd.get(i).getString("var11");
                        System.out.println(var0);
                        System.out.println(var2);
                        System.out.println(var3);
                        System.out.println(var4);
                        System.out.println(var11);
                        if ("".equals(var0) || var0 == null) {
                            check = false;
                            str = str + "姓名不能为空;";
                            break;
                        } else if ("".equals(var2) || var2 == null) {
                            check = false;
                            str = str + "性别不能为空;";
                            break;
                        } else if ("".equals(var3) || var3 == null) {
                            check = false;
                            str = str + "年龄不能为空;";
                            break;
                        } else if ("".equals(var4) || var4 == null) {
                            check = false;
                            str = str + "联系电话不能为空;";
                            break;
                        } else if ("".equals(var11) || var11 == null) {
                            check = false;
                            str = str + "岗位名称不能为空;";
                            break;
                        }

//                        String var5 = listPd.get(i).getString("var5");
//                        PageData pd1 = new PageData();
//                        pd1.put("name",var5);
//                        PageData dic1 = consumerManager.getDIC(pd1);
//                        if (dic1==null){
//                            str = str + "查无此学历;";
//                            check = false;
//                            break;
//                        }
//                        String var8 = listPd.get(i).getString("var8");
//                        PageData pd2 = new PageData();
//                        pd2.put("name",var8);
//                        PageData dic2 = consumerManager.getDIC(pd2);
//                        if (dic2==null){
//                            str = str + "查无此就业状态;";
//                            check = false;
//                            break;
//                        }
//                        String var10 = listPd.get(i).getString("var10");
//                        PageData pd9 = new PageData();
//                        pd9.put("name",var10);
//                        PageData dic = consumerManager.getDIC(pd9);
//
//                        if (dic==null){
//                            str = str + "查无此岗位性质;";
//                            check = false;
//                            break;
//                        }
//
//                        PageData pd3 = new PageData();
//                        pd3.put("gwflname",var11);
//                        PageData getjobtype = consumerManager.getjobtype(pd3);
//
//                        if (getjobtype==null){
//                            str = str + "查无此岗位名称;";
//                            check = false;
//                            break;
//                        }
//                        String var12 = listPd.get(i).getString("var12");
//                        PageData pd4 = new PageData();
//                        pd4.put("name",var12);
//                        PageData dic3 = consumerManager.getDIC(pd4);
//                        if (dic3!=null){
//                            str = str + "查无此期望薪资;";
//                            check = false;
//                            break;
//                        }
                    }
                    System.out.println(check);
                    if (check == true) {
                        /*存入数据库操作======================================*/
                        for (int i = 0; i < listPd.size(); i++) {
                            PageData pageData = new PageData();
                            String var4 = listPd.get(i).getString("var4").trim();
                            String var0 = listPd.get(i).getString("var0").trim();
                            pageData.put("tel", var4);
                            pageData.put("name", var0);
                            System.out.println(pageData);
                            List<PageData> findperson = jobReferManager.findperson(pageData);
                            System.out.println(findperson);
                            if (findperson.isEmpty()) {
                                PageData data1 = new PageData();
                                data1.put("uid", this.getUUID32());
                                data1.put("name", listPd.get(i).getString("var0"));
                                data1.put("cardid", listPd.get(i).getString("var1"));
                                String var2 = listPd.get(i).getString("var2");
                                String sex ="";
                                if (var2.equals("男")){
                                    sex="1";
                                }else if(var2.equals("女")){
                                    sex="2";
                                }
                                data1.put("sex", sex);
                                data1.put("age", listPd.get(i).getString("var3"));
                                data1.put("tel", listPd.get(i).getString("var4"));
                                data1.put("lxtel", listPd.get(i).getString("var4"));
                                String var5 = listPd.get(i).getString("var5");
                                PageData pd1 = new PageData();
                                pd1.put("name",var5);
                                PageData dic1 = consumerManager.getDIC(pd1);
                                if (dic1!=null){
                                    data1.put("xl", dic1.getString("DICTIONARIES_ID"));
                                }else {
//                                    str = str + "查无此学历;";
//                                    json.put("msg", str);
//                                    break;
                                    data1.put("xl", "暂无");
                                }

                                data1.put("zy", listPd.get(i).getString("var6"));
                                data1.put("jg", listPd.get(i).getString("var7"));
                                String var8 = listPd.get(i).getString("var8");
                                if (var8.equals("就业")){
                                    data1.put("isjob", "1");
                                }else if (var8.equals("失业")){
                                    data1.put("isjob", "0");
                                }else {
                                    data1.put("isjob", "暂无");
                                }

//                                PageData pd2 = new PageData();
//                                pd2.put("name",var8);
//                                PageData dic2 = consumerManager.getDIC(pd2);
//                                if (dic2!=null){
//                                    data1.put("isjob", dic2.getString("DICTIONARIES_ID"));
//                                }else {
//                                    str = str + "查无此就业;";
//                                    json.put("msg", str);
//                                    break;
//                                    data1.put("isjob", "");
//                                }
                                data1.put("email", listPd.get(i).getString("var9"));
                                data1.put("czman", czman);
                                data1.put("czdate", getTime());
                                data1.put("isimpot", "1");
                                jobReferManager.insertperson(data1);
                                System.out.println("执行了2");
                            }

                        }
                        for (int i = 0; i < listPd.size(); i++) {
                            PageData pageData = new PageData();
                            String var4 = listPd.get(i).getString("var4").trim();
                            String var0 = listPd.get(i).getString("var0").trim();
                            pageData.put("tel", var4);
                            pageData.put("name", var0);
                            List<PageData> findperson = jobReferManager.findperson(pageData);
                            System.out.println(findperson);

                            if (!findperson.isEmpty()) {
                                PageData data1 = new PageData();
                                data1.put("uid", findperson.get(0).getString("uid"));
                                String var10 = listPd.get(i).getString("var10");
                                PageData pd1 = new PageData();
                                pd1.put("name",var10);
                                PageData dic = consumerManager.getDIC(pd1);

                                if (dic!=null){
                                    data1.put("jobtype", dic.getString("DICTIONARIES_ID"));
                                }else {
//                                    str = str + "查无此岗位工种;";
//                                    json.put("msg", str);
//                                    break;
                                    data1.put("jobtype", "暂无");
                                }

                                String var11 = listPd.get(i).getString("var11");
                                PageData pd2 = new PageData();
                                pd2.put("gwflname",var11);
                                PageData getjobtype = consumerManager.getjobtype(pd2);

                                if (getjobtype!=null){
                                    data1.put("jobname", Integer.parseInt(getjobtype.get("code").toString()));
                                }else {
//                                    str = str + "查无此岗位性质;";
//                                    json.put("msg", str);
//                                    break;
                                    data1.put("jobname", "暂无");
                                }
                                String var12 = listPd.get(i).getString("var12");
                                PageData pd3 = new PageData();
                                pd3.put("name",var12);
                                PageData dic2 = consumerManager.getDIC(pd3);
                                if (dic2!=null){
                                    data1.put("qwxz", dic2.getString("DICTIONARIES_ID"));
                                }else {
//                                    str = str + "查无此期望薪资;";
//                                    json.put("msg", str);
//                                    break;
                                    data1.put("qwxz", "暂无");
                                }


                                data1.put("jobaddr", listPd.get(i).getString("var13"));
                                data1.put("remark", listPd.get(i).getString("var14"));
                                data1.put("isvalid", "1");
                                data1.put("czman", czman);
                                data1.put("czdate", getTime());
                                data1.put("isimpot", "1");
                                jobReferManager.insertjobreg(data1);
                                System.out.println("执行了3");
                            }
                        }
                        json.put("success", "true");

                    } else if (check == false) {
                        json.put("msg", str);
                    }
                }else {
                    json.put("msg", "暂无数据");
                }

            } else {
                json.put("success", "false");
                json.put("msg", "登录超时，请重新登录");
            }
        } catch (Exception e) {
            json.put("success", "false");
        }
        return json.toString();
    }

    //通讯录导入
    @RequestMapping(value = "/readaddrExcel", produces = {"application/json;charset=UTF-8"})
    @CrossOrigin(allowedHeaders = "*", allowCredentials = "true")
    @ResponseBody()
    public String readaddrExcel(@RequestParam(value = "files", required = false) MultipartFile file, HttpServletRequest request) throws Exception {
        PageData pd = new PageData();
        JSONObject json = new JSONObject();
        try {
            PageData pd_stoken = new PageData();
            pd_stoken.put("TOKENID", request.getParameter("tokenid"));
            System.out.println(request.getParameter("tokenid"));
            PageData pd_token = zxlbService.findByTokenId(pd_stoken);
            if (pd_token != null) {
                System.out.println(file);
                if (null != file && !file.isEmpty()) {
                    String filePath = PathUtil.getClasspath() + Const.FILEPATHFILE;                                //文件上传路径
                    String fileName = FileUpload.fileUp(file, filePath, "Excel");                            //执行上传
                    List<PageData> listPd = (List) ObjectExcelRead2.readExcel(filePath, fileName, 1, 0, 0);        //执行读EXCEL操作,读出的数据导入List 2:从第3行开始；0:从第A列开始；0:第0个sheet
                    /*存入数据库操作======================================*/
                    for (int i = 0; i < listPd.size(); i++) {
                        pd.put("office", listPd.get(i).getString("var1"));
                        pd.put("duty", listPd.get(i).getString("var2"));
                        pd.put("name", listPd.get(i).getString("var3"));
                        pd.put("tel1", listPd.get(i).getString("var4"));
                        pd.put("tel2", listPd.get(i).getString("var5"));
                        jobReferManager.insertaddr(pd);
                    }
                    json.put("success", "true");
                }

            } else {
                json.put("success", "false");
                json.put("msg", "登录超时，请重新登录");
            }
        } catch (Exception e) {
            json.put("success", "false");
        }
        return json.toString();
    }

    @RequestMapping(value = "/exportaddrExcel", produces = {"application/json;charset=UTF-8"})
    @CrossOrigin(allowedHeaders = "*", allowCredentials = "true")
    @ResponseBody()
    public String exportaddrExcel(HttpServletResponse response, HttpServletRequest request) throws Exception {

        JSONObject json = new JSONObject();
//        try {
        PageData pd_stoken = new PageData();
        pd_stoken.put("TOKENID", request.getParameter("tokenid"));
        PageData pd_token = zxlbService.findByTokenId(pd_stoken);
        if (pd_token != null) {
            PageData pd = new PageData();
            Page page = new Page();
            URLDecoder urlDecoder = new URLDecoder();
            String starttime = pd.getString("starttime");
            String endtime = pd.getString("endtime");
            String pageIndex = "0";
            String pageSize = "999999999";
            String starttime1 = starttime == null ? "" : urlDecoder.decode(starttime, "utf-8");
            String endtime1 = endtime == null ? "" : urlDecoder.decode(endtime, "utf-8");
            String pageIndex1 = pageIndex == null ? "" : urlDecoder.decode(pageIndex, "utf-8");
            String pageSize1 = pageSize == null ? "" : urlDecoder.decode(pageSize, "utf-8");
            pd.put("starttime", starttime1);
            pd.put("endtime", endtime1);
            pd.put("pageIndex", pageIndex1);
            pd.put("pageSize", pageSize1);
            page.setPd(pd);
            System.out.println(pd);
            List<PageData> clist = jobReferManager.findaddr(pd);
            //创建excel文件
            HSSFWorkbook wb = new HSSFWorkbook();
            //创建sheet页
            HSSFSheet sheet = wb.createSheet("通讯录");
            //创建标题行
            HSSFRow titleRow = sheet.createRow(0);
            titleRow.createCell((short) 0).setCellValue("序号");
            titleRow.createCell((short) 1).setCellValue("办公室");
            titleRow.createCell((short) 2).setCellValue("职责范围");
            titleRow.createCell((short) 3).setCellValue("姓名");
            titleRow.createCell((short) 4).setCellValue("办公电话1");
            titleRow.createCell((short) 5).setCellValue("办公电话2");
            System.out.println(clist);
            if (clist.size() > 0) {


                int count = 1;
                for (PageData pd1 : clist) {
                    HSSFRow dataRow = sheet.createRow(sheet.getLastRowNum() + 1);
                    dataRow.createCell((short) 0).setCellValue(count);
                    count++;
                    dataRow.createCell((short) 1).setCellValue(pd1.getString("office"));
                    dataRow.createCell((short) 2).setCellValue(pd1.getString("duty"));
                    dataRow.createCell((short) 3).setCellValue(pd1.getString("name"));
                    dataRow.createCell((short) 4).setCellValue(pd1.getString("tel1"));
                    dataRow.createCell((short) 5).setCellValue(pd1.getString("tel2"));
                }

            }
            // 设置下载时客户端Excel的名称
            String filename = new SimpleDateFormat("yyyyMMdd").format(new Date()) + "-txl.xls";
            //设置下载的文件
            System.out.println(filename);
            response.setCharacterEncoding("UTF-8");
            response.setContentType("application/vnd.ms-excel");
            response.setHeader("Content-disposition", "attachment;filename=" + filename);
            OutputStream ouputStream = response.getOutputStream();//打开流
            wb.write(ouputStream); //在excel内写入流
            ouputStream.flush();// 刷新流
            ouputStream.close();// 关闭流

        } else {
            json.put("success", "false");
            json.put("msg", "登录超时，请重新登录");
        }

//        } catch (Exception e) {
//            json.put("success", "false");
//        }
        return json.toString();
    }

    //知识库导入
    @RequestMapping(value = "/readdocExcel", produces = {"application/json;charset=UTF-8"})
    @CrossOrigin(allowedHeaders = "*", allowCredentials = "true")
    @ResponseBody()
    public String readdocExcel(@RequestParam(value = "files", required = false) MultipartFile file, HttpServletRequest request) throws Exception {
        PageData pd = new PageData();
        JSONObject json = new JSONObject();
        try {
            PageData pd_stoken = new PageData();
            pd_stoken.put("TOKENID", request.getParameter("tokenid"));
            String createman = request.getParameter("czman");
            String doctype_id = request.getParameter("doctype_id");
            System.out.println(request.getParameter("tokenid"));
            PageData pd_token = zxlbService.findByTokenId(pd_stoken);
            System.out.println("执行了");
            if (pd_token != null) {
                System.out.println(file);
                if (null != file && !file.isEmpty()) {
                    String filePath = PathUtil.getClasspath() + Const.FILEPATHFILE;                                //文件上传路径
                    String fileName = FileUpload.fileUp(file, filePath, "Excel");                            //执行上传
                    List<PageData> listPd = (List) ObjectExcelRead.readExcel(filePath, fileName, 1, 0, 0);        //执行读EXCEL操作,读出的数据导入List 2:从第3行开始；0:从第A列开始；0:第0个sheet

                    /*检查字段操作======================================*/
                    boolean check = true;
                    String str = "";
                    for (int i = 0; i < listPd.size(); i++) {
                        String var0 = listPd.get(i).getString("var0");
                        String var1 = listPd.get(i).getString("var1");
                        String var2 = listPd.get(i).getString("var2");
                        String var3 = listPd.get(i).getString("var3");
                        if ("".equals(var0) || var0 == null) {
                            check = false;
                            str = str + "知识标题不能为空";
                            break;
                        }
                        if ("".equals(var1) || var1 == null) {
                            check = false;
                            str = str + "知识内容不能为空";
                            break;
                        }
                        if ("".equals(var2) || var2 == null) {
                            check = false;
                            str = str + "有效期不能为空";
                            break;
                        }
                        if ("".equals(var3) || var3 == null) {
                            check = false;
                            str = str + "是否热点不能为空";
                            break;
                        }
                        if (doctype_id==null){
                            check = false;
                            str = str + "请先选择知识库分类";
                            break;
                        }
                    }

                    if (check==true){
                        /*存入数据库操作======================================*/
                        for (int i = 0; i < listPd.size(); i++) {
                            pd.put("doctype_id", doctype_id);
                            pd.put("doctitle", listPd.get(i).getString("var0"));
                            pd.put("doccont", listPd.get(i).getString("var1"));
                            pd.put("validate", listPd.get(i).getString("var2"));
                            String var3 = listPd.get(i).getString("var3");
                            String ishot = var3.equals("是") ? "1" : "0";
                            pd.put("ishot", ishot);
                            pd.put("createman",createman);
                            pd.put("createdate",getTime());
                            jobReferManager.importdoc(pd);
                        }
                        json.put("success", "true");
                    } else if (check == false) {
                        json.put("msg", str);
                    }

                }

            } else {
                json.put("success", "false");
                json.put("msg", "登录超时，请重新登录");
            }
        } catch (Exception e) {
            json.put("success", "false");
        }
        return json.toString();
    }
    //短息记录导出
    @RequestMapping(value = "/exportmsglogExcel", produces = {"application/json;charset=UTF-8"})
    @CrossOrigin(allowedHeaders = "*", allowCredentials = "true")
    @ResponseBody()
    public void exportmsglogExcel(HttpServletResponse response, HttpServletRequest request) throws Exception {

        JSONObject json = new JSONObject();
//        try {
        PageData pd_stoken = new PageData();
        pd_stoken.put("TOKENID", request.getParameter("tokenid"));
        PageData pd_token = zxlbService.findByTokenId(pd_stoken);
        if (pd_token != null) {
            PageData pd = new PageData();
            Page page = new Page();
            URLDecoder urlDecoder = new URLDecoder();
            String starttime = pd.getString("starttime");
            String endtime = pd.getString("endtime");
            String sendman = pd.getString("sendman");
            String phone = pd.getString("phone");
            String acceptman = pd.getString("acceptman");
            String keywords = pd.getString("keywords");
            String starttime1 = starttime == null ? "" : urlDecoder.decode(starttime, "utf-8");
            String endtime1 = endtime == null ? "" : urlDecoder.decode(endtime, "utf-8");
            String sendman1 = sendman == null ? "" : urlDecoder.decode(sendman, "utf-8");
            String phone1 = phone == null ? "" : urlDecoder.decode(phone, "utf-8");
            String acceptman1 = acceptman == null ? "" : urlDecoder.decode(acceptman, "utf-8");
            String keywords1 = keywords == null ? "" : urlDecoder.decode(keywords, "utf-8");
            pd.put("starttime", starttime1);
            pd.put("endtime", endtime1);
            pd.put("sendman", sendman1);
            pd.put("phone", phone1);
            pd.put("acceptman", acceptman1);
            pd.put("keywords", keywords1);
            pd.put("pageIndex", 0);
            pd.put("pageSize", 9999);
            page.setPd(pd);
            System.out.println(pd);
            List<PageData> clist = msgTempManager.findMsgLogAll(pd);
            System.out.println(clist);
            //创建excel文件
            HSSFWorkbook wb = new HSSFWorkbook();
            //创建sheet页
            HSSFSheet sheet = wb.createSheet("短信发送记录");
            //创建标题行
            HSSFRow titleRow = sheet.createRow(0);
            titleRow.createCell((short) 0).setCellValue("序号");
            titleRow.createCell((short) 1).setCellValue("发送人");
            titleRow.createCell((short) 2).setCellValue("短信模板");
            titleRow.createCell((short) 3).setCellValue("联系方式");
            titleRow.createCell((short) 4).setCellValue("接受人");
            titleRow.createCell((short) 5).setCellValue("发送时间");
            titleRow.createCell((short) 6).setCellValue("发送方式");
            titleRow.createCell((short) 7).setCellValue("短信内容");
//                titleRow.createCell((short) 5).setCellValue("客户名称");
//                titleRow.createCell((short) 6).setCellValue("客户类别");

            if (clist.size() > 0) {


                int count = 1;
                for (PageData pd1 : clist) {
                    HSSFRow dataRow = sheet.createRow(sheet.getLastRowNum() + 1);
                    dataRow.createCell((short) 0).setCellValue(count);
                    count++;
                    dataRow.createCell((short) 1).setCellValue(pd1.getString("sendman"));
                    dataRow.createCell((short) 2).setCellValue(pd1.getString("tempname"));
                    dataRow.createCell((short) 3).setCellValue(pd1.getString("phone"));
                    dataRow.createCell((short) 4).setCellValue(pd1.getString("acceptman"));
                    dataRow.createCell((short) 5).setCellValue(pd1.getString("sendtime"));
                    dataRow.createCell((short) 6).setCellValue(pd1.getString("way"));
                    dataRow.createCell((short) 7).setCellValue(pd1.getString("content"));
//                        dataRow.createCell((short) 5).setCellValue(pd1.getString("clientname"));
//                        dataRow.createCell((short) 6).setCellValue(pd1.getString("clientcate"));
                }

            }
            // 设置下载时客户端Excel的名称
            String filename = new SimpleDateFormat("yyyyMMddHHmmss").format(new Date()) + "-Messagelog.xls";
            //设置下载的文件
            System.out.println(filename);
            response.setCharacterEncoding("UTF-8");
            response.setContentType("application/vnd.ms-excel");
            response.setHeader("Content-disposition", "attachment;filename=" + filename);
            OutputStream ouputStream = response.getOutputStream();//打开流
            wb.write(ouputStream); //在excel内写入流
            ouputStream.flush();// 刷新流
            ouputStream.close();// 关闭流

        } else {
            json.put("success", "false");
            json.put("msg", "登录超时，请重新登录");
        }



//        } catch (Exception e) {
//            json.put("success", "false");
//        }

    }

    //导出培训信息
    @RequestMapping(value = "/exportTrainExcel", produces = {"application/json;charset=UTF-8"})
    @CrossOrigin(allowedHeaders = "*", allowCredentials = "true")
    @ResponseBody()
    public String exportTrainExcel(HttpServletResponse response, HttpServletRequest request) throws Exception {

        JSONObject json = new JSONObject();
        try {
            PageData pd_stoken = new PageData();
            pd_stoken.put("TOKENID", request.getParameter("tokenid"));
            PageData pd_token = zxlbService.findByTokenId(pd_stoken);
            if (pd_token != null) {
                PageData pd = new PageData();
                Page page = new Page();
                URLDecoder urlDecoder = new URLDecoder();
                String name = request.getParameter("name");
                System.out.println(name);
                String keywords = request.getParameter("keywords");
                System.out.println(keywords);
                name = name == null ? "" : urlDecoder.decode(name, "utf-8");
                keywords = keywords == null ? "" : urlDecoder.decode(keywords, "utf-8");
                pd.put("name",name);
                pd.put("keywords",keywords);
                page.setCurrentPage(1);
                page.setShowCount(99999999);
                page.setPd(pd);
                System.out.println(pd);
                List<PageData> clist = trainInfoService.findAlllistPage(page);
                HSSFWorkbook wb = new HSSFWorkbook();
                HSSFSheet sheet = wb.createSheet("培训信息表");
                HSSFRow titleRow = sheet.createRow(0);
                titleRow.createCell((short) 0).setCellValue("序号");
                titleRow.createCell((short) 1).setCellValue("培训机构");
                titleRow.createCell((short) 2).setCellValue("办学班类型");
                titleRow.createCell((short) 3).setCellValue("地址");
                titleRow.createCell((short) 4).setCellValue("负责人");
                titleRow.createCell((short) 5).setCellValue("联系方式1");
                titleRow.createCell((short) 6).setCellValue("联系方式2");
                titleRow.createCell((short) 7).setCellValue("备注");
                System.out.println(clist);
                if (clist.size() > 0) {
                    int count = 1;
                    for (PageData pd1 : clist) {
                        HSSFRow dataRow = sheet.createRow(sheet.getLastRowNum() + 1);
                        dataRow.createCell((short) 0).setCellValue(count);
                        count++;
                        dataRow.createCell((short) 1).setCellValue(pd1.getString("name"));
                        dataRow.createCell((short) 2).setCellValue(pd1.getString("stat"));
                        dataRow.createCell((short) 3).setCellValue(pd1.getString("addr"));
                        dataRow.createCell((short) 4).setCellValue(pd1.getString("principal"));
                        dataRow.createCell((short) 5).setCellValue(pd1.getString("tel"));
                        dataRow.createCell((short) 6).setCellValue(pd1.getString("tel2"));
                        dataRow.createCell((short) 7).setCellValue(pd1.getString("remark"));
                    }

                }
                String filename = new SimpleDateFormat("yyyyMMdd").format(new Date()) + "-trainInfo.xls";
                System.out.println(filename);
                response.setCharacterEncoding("UTF-8");
                response.setContentType("application/vnd.ms-excel");
                response.setHeader("Content-disposition", "attachment;filename=" + filename);
                OutputStream ouputStream = response.getOutputStream();
                wb.write(ouputStream);
                ouputStream.flush();
                ouputStream.close();
                json.put("success", "true");
                json.put("msg", "导出成功");
            } else {
                json.put("success", "false");
                json.put("msg", "超时，请重新登陆");
            }

        } catch (Exception e) {
            json.put("success", "false");
        }
        return json.toString();
    }


    @RequestMapping(value = "/exportOtherPersonExcel", produces = {"application/json;charset=UTF-8"})
    @CrossOrigin(allowedHeaders = "*", allowCredentials = "true")
    @ResponseBody()
    public String exportOtherPersonExcel(HttpServletResponse response, HttpServletRequest request) throws Exception {

        JSONObject json = new JSONObject();
        try {
            PageData pd_stoken = new PageData();
            pd_stoken.put("TOKENID", request.getParameter("tokenid"));
            PageData pd_token = zxlbService.findByTokenId(pd_stoken);
            if (pd_token != null) {
                PageData pd = new PageData();
                Page page = new Page();
                URLDecoder urlDecoder = new URLDecoder();
                String startTime = request.getParameter("startTime");
                String endTime = request.getParameter("endTime");
                if(endTime != null && !"".equals(endTime)) {
                    endTime = TimeHandle.endTimeHeandle(endTime);
                    json.put("endTime", endTime);
                }
                String isjob = request.getParameter("isjob");
                startTime = startTime == null ? "" : urlDecoder.decode(startTime, "utf-8");
                endTime = endTime == null ? "" : urlDecoder.decode(endTime, "utf-8");
                isjob = isjob == null ? "" : urlDecoder.decode(isjob, "utf-8");

                page.setShowCount(99999999);
                page.setCurrentPage(1);
                pd.put("startTime",startTime);
                pd.put("endTime",endTime);
                pd.put("isjob",isjob);
                page.setPd(pd);
                System.out.println(pd);
                List<PageData> clist = otherPersonService.findAlllistPage(page);
                HSSFWorkbook wb = new HSSFWorkbook();
                HSSFSheet sheet = wb.createSheet("其他人员信息表");
                HSSFRow titleRow = sheet.createRow(0);
                titleRow.createCell((short) 0).setCellValue("序号");
                titleRow.createCell((short) 1).setCellValue("姓名");
                titleRow.createCell((short) 2).setCellValue("性别");
                titleRow.createCell((short) 3).setCellValue("身份证号");
                titleRow.createCell((short) 4).setCellValue("就业状态");
                titleRow.createCell((short) 5).setCellValue("联系电话");
                System.out.println(clist);
                if (clist.size() > 0) {


                    int count = 1;
                    for (PageData pd1 : clist) {
                        HSSFRow dataRow = sheet.createRow(sheet.getLastRowNum() + 1);
                        dataRow.createCell((short) 0).setCellValue(count);
                        count++;
                        dataRow.createCell((short) 1).setCellValue(pd1.getString("name"));
                        String sex = pd1.getString("sex");
                        if("1".equals(sex))
                            dataRow.createCell((short) 2).setCellValue("男".toString());
                        if("2".equals(sex))
                            dataRow.createCell((short) 2).setCellValue("女".toString());
                        if("".equals(sex)|| sex == null)
                            dataRow.createCell((short) 2).setCellValue("");

                        dataRow.createCell((short) 3).setCellValue(pd1.getString("cardid"));
                        isjob = pd1.getString("isjob");
                        if("0".equals(isjob))
                            dataRow.createCell((short) 4).setCellValue("未就业");
                        if("1".equals(isjob))
                            dataRow.createCell((short) 4).setCellValue("已就业");
                        if("".equals(isjob)|| isjob == null)
                            dataRow.createCell((short) 4).setCellValue("");
                        dataRow.createCell((short) 5).setCellValue(pd1.getString("tel"));
                    }

                }
                String filename = new SimpleDateFormat("yyyyMMdd").format(new Date()) + "-other.xls";
                System.out.println(filename);
                response.setCharacterEncoding("UTF-8");
                response.setContentType("application/vnd.ms-excel");
                response.setHeader("Content-disposition", "attachment;filename=" + filename);
                OutputStream ouputStream = response.getOutputStream();//???
                wb.write(ouputStream); //?excel????
                ouputStream.flush();// ???
                ouputStream.close();// ???
                json.put("success", "true");
                json.put("msg", "导入成功");
            } else {
                json.put("success", "false");
                json.put("msg", "超时，请重新登陆");
            }

        } catch (Exception e) {
            json.put("success", "false");
        }
        return json.toString();
    }

    //政策咨询导出
    @RequestMapping(value = "/exportPolicyExcel", produces = {"application/json;charset=UTF-8"})
    @CrossOrigin(allowedHeaders = "*", allowCredentials = "true")
    @ResponseBody()
    public String exportPolicyExcel(HttpServletResponse response, HttpServletRequest request) throws Exception {

        JSONObject json = new JSONObject();
        try {
            PageData pd_stoken = new PageData();
            pd_stoken.put("TOKENID", request.getParameter("tokenid"));
            PageData pd_token = zxlbService.findByTokenId(pd_stoken);
            if (pd_token != null) {
                SimpleDateFormat df = new SimpleDateFormat("yyyy-MM-dd HH:mm:ss");
                PageData pd = new PageData();
                Page page = new Page();
                URLDecoder urlDecoder = new URLDecoder();
                String startTime = request.getParameter("startTime");
                String endTime = request.getParameter("endTime");
                if(endTime != null && !"".equals(endTime)) {
                    endTime = TimeHandle.endTimeHeandle(endTime);
                    json.put("endTime", endTime);
                }
                String zczxname = request.getParameter("zczxname");
                String isjd = request.getParameter("isjd");
                String name = request.getParameter("name");
                String zczxtype = request.getParameter("zczxtype");
                String type = request.getParameter("type");
                startTime = startTime == null ? "" : urlDecoder.decode(startTime, "utf-8");
                type = type == null ? "" : urlDecoder.decode(type, "utf-8");
                zczxtype = zczxtype == null ? "" : urlDecoder.decode(zczxtype, "utf-8");
                endTime = endTime == null ? "" : urlDecoder.decode(endTime, "utf-8");
                isjd = isjd == null ? "" : urlDecoder.decode(isjd, "utf-8");
                name = name == null ? "" : urlDecoder.decode(name, "utf-8");
                zczxname = zczxname == null ? "" : urlDecoder.decode(zczxname, "utf-8");
                page.setShowCount(99999999);
                page.setCurrentPage(1);
                pd.put("startTime",startTime);
                pd.put("endTime",endTime);
                pd.put("isjd",isjd);
                pd.put("zczxtype",zczxtype);
                pd.put("name",name);
                pd.put("type",type);
                pd.put("zczxname",zczxname);
                page.setPd(pd);
                System.out.println(pd);
                List<PageData> clist = policyService.findAlllistPage(page);

                HSSFWorkbook wb = new HSSFWorkbook();

                HSSFSheet sheet = wb.createSheet("政策咨询记录");

                HSSFRow titleRow = sheet.createRow(0);
                titleRow.createCell((short) 0).setCellValue("序号");
                titleRow.createCell((short) 1).setCellValue("咨询时间");
                titleRow.createCell((short) 2).setCellValue("政策名称");
                titleRow.createCell((short) 3).setCellValue("咨询类别");
                titleRow.createCell((short) 4).setCellValue("咨询结果");
                titleRow.createCell((short) 5).setCellValue("客户名称");
                titleRow.createCell((short) 6).setCellValue("客户类型");
                System.out.println(clist);
                if (clist.size() > 0) {


                    int count = 1;
                    for (PageData pd1 : clist) {
                        HSSFRow dataRow = sheet.createRow(sheet.getLastRowNum() + 1);
                        dataRow.createCell((short) 0).setCellValue(count);
                        count++;
                        dataRow.createCell((short) 1).setCellValue(df.format(df.parse(pd1.getString("czdate"))));
                        dataRow.createCell((short) 2).setCellValue(pd1.getString("zczxname"));
                        dataRow.createCell((short) 3).setCellValue(pd1.getString("zczxtypename"));
                        isjd = pd1.getString("isjd");
                        if("0".equals(isjd))
                            dataRow.createCell((short) 4).setCellValue("未就业");
                        if("1".equals(isjd))
                            dataRow.createCell((short) 4).setCellValue("已就业");
                        if("".equals(isjd)|| isjd == null)
                            dataRow.createCell((short) 4).setCellValue("");
                        dataRow.createCell((short) 5).setCellValue(pd1.getString("name"));

                        type = pd1.getString("type");
                        if("1".equals(type))
                            dataRow.createCell((short) 6).setCellValue("企业".toString());
                        if("2".equals(type))
                            dataRow.createCell((short) 6).setCellValue("个人".toString());
                        if("".equals(type)|| type == null)
                            dataRow.createCell((short) 6).setCellValue("");
                    }

                }
                String filename = new SimpleDateFormat("yyyyMMdd").format(new Date()) + "-policy.xls";
                System.out.println(filename);
                response.setCharacterEncoding("UTF-8");
                response.setContentType("application/vnd.ms-excel");
                response.setHeader("Content-disposition", "attachment;filename=" + filename);
                OutputStream ouputStream = response.getOutputStream();
                wb.write(ouputStream);
                ouputStream.flush();
                ouputStream.close();
                json.put("success", "true");
                json.put("msg", "导出成功");
            } else {
                json.put("success", "false");
                json.put("msg", "超时，请重新登陆");
            }

        } catch (Exception e) {
            json.put("success", "false");
        }
        return json.toString();
    }


    @RequestMapping(value = "/exportSignupExcel", produces = {"application/json;charset=UTF-8"})
    @CrossOrigin(allowedHeaders = "*", allowCredentials = "true")
    @ResponseBody()
    public String exportSignupExcel(HttpServletResponse response, HttpServletRequest request) throws Exception {

        JSONObject json = new JSONObject();
        try {
            PageData pd_stoken = new PageData();
            pd_stoken.put("TOKENID", request.getParameter("tokenid"));
            PageData pd_token = zxlbService.findByTokenId(pd_stoken);
            if (pd_token != null) {
                SimpleDateFormat df = new SimpleDateFormat("yyyy-MM-dd HH:mm:ss");
                PageData pd = new PageData();
                Page page = new Page();
                URLDecoder urlDecoder = new URLDecoder();
                String startTime = request.getParameter("startTime");
                String endTime = request.getParameter("endTime");
                if(endTime != null && !"".equals(endTime)) {
                    endTime = TimeHandle.endTimeHeandle(endTime);
                    json.put("endTime", endTime);
                }
                String isjob = request.getParameter("isjob");
                String name = request.getParameter("name");
                startTime = startTime == null ? "" : urlDecoder.decode(startTime, "utf-8");
                endTime = endTime == null ? "" : urlDecoder.decode(endTime, "utf-8");
                isjob = isjob == null ? "" : urlDecoder.decode(isjob, "utf-8");
                name = name == null ? "" : urlDecoder.decode(name, "utf-8");
                pd.put("startTime",startTime);
                pd.put("endTime",endTime);
                pd.put("isjod",isjob);
                pd.put("name",name);
                page.setCurrentPage(1);
                page.setShowCount(99999999);
                page.setPd(pd);
                System.out.println(pd);
                List<PageData> clist = signupService.findAlllistPage(page);
                //??excel??
                HSSFWorkbook wb = new HSSFWorkbook();
                //??sheet?
                HSSFSheet sheet = wb.createSheet("线上报名就业结果汇总表");
                //?????
                HSSFRow titleRow = sheet.createRow(0);
                titleRow.createCell((short) 0).setCellValue("序号");
                titleRow.createCell((short) 1).setCellValue("报名时间");
                titleRow.createCell((short) 2).setCellValue("姓名");
                titleRow.createCell((short) 3).setCellValue("性别");
                titleRow.createCell((short) 4).setCellValue("联系电话");
                titleRow.createCell((short) 5).setCellValue("学历");
                titleRow.createCell((short) 6).setCellValue("报名企业");
                titleRow.createCell((short) 7).setCellValue("报名岗位");
                titleRow.createCell((short) 8).setCellValue("入职情况");
                titleRow.createCell((short) 9).setCellValue("备注");
                titleRow.createCell((short) 10).setCellValue("回访人员");
                titleRow.createCell((short) 11).setCellValue("回访时间");
                System.out.println(clist);
                if (clist.size() > 0) {


                    int count = 1;
                    for (PageData pd1 : clist) {
                        HSSFRow dataRow = sheet.createRow(sheet.getLastRowNum() + 1);
                        dataRow.createCell((short) 0).setCellValue(count);
                        count++;
                        if(pd1.get("czdate") != null)
                            dataRow.createCell((short) 1).setCellValue(df.format(df.parse(pd1.getString("czdate"))));
                        dataRow.createCell((short) 2).setCellValue(pd1.getString("pname"));
                        String sex = pd1.getString("sex");
                        if("1".equals(sex)) {
                            dataRow.createCell((short) 3).setCellValue("男");
                        }
                        if("2".equals(sex)){
                            dataRow.createCell((short) 3).setCellValue("女");
                        }
                        dataRow.createCell((short) 4).setCellValue(pd1.getString("tel"));
                        dataRow.createCell((short) 5).setCellValue(pd1.getString("xlname"));
                        dataRow.createCell((short) 6).setCellValue(pd1.getString("cname"));
                        dataRow.createCell((short) 7).setCellValue(pd1.getString("signupjob"));
                        isjob = pd1.getString("isjob");
                        if("0".equals(isjob))
                            dataRow.createCell((short) 8).setCellValue("未入职");
                        if("1".equals(isjob))
                            dataRow.createCell((short) 8).setCellValue("已入职");
                        dataRow.createCell((short) 9).setCellValue(pd1.getString("remark"));
                        dataRow.createCell((short) 10).setCellValue(pd1.getString("rczman"));
                        dataRow.createCell((short) 11).setCellValue(df.format(df.parse(pd1.getString("rcztime"))));

                    }

                }
                // ????????Excel???
                String filename = new SimpleDateFormat("yyyyMMdd").format(new Date()) + "-signup.xls";
                //???????
                System.out.println(filename);
                response.setCharacterEncoding("UTF-8");
                response.setContentType("application/vnd.ms-excel");
                response.setHeader("Content-disposition", "attachment;filename=" + filename);
                OutputStream ouputStream = response.getOutputStream();//???
                wb.write(ouputStream); //?excel????
                ouputStream.flush();// ???
                ouputStream.close();// ???
                json.put("success", "true");
                json.put("msg", "导出成功");
            } else {
                json.put("success", "false");
                json.put("msg", "超时，请重新登陆");
            }

        } catch (Exception e) {
            json.put("success", "false");
        }
        return json.toString();
    }

    //业务引导导出
    @RequestMapping(value = "/exportGuideExcel", produces = {"application/json;charset=UTF-8"})
    @CrossOrigin(allowedHeaders = "*", allowCredentials = "true")
    @ResponseBody()
    public String exportGuideExcel(HttpServletResponse response, HttpServletRequest request) throws Exception {

        JSONObject json = new JSONObject();
        try {
            PageData pd_stoken = new PageData();
            pd_stoken.put("TOKENID", request.getParameter("tokenid"));
            PageData pd_token = zxlbService.findByTokenId(pd_stoken);
            if (pd_token != null) {
                SimpleDateFormat df = new SimpleDateFormat("yyyy-MM-dd HH:mm:ss");
                PageData pd = new PageData();
                Page page = new Page();
                URLDecoder urlDecoder = new URLDecoder();
                String startTime = request.getParameter("startTime");
                String endTime = request.getParameter("endTime");
                System.out.println(endTime);
                if(endTime != null && !"".equals(endTime)) {
                    endTime = TimeHandle.endTimeHeandle(endTime);
                    json.put("endTime", endTime);
                }
                String isjob = request.getParameter("isjob");
                String name = request.getParameter("name");
                String ywname = request.getParameter("ywname");
                String ydqd = request.getParameter("ydqd");
                String isjd = request.getParameter("isjd");
                String type = request.getParameter("type");
                String uid = request.getParameter("uid");
                startTime = startTime == null ? "" : urlDecoder.decode(startTime, "utf-8");
                endTime = endTime == null ? "" : urlDecoder.decode(endTime, "utf-8");
                isjob = isjob == null ? "" : urlDecoder.decode(isjob, "utf-8");
                name = name == null ? "" : urlDecoder.decode(name, "utf-8");
                ywname = ywname == null ? "" : urlDecoder.decode(ywname, "utf-8");
                ydqd = ydqd == null ? "" : urlDecoder.decode(ydqd, "utf-8");
                isjd = isjd == null ? "" : urlDecoder.decode(isjd, "utf-8");
                type = type == null ? "" : urlDecoder.decode(type, "utf-8");
                uid = uid == null ? "" : urlDecoder.decode(uid, "utf-8");
                pd.put("startTime",startTime);
                pd.put("endTime",endTime);
                pd.put("isjd",isjob);
                pd.put("name",name);
                pd.put("ywname",ywname);
                pd.put("ydqd",ydqd);
                pd.put("isjd",isjd);
                pd.put("type",type);
                pd.put("uid",uid);
                page.setShowCount(99999999);
                page.setCurrentPage(1);
                page.setPd(pd);
                System.out.println(pd);
                List<PageData> clist = guideService.findAlllistPage(page);
                for (PageData pageData : clist) {
                    System.out.println(pageData);
                }

                HSSFWorkbook wb = new HSSFWorkbook();

                HSSFSheet sheet = wb.createSheet("业务咨询解答表");

                HSSFRow titleRow = sheet.createRow(0);
                titleRow.createCell((short) 0).setCellValue("序号");
                titleRow.createCell((short) 1).setCellValue("咨询时间");
                titleRow.createCell((short) 2).setCellValue("业务名称");
                titleRow.createCell((short) 3).setCellValue("引导渠道");
                titleRow.createCell((short) 4).setCellValue("咨询结果");
                titleRow.createCell((short) 5).setCellValue("客户名称");
                titleRow.createCell((short) 6).setCellValue("客户类型");
                System.out.println(clist);
                if (clist.size() > 0) {


                    int count = 1;
                    for (PageData pd1 : clist) {
                        HSSFRow dataRow = sheet.createRow(sheet.getLastRowNum() + 1);
                        dataRow.createCell((short) 0).setCellValue(count);
                        count++;
                        if(pd1.get("czdate") !=null)
                            dataRow.createCell((short) 1).setCellValue(df.format(df.parse(pd1.getString("czdate"))));
                        dataRow.createCell((short) 2).setCellValue(pd1.getString("ywname"));
                        dataRow.createCell((short) 3).setCellValue(pd1.getString("ydqdname"));
                        isjd = pd1.getString("isjd");
                        if("1".equals(isjd))
                            dataRow.createCell((short) 4).setCellValue("已解答");
                        if("0".equals(isjd))
                            dataRow.createCell((short) 4).setCellValue("未解答");
                        dataRow.createCell((short) 5).setCellValue(pd1.getString("tel"));
                        dataRow.createCell((short) 5).setCellValue(pd1.getString("name"));
                        if("1".equals(isjd))
                            dataRow.createCell((short) 6).setCellValue("企业");
                        if("2".equals(isjd))
                            dataRow.createCell((short) 6).setCellValue("个人");
                    }

                }

                String filename = new SimpleDateFormat("yyyyMMdd").format(new Date()) + "-Guide.xls";

                System.out.println(filename);
                response.setCharacterEncoding("UTF-8");
                response.setContentType("application/vnd.ms-excel");
                response.setHeader("Content-disposition", "attachment;filename=" + filename);
                OutputStream ouputStream = response.getOutputStream();//???
                wb.write(ouputStream); //?excel????
                ouputStream.flush();// ???
                ouputStream.close();// ???
                json.put("success", "true");
                json.put("msg", "导出成功");
            } else {
                json.put("success", "false");
                json.put("msg", "超时，请重新登陆");
            }

        } catch (Exception e) {
            json.put("success", "false");
        }
        return json.toString();
    }

    //培训机构信息导入
    @RequestMapping(value = "/readTrainExcel", produces = {"application/json;charset=UTF-8"})
    @CrossOrigin(allowedHeaders = "*", allowCredentials = "true")
    @ResponseBody()
    public String readTrainExcel(@RequestParam(value = "files", required = false) MultipartFile file, HttpServletRequest request) throws Exception {
        PageData pd = new PageData();
        JSONObject json = new JSONObject();
        try {
            PageData pd_stoken = new PageData();
            pd_stoken.put("TOKENID", request.getParameter("tokenid"));
            System.out.println(request.getParameter("tokenid"));
            PageData pd_token = zxlbService.findByTokenId(pd_stoken);
            if (pd_token != null) {
                System.out.println(file);
                if (null != file && !file.isEmpty()) {
                    SimpleDateFormat df = new SimpleDateFormat("yyyy-MM-dd HH:mm:ss");
                    String filePath = PathUtil.getClasspath() + Const.FILEPATHFILE;                                //??????
                    String fileName = FileUpload.fileUp(file, filePath, "Excel");                            //????
                    List<PageData> listPd = (List) ObjectExcelRead2.readExcel(filePath, fileName, 1, 0, 0);        //???EXCEL??,???????List 2:??3????0:??A????0:?0?sheet
                    /*???????======================================*/
                    for (int i = 0; i < listPd.size(); i++) {
                        String var1 = listPd.get(i).getString("var1");
                        String var2 = listPd.get(i).getString("var2");
                        String var3 = listPd.get(i).getString("var3");
                        String var4 = listPd.get(i).getString("var4");
                        String var5 = listPd.get(i).getString("var5");
                        String var6 = listPd.get(i).getString("var6");
                        if(     var1 == null || "".equals(var1) ||
                                var2 == null || "".equals(var2) ||
                                var3 == null || "".equals(var3) ||
                                var4 == null || "".equals(var4) ||
                                var5 == null || "".equals(var5) ) {
                            json.put("msg","有无效数据");
                            json.put("success","false");
                            continue;
                        }
                        pd.put("name", var1);
                        pd.put("addr", var2);
                        pd.put("stat", var3);
                        pd.put("principal", var4);
                        pd.put("tel", var5);
                        pd.put("tel2", var6);
                        pd.put("czman",pd_token.get("ZXYH"));
                        List<PageData> exit = trainInfoService.findExit(pd);
                        if(exit.size() < 1)
                        trainInfoService.save(pd);
                    }
                    json.put("success", "true");
                }

            } else {
                json.put("success", "false");
                json.put("msg", "导入失败");
            }
        } catch (Exception e) {
            json.put("success", "false");
        }
        return json.toString();
    }

    @RequestMapping(value = "/exportEmPersonExcel", produces = {"application/json;charset=UTF-8"})
    @CrossOrigin(allowedHeaders = "*", allowCredentials = "true")
    @ResponseBody()
    public String exportEmPersonExcel(HttpServletResponse response, HttpServletRequest request) throws Exception {

        JSONObject json = new JSONObject();
        try {
            PageData pd_stoken = new PageData();
            pd_stoken.put("TOKENID", request.getParameter("tokenid"));
            PageData pd_token = zxlbService.findByTokenId(pd_stoken);
            if (pd_token != null) {
                SimpleDateFormat df = new SimpleDateFormat("yyyy-MM-dd HH:mm:ss");
                PageData pd = new PageData();
                Page page = new Page();
                URLDecoder urlDecoder = new URLDecoder();
                String startTime = request.getParameter("startTime");
                String endTime = request.getParameter("endTime");
                if(endTime != null && !"".equals(endTime)) {
                    endTime = TimeHandle.endTimeHeandle(endTime);
                    json.put("endTime", endTime);
                }
                String isjob = request.getParameter("isjob");
                String name = request.getParameter("name");
                String pageIndex = "0";
                String pageSize = "999999999";
                startTime = startTime == null ? "" : urlDecoder.decode(startTime, "utf-8");
                endTime = endTime == null ? "" : urlDecoder.decode(endTime, "utf-8");
                isjob = isjob == null ? "" : urlDecoder.decode(isjob, "utf-8");
                name = name == null ? "" : urlDecoder.decode(name, "utf-8");
                String pageIndex1 = pageIndex == null ? "" : urlDecoder.decode(pageIndex, "utf-8");
                String pageSize1 = pageSize == null ? "" : urlDecoder.decode(pageSize, "utf-8");
                pd.put("pageIndex", pageIndex1);
                pd.put("pageSize", pageSize1);
                pd.put("startTime",startTime);
                pd.put("endTime",endTime);
                pd.put("isjd",isjob);
                pd.put("name",name);

                page.setPd(pd);
                System.out.println(pd);
                List<PageData> clist = emPersonService.findAlllistPage(page);
                for (PageData pageData : clist) {
                    System.out.println(pageData);
                }
                HSSFWorkbook wb = new HSSFWorkbook();
                HSSFSheet sheet = wb.createSheet("就业人员信息汇总表");
                HSSFRow titleRow = sheet.createRow(0);
                titleRow.createCell((short) 0).setCellValue("序号");
                titleRow.createCell((short) 1).setCellValue("求职时间");
                titleRow.createCell((short) 2).setCellValue("姓名");
                titleRow.createCell((short) 3).setCellValue("性别");
                titleRow.createCell((short) 4).setCellValue("联系电话");
                titleRow.createCell((short) 5).setCellValue("学历");
                titleRow.createCell((short) 6).setCellValue("岗位性质");
                titleRow.createCell((short) 7).setCellValue("岗位名称");
                titleRow.createCell((short) 8).setCellValue("推荐企业数量");
                titleRow.createCell((short) 9).setCellValue("就职单位名称");
                titleRow.createCell((short) 10).setCellValue("回访结果");
                titleRow.createCell((short) 11).setCellValue("更新时间");
                System.out.println(clist);
                if (clist.size() > 0) {


                    int count = 1;
                    for (PageData pd1 : clist) {
                        HSSFRow dataRow = sheet.createRow(sheet.getLastRowNum() + 1);
                        dataRow.createCell((short) 0).setCellValue(count);
                        count++;
                        if(pd1.get("qzdate") !=null)
                            dataRow.createCell((short) 1).setCellValue(df.format(df.parse(pd1.getString("qzdate"))));
                        dataRow.createCell((short) 2).setCellValue(pd1.getString("name"));
                        String sex = pd1.getString("sex");
                        if("1".equals(sex)) {
                            dataRow.createCell((short) 3).setCellValue("男");
                        }
                        if("2".equals(sex)){
                            dataRow.createCell((short) 3).setCellValue("女");
                        }
                        dataRow.createCell((short) 4).setCellValue(pd1.getString("tel"));
                        dataRow.createCell((short) 5).setCellValue(pd1.getString("xlname"));
                        dataRow.createCell((short) 6).setCellValue(pd1.getString("jobtypename"));
                        dataRow.createCell((short) 7).setCellValue(pd1.getString("jobname"));
                        Object tjcount = pd1.get("tjcount");
                        Integer tjcountint = Integer.valueOf(tjcount.toString());
                        dataRow.createCell((short) 8).setCellValue(tjcountint.toString());
                        dataRow.createCell((short) 9).setCellValue(pd1.getString("jobunit"));
                        String result = pd1.getString("result");
                        if("0".equals(result))
                            dataRow.createCell((short) 10).setCellValue("未回访");
                        if("1".equals(result))
                            dataRow.createCell((short) 10).setCellValue("已回访");
                        if( pd1.get("cztime") !=null)
                            dataRow.createCell((short) 11).setCellValue(df.format(df.parse(pd1.getString("cztime"))));

                    }

                }
                // ????????Excel???
                String filename = new SimpleDateFormat("yyyyMMdd").format(new Date()) + "-EmPeople.xls";
                //???????
                System.out.println(filename);
                response.setCharacterEncoding("UTF-8");
                response.setContentType("application/vnd.ms-excel");
                response.setHeader("Content-disposition", "attachment;filename=" + filename);
                OutputStream ouputStream = response.getOutputStream();//???
                wb.write(ouputStream); //?excel????
                ouputStream.flush();// ???
                ouputStream.close();// ???
                json.put("success", "true");
                json.put("msg", "导出成功");
            } else {
                json.put("success", "false");
                json.put("msg", "超时，请重新登陆");
            }

        } catch (Exception e) {
            json.put("success", "false");
        }
        return json.toString();
    }


    //线上就业回访导出
    @RequestMapping(value = "/exportsignExcel", produces = {"application/json;charset=UTF-8"})
    @CrossOrigin(allowedHeaders = "*", allowCredentials = "true")
    @ResponseBody()
    public String exportsignExcel(HttpServletResponse response, HttpServletRequest request) throws Exception {

        JSONObject json = new JSONObject();
        try {
            PageData pd_stoken = new PageData();
            pd_stoken.put("TOKENID", request.getParameter("tokenid"));
            PageData pd_token = zxlbService.findByTokenId(pd_stoken);
            if (pd_token != null) {
                PageData pd = new PageData();

                System.out.println(pd);
                List<PageData> clist = trainrecoService.exportsign(pd);
                System.out.println(clist);
                //创建excel文件
                HSSFWorkbook wb = new HSSFWorkbook();
                //创建sheet页
                HSSFSheet sheet = wb.createSheet("线上报名回访");
                //创建标题行
                HSSFRow titleRow = sheet.createRow(0);
                titleRow.createCell((short) 0).setCellValue("提交时间");
                titleRow.createCell((short) 1).setCellValue("姓名");
                titleRow.createCell((short) 2).setCellValue("性别");
                titleRow.createCell((short) 3).setCellValue("联系电话");
                titleRow.createCell((short) 4).setCellValue("学历");
                titleRow.createCell((short) 5).setCellValue("报名企业");
                titleRow.createCell((short) 6).setCellValue("报名岗位(汇总)");
                titleRow.createCell((short) 7).setCellValue("招聘工种");
                titleRow.createCell((short) 8).setCellValue("企业联系人");
                titleRow.createCell((short) 9).setCellValue("企业备用联系人");
                titleRow.createCell((short) 10).setCellValue("联系电话1");
                titleRow.createCell((short) 11).setCellValue("联系电话2");
                if (clist.size() > 0) {

                    for (PageData pd1 : clist) {
                        HSSFRow dataRow = sheet.createRow(sheet.getLastRowNum() + 1);
                        dataRow.createCell((short) 0).setCellValue(pd1.get("czdate").toString());
                        dataRow.createCell((short) 1).setCellValue(pd1.getString("pname"));
                        String sex = pd1.getString("sex");
                        if("1".equals(sex)) {
                            sex="男";
                        }
                        if("2".equals(sex)){
                            sex="女";
                        }
                        dataRow.createCell((short) 2).setCellValue(sex);
                        dataRow.createCell((short) 3).setCellValue(pd1.getString("plxtel"));
                        dataRow.createCell((short) 4).setCellValue(pd1.getString("xlname"));
                        dataRow.createCell((short) 5).setCellValue(pd1.getString("cname"));
                        dataRow.createCell((short) 6).setCellValue(pd1.getString("signupjob"));
                        dataRow.createCell((short) 7).setCellValue(pd1.getString("jobnamename"));
                        dataRow.createCell((short) 8).setCellValue(pd1.getString("clxr"));
                        dataRow.createCell((short) 9).setCellValue(pd1.getString("cbylxr"));
                        dataRow.createCell((short) 10).setCellValue(pd1.getString("clxtel"));
                        dataRow.createCell((short) 11).setCellValue(pd1.getString("cbylxtel"));
                    }

                }
                // 设置下载时客户端Excel的名称
                String filename = new SimpleDateFormat("yyyyMMdd").format(new Date()) + "-xsbmhf.xls";
                //设置下载的文件
                System.out.println(filename);
                response.setCharacterEncoding("UTF-8");
                response.setContentType("application/vnd.ms-excel");
                response.setHeader("Content-disposition", "attachment;filename=" + filename);
                OutputStream ouputStream = response.getOutputStream();//打开流
                wb.write(ouputStream); //在excel内写入流
                ouputStream.flush();// 刷新流
                ouputStream.close();// 关闭流

            } else {
                json.put("success", "false");
                json.put("msg", "登录超时，请重新登录");
            }

        } catch (Exception e) {
            json.put("success", "false");
        }
        return json.toString();
    }

    //线上就业回访导人
    @RequestMapping(value = "/readsignExcel", produces = {"application/json;charset=UTF-8"})
    @CrossOrigin(allowedHeaders = "*", allowCredentials = "true")
    @ResponseBody()
    public String readsignExcel(@RequestParam(value = "files", required = false) MultipartFile file, HttpServletRequest request) throws Exception {
        PageData pd = new PageData();
        JSONObject json = new JSONObject();
        try {
            PageData pd_stoken = new PageData();
            pd_stoken.put("TOKENID", request.getParameter("tokenid"));
            System.out.println(request.getParameter("tokenid"));
            PageData pd_token = zxlbService.findByTokenId(pd_stoken);
            String zxyh = pd_stoken.getString("zxyh");
            if (pd_token != null) {
                if (null != file && !file.isEmpty()) {
                    String filePath = PathUtil.getClasspath() + Const.FILEPATHFILE;                                //文件上传路径
                    String fileName = FileUpload.fileUp(file, filePath, "ComExcel");                            //执行上传
                    List<PageData> listPd = (List) ObjectExcelRead2.readExcel(filePath, fileName, 1, 0, 0);        //执行读EXCEL操作,读出的数据导入List 2:从第3行开始；0:从第A列开始；0:第0个sheet
                    /*检查字段操作======================================*/
                    boolean check = true;
                    String str = "";
                    for (int i = 0; i < listPd.size(); i++) {
                        String var1 = listPd.get(i).getString("var1");
                        String var3 = listPd.get(i).getString("var3");
                        String var5 = listPd.get(i).getString("var5");
                        String var7 = listPd.get(i).getString("var7");
                        String var8 = listPd.get(i).getString("var8");
                        String var10 = listPd.get(i).getString("var10");
                        if ("".equals(var1)) {
                            check = false;
                            str = str + "姓名不能为空;";
                            break;
                        } else if ("".equals(var3)) {
                            check = false;
                            //StringUtils.isnu
                            str = str + "联系电话不能为空;";
                            break;
                        }else if ("".equals(var5)) {
                            check = false;
                            str = str + "报名企业不能为空;";
                            break;
                        }else if ("".equals(var7)) {
                            check = false;
                            str = str + "招聘工种不能为空;";
                            break;
                        }else if ("".equals(var8)) {
                            check = false;
                            str = str + "企业联系人不能为空;";
                            break;
                        }else if ("".equals(var10)) {
                            check = false;
                            str = str + "联系电话不能为空;";
                            break;
                        }
                    }
                    System.out.println(listPd);
                    /*存入数据库操作======================================*/
                    if (check == true) {
                        for (int i = 0; i < listPd.size(); i++) {
                            PageData pd4 = new PageData();
                            String var1 = listPd.get(i).getString("var1").trim();
                            String var3 = listPd.get(i).getString("var3").trim();
                            pd4.put("tel", var3);
                            pd4.put("name", var1);
                            List<PageData> findperson = jobReferManager.findperson(pd4);
                            String puuid="";

                            if (findperson.isEmpty()){
                                PageData pageData = new PageData();
                                pageData.put("name",listPd.get(i).getString("var1"));
                                String var2 = listPd.get(i).getString("var2");
                                if ("男".equals(var2)){
                                    var2="1";
                                }else if ("女".equals(var2)){
                                    var2="2";
                                }
                                pageData.put("sex", var2);
                                pageData.put("tel", listPd.get(i).getString("var3"));
                                pageData.put("lxtel", listPd.get(i).getString("var3"));
                                String var4 = listPd.get(i).getString("var4").trim();
                                System.out.println(var4+"var4");
                                PageData pd1 = new PageData();
                                pd1.put("name",var4);
                                PageData dic1 = consumerManager.getDIC(pd1);
                                if (dic1!=null){
                                    pageData.put("xl", dic1.getString("DICTIONARIES_ID"));
                                }else {
//                                    str = str + "查无此学历;";
//                                    json.put("msg", str);
//                                    break;
                                    pageData.put("xl", "暂无");
                                }
                                puuid = getUUID32();
                                pageData.put("uid",puuid);
                                pageData.put("isimpot", "1");
                                pageData.put("czdate", getTime());
                                pageData.put("czman", zxyh);
                                jobReferManager.insertperson(pageData);
                            }else {
                                for (PageData pageData : findperson) {
                                    puuid=pageData.getString("uid");
                                    System.out.println(pageData);
                                }
                            }


                            PageData pd3 = new PageData();
                            String var5 = listPd.get(i).getString("var5").trim();
                            String var9 = listPd.get(i).getString("var9").trim();
                            pd3.put("tel", var9);
                            pd3.put("name", var5);
                            List<PageData> findcompany = consumerManager.findcompany(pd3);
                            String cuuid="";

                            if (findcompany.isEmpty()){
                                PageData pageData1 = new PageData();
                                pageData1.put("name",listPd.get(i).getString("var5"));
                                pageData1.put("lxr",listPd.get(i).getString("var8"));
                                pageData1.put("bylxr",listPd.get(i).getString("var9"));

                                pageData1.put("tel",listPd.get(i).getString("var10"));
                                pageData1.put("lxtel",listPd.get(i).getString("var10"));
                                pageData1.put("bylxtel",listPd.get(i).getString("var11"));
                                cuuid = getUUID32();
                                pageData1.put("uid",cuuid);
                                pageData1.put("isimpot", "1");
                                pageData1.put("czdate", getTime());
                                pageData1.put("czman", zxyh);
                                consumerManager.insertcompany(pageData1);
                            }else {
                                for (PageData data : findcompany) {
                                    cuuid = data.getString("uid");
                                    System.out.println(data);
                                }
                            }


                            PageData pageData2 = new PageData();
                            pageData2.put("czdate", listPd.get(i).getString("var0"));
                            pageData2.put("signupjob", listPd.get(i).getString("var6"));
                            String var7 = listPd.get(i).getString("var7").trim();
                            PageData pd2 = new PageData();
                            pd2.put("gwflname",var7);
                            PageData getjobtype = consumerManager.getjobtype(pd2);
                            if (getjobtype!=null){
                                pageData2.put("jobname",Integer.parseInt(getjobtype.get("code").toString()));
                            }else {
                                pageData2.put("jobname","暂无");
                            }
                            pageData2.put("puid", puuid);
                            pageData2.put("cuid", cuuid);
                            pageData2.put("isjob", "0");

                            pageData2.put("uid", getUUID32());

                            trainrecoService.insertsignup(pageData2);

                        }
                        json.put("success", "true");
                    } else if (check == false) {
                        json.put("msg", str);
                    }

                }

            } else {
                json.put("success", "false");
                json.put("msg", "登录超时，请重新登录");
            }
        } catch (Exception e) {
            json.put("success", "false");
        }
        return json.toString();
    }


    //回访信息导出
    @RequestMapping(value = "/exportrevrecordExcel", produces = {"application/json;charset=UTF-8"})
    @CrossOrigin(allowedHeaders = "*", allowCredentials = "true")
    @ResponseBody()
    public String exportrevrecordExcel(HttpServletResponse response, HttpServletRequest request) throws Exception {

        JSONObject json = new JSONObject();
        try {
            PageData pd_stoken = new PageData();
            pd_stoken.put("TOKENID", request.getParameter("tokenid"));
            PageData pd_token = zxlbService.findByTokenId(pd_stoken);
            if (pd_token != null) {
                PageData pd = new PageData();
                pd.put("cate", request.getParameter("cate"));
                pd.put("starttime", request.getParameter("starttime"));
                pd.put("endtime", request.getParameter("endtime"));
                pd.put("keywords", request.getParameter("keywords"));
                pd.put("isjt", request.getParameter("isjt"));
                System.out.println(pd);
                List<PageData> clist = revrecordManager.findrevrecord(pd);
                System.out.println(clist);
                //创建excel文件
                HSSFWorkbook wb = new HSSFWorkbook();
                //创建sheet页
                HSSFSheet sheet = wb.createSheet("回访信息");
                //创建标题行
                HSSFRow titleRow = sheet.createRow(0);
                titleRow.createCell((short) 0).setCellValue("回访时间");
                titleRow.createCell((short) 1).setCellValue("联系电话");
                titleRow.createCell((short) 2).setCellValue("客户名称");
                titleRow.createCell((short) 3).setCellValue("客户类型");
                titleRow.createCell((short) 4).setCellValue("任务类型");
                titleRow.createCell((short) 5).setCellValue("回访结果");
                titleRow.createCell((short) 6).setCellValue("服务坐席");
                titleRow.createCell((short) 7).setCellValue("备注");
                if (clist.size() > 0) {

                    for (PageData pd1 : clist) {
                        HSSFRow dataRow = sheet.createRow(sheet.getLastRowNum() + 1);
                        dataRow.createCell((short) 0).setCellValue(pd1.getString("kssj"));
                        dataRow.createCell((short) 1).setCellValue(pd1.getString("zjhm"));
                        dataRow.createCell((short) 2).setCellValue(pd1.getString("name"));
                        dataRow.createCell((short) 3).setCellValue(pd1.getString("catename"));
                        String tasktype = pd1.getString("tasktype");
                        if (tasktype.equals("0")) {
                            tasktype="就业回访";
                        }else if (tasktype.equals("1")){
                            tasktype="线上报名";
                        }else if (tasktype.equals("2")){
                            tasktype="未接来电";
                        }else if (tasktype.equals("3")){
                            tasktype="留言";
                        }
                        dataRow.createCell((short) 4).setCellValue(tasktype);
                        String result = pd1.getString("result");
                        if (result.equals("0")) {
                            result="未完成";
                        }else if (result.equals("1")){
                            result="已完成";
                        }
                        dataRow.createCell((short) 5).setCellValue(result);
                        dataRow.createCell((short) 6).setCellValue(pd1.getString("zxxm"));
                        dataRow.createCell((short) 7).setCellValue(pd1.getString("remark"));
                    }

                }
                // 设置下载时客户端Excel的名称
                String filename = new SimpleDateFormat("yyyyMMdd").format(new Date()) + "-xsbmhf.xls";
                //设置下载的文件
                System.out.println(filename);
                response.setCharacterEncoding("UTF-8");
                response.setContentType("application/vnd.ms-excel");
                response.setHeader("Content-disposition", "attachment;filename=" + filename);
                OutputStream ouputStream = response.getOutputStream();//打开流
                wb.write(ouputStream); //在excel内写入流
                ouputStream.flush();// 刷新流
                ouputStream.close();// 关闭流

            } else {
                json.put("success", "false");
                json.put("msg", "登录超时，请重新登录");
            }

        } catch (Exception e) {
            json.put("success", "false");
        }
        return json.toString();
    }

    //其他人员信息导入
    @RequestMapping(value = "/readOtherPersonExcel", produces = {"application/json;charset=UTF-8"})
    @CrossOrigin(allowedHeaders = "*", allowCredentials = "true")
    @ResponseBody()
    public String readOtherPersonExcel(@RequestParam(value = "files", required = false) MultipartFile file, HttpServletRequest request) throws Exception {
        PageData pd = new PageData();
        JSONObject json = new JSONObject();
        try {
            PageData pd_stoken = new PageData();
            pd_stoken.put("TOKENID", request.getParameter("tokenid"));
            System.out.println(request.getParameter("tokenid"));
            PageData pd_token = zxlbService.findByTokenId(pd_stoken);
            if (pd_token != null) {
                System.out.println(file);
                if (null != file && !file.isEmpty()) {
                    SimpleDateFormat df = new SimpleDateFormat("yyyy-MM-dd HH:mm:ss");
                    String filePath = PathUtil.getClasspath() + Const.FILEPATHFILE;
                    String fileName = FileUpload.fileUp(file, filePath, "Excel");
                    List<PageData> listPd = (List) ObjectExcelRead2.readExcel(filePath, fileName, 1, 0, 0);        //???EXCEL??,???????List 2:??3????0:??A????0:?0?sheet

                    //关键字段判断
                    for (int i = 0; i < listPd.size(); i++) {
                        String var0 = listPd.get(i).getString("var0");
                        String var3 = listPd.get(i).getString("var3");
                        if (var0 == null || "".equals(var0) ||
                                var3 == null || "".equals(var3)) {
                            json.put("mesg", "表格中有无效数据");
                            json.put("success", "false");
                            return json.toString();
                        }
                    }
                    for (int i = 0; i < listPd.size(); i++) {
                        String var0 = listPd.get(i).getString("var0");
                        String var1 = listPd.get(i).getString("var1");
                        String var2 = listPd.get(i).getString("var2");
                        String var3 = listPd.get(i).getString("var3");
                        String var4 = listPd.get(i).getString("var4");
                        String var5 = listPd.get(i).getString("var5");
                        String var7 = listPd.get(i).getString("var7");
                        String var8 = listPd.get(i).getString("var8");
                        String var9 = listPd.get(i).getString("var9");
                        String var10 = listPd.get(i).getString("var10");
                        pd.put("name", var0);
                        if(var1.equals("男"))
                            pd.put("sex", "1");
                        if(var1.equals("女"))
                            pd.put("sex","2");
                        pd.put("cardid", var2);
                        pd.put("tel", var3);
                        pd.put("lxtel", var3);
                        pd.put("age", var4);
                        pd.put("jg", var5);
                        if(var7.equals("已就业"))
                            pd.put("isjob","1");
                        if(var7.equals("未就业")){
                            pd.put("isjob","0");
                        }
                        pd.put("email", var8);
                        pd.put("xl", var9);
                        pd.put("zy", var10);
                        System.out.println(pd);
                        otherPersonService.save(pd);

                    }
                    json.put("success", "true");
                }

            } else {
                json.put("success", "false");
                json.put("msg", "请重新登陆");
            }
        } catch (Exception e) {
            json.put("success", "false");
        }
        return json.toString();
    }




    //其他服务导出
    @RequestMapping(value = "/exportOtherServiceExcel", produces = {"application/json;charset=UTF-8"})
    @CrossOrigin(allowedHeaders = "*", allowCredentials = "true")
    @ResponseBody()
    public String exportOtherServiceExcel(HttpServletResponse response, HttpServletRequest request) throws Exception {

        JSONObject json = new JSONObject();
        try {
            PageData pd_stoken = new PageData();
            pd_stoken.put("TOKENID", request.getParameter("tokenid"));
            PageData pd_token = zxlbService.findByTokenId(pd_stoken);
            if (pd_token != null) {
                SimpleDateFormat df = new SimpleDateFormat("yyyy-MM-dd HH:mm:ss");
                PageData pd = new PageData();
                Page page = new Page();
                URLDecoder urlDecoder = new URLDecoder();
                String startTime = request.getParameter("startTime");
                String endTime = request.getParameter("endTime");
                if(endTime != null && !"".equals(endTime)) {
                    endTime = TimeHandle.endTimeHeandle(endTime);
                    json.put("endTime", endTime);
                }
                String fwname = request.getParameter("fwname");
                String fwtype = request.getParameter("fwtype");
                String name = request.getParameter("name");
                String type = request.getParameter("type");
                startTime = startTime == null ? "" : urlDecoder.decode(startTime, "utf-8");
                type = type == null ? "" : urlDecoder.decode(type, "utf-8");
                endTime = endTime == null ? "" : urlDecoder.decode(endTime, "utf-8");
                name = name == null ? "" : urlDecoder.decode(name, "utf-8");
                fwname = fwname == null ? "" : urlDecoder.decode(fwname, "utf-8");
                fwtype = fwtype == null ? "" : urlDecoder.decode(fwtype, "utf-8");
                page.setShowCount(99999999);
                page.setCurrentPage(1);
                pd.put("startTime",startTime);
                pd.put("endTime",endTime);
                pd.put("fwtype",fwtype);
                pd.put("fwname",fwname);
                pd.put("name",name);
                pd.put("type",type);
                page.setPd(pd);
                System.out.println(pd);
                List<PageData> clist = otherServiceService.findAlllistPage(page);

                HSSFWorkbook wb = new HSSFWorkbook();

                HSSFSheet sheet = wb.createSheet("政策咨询记录");

                HSSFRow titleRow = sheet.createRow(0);
                titleRow.createCell((short) 0).setCellValue("序号");
                titleRow.createCell((short) 1).setCellValue("咨询时间");
                titleRow.createCell((short) 2).setCellValue("政策名称");
                titleRow.createCell((short) 3).setCellValue("咨询类别");
                titleRow.createCell((short) 4).setCellValue("咨询结果");
                titleRow.createCell((short) 5).setCellValue("客户名称");
                titleRow.createCell((short) 6).setCellValue("客户类型");
                System.out.println(clist);
                if (clist.size() > 0) {


                    int count = 1;
                    for (PageData pd1 : clist) {
                        HSSFRow dataRow = sheet.createRow(sheet.getLastRowNum() + 1);
                        dataRow.createCell((short) 0).setCellValue(count++);
                        dataRow.createCell((short) 1).setCellValue(df.format(df.parse(pd1.getString("czdate"))));
                        dataRow.createCell((short) 2).setCellValue(pd1.getString("fwname"));
                        dataRow.createCell((short) 3).setCellValue(pd1.getString("fwtypename"));
                        dataRow.createCell((short) 4).setCellValue(pd1.getString("cljg"));
                        dataRow.createCell((short) 5).setCellValue(pd1.getString("name"));
                        type = pd1.getString("type");
                        if("1".equals(type))
                            dataRow.createCell((short) 6).setCellValue("企业");
                        if("2".equals(type))
                            dataRow.createCell((short) 6).setCellValue("个人");
                    }

                }
                String filename = new SimpleDateFormat("yyyyMMdd").format(new Date()) + "-otherService.xls";
                System.out.println(filename);
                response.setCharacterEncoding("UTF-8");
                response.setContentType("application/vnd.ms-excel");
                response.setHeader("Content-disposition", "attachment;filename=" + filename);
                OutputStream ouputStream = response.getOutputStream();
                wb.write(ouputStream);
                ouputStream.flush();
                ouputStream.close();
                json.put("success", "true");
                json.put("msg", "导出成功");
            } else {
                json.put("success", "false");
                json.put("msg", "超时，请重新登陆");
            }

        } catch (Exception e) {
            json.put("success", "false");
        }
        return json.toString();
    }
    public String getTime() {
        Date date = new Date();
        SimpleDateFormat dateFormat = new SimpleDateFormat("yyyy-MM-dd HH:mm:ss");
        return dateFormat.format(date);
    }

}
