package com.yulun.controller.common;

import com.alibaba.fastjson.JSONObject;
import com.fh.controller.base.BaseController;
import com.fh.entity.Page;
import com.fh.util.*;
import com.xxgl.service.mng.ZxlbManager;
import com.yulun.service.*;
import org.apache.http.HttpRequest;
import org.apache.http.HttpResponse;
import org.apache.poi.hssf.usermodel.HSSFRow;
import org.apache.poi.hssf.usermodel.HSSFSheet;
import org.apache.poi.hssf.usermodel.HSSFWorkbook;
import org.springframework.stereotype.Controller;
import org.springframework.web.bind.annotation.CrossOrigin;
import org.springframework.web.bind.annotation.RequestMapping;
import org.springframework.web.bind.annotation.RequestParam;
import org.springframework.web.bind.annotation.ResponseBody;
import org.springframework.web.multipart.MultipartFile;

import javax.annotation.Resource;
import javax.servlet.http.HttpServletRequest;
import javax.servlet.http.HttpServletResponse;
import java.io.OutputStream;
import java.net.URLDecoder;
import java.text.SimpleDateFormat;
import java.util.Date;
import java.util.List;
import java.util.UUID;


@Controller
@CrossOrigin(allowedHeaders = "*", allowCredentials = "true")
@RequestMapping(value = "/api")
public class ExcelController extends BaseController {

    @Resource(name = "commnoService")
    private CommnoManager commnoManager;

    @Resource(name = "vipInfoService")
    private VipInfoManager vipInfoManager;

    @Resource(name = "zxlbService")
    private ZxlbManager zxlbService;

    @Resource(name = "consumerService")
    private ConsumerManager consumerManager;

    @Resource(name = "jobReferService")
    private JobReferManager jobReferManager;

    @Resource(name = "msgTempService")
    private MsgTempManager msgTempManager;

    /**
     * 导入用户信息到EXCEL
     *
     * @return
     * @throws Exception
     */
    @RequestMapping(value = "/app_readComExcel")
    @CrossOrigin(allowedHeaders = "*", allowCredentials = "true")
    @ResponseBody()
    public String readComExcel(@RequestParam(value = "files", required = false) MultipartFile file, HttpServletRequest request) throws Exception {
        PageData pd = new PageData();
        JSONObject json = new JSONObject();
        try {
            PageData pd_stoken = new PageData();
            pd_stoken.put("TOKENID", request.getParameter("tokenid"));
            System.out.println(request.getParameter("tokenid"));
            PageData pd_token = zxlbService.findByTokenId(pd_stoken);
            if (pd_token != null) {
                if (null != file && !file.isEmpty()) {
                    String filePath = PathUtil.getClasspath() + Const.FILEPATHFILE;                                //文件上传路径
                    String fileName = FileUpload.fileUp(file, filePath, "ComExcel");                            //执行上传
                    List<PageData> listPd = (List) ObjectExcelRead.readExcel(filePath, fileName, 2, 0, 0);        //执行读EXCEL操作,读出的数据导入List 2:从第3行开始；0:从第A列开始；0:第0个sheet
                    /*存入数据库操作======================================*/
                    for (int i = 0; i < listPd.size(); i++) {
                        pd.put("name", listPd.get(i).getString("var1"));
                        pd.put("phone", listPd.get(i).getString("var2"));
                        pd.put("age", listPd.get(i).getString("var3"));
                        pd.put("sex", listPd.get(i).getString("var4"));
                        pd.put("cardtype", listPd.get(i).getString("var5"));
                        pd.put("idcard", listPd.get(i).getString("var6"));
                        pd.put("address", listPd.get(i).getString("var7"));
                        commnoManager.insertCommon(pd);

                    }
                    json.put("success", "true");
                }

            } else {
                json.put("success", "false");
                json.put("msg", "登录超时，请重新登录");
            }
        } catch (Exception e) {
            json.put("success", "false");
        }
        return json.toString();
    }

    /**
     * 导入用户信息到EXCEL
     *
     * @return
     * @throws Exception
     */
    @RequestMapping(value = "/app_readVipExcel")
    @CrossOrigin(allowedHeaders = "*", allowCredentials = "true")
    @ResponseBody()
    public String readVipExcel(@RequestParam(value = "files", required = false) MultipartFile file, HttpServletRequest request) throws Exception {
        PageData pd = new PageData();
        JSONObject json = new JSONObject();
        try {
            PageData pd_stoken = new PageData();
            pd_stoken.put("TOKENID", request.getParameter("tokenid"));
            PageData pd_token = zxlbService.findByTokenId(pd_stoken);
            if (pd_token != null) {

                if (null != file && !file.isEmpty()) {
                    String filePath = PathUtil.getClasspath() + Const.FILEPATHFILE;                                //文件上传路径
                    String fileName = FileUpload.fileUp(file, filePath, "VipExcel");                            //执行上传
                    List<PageData> listPd = (List) ObjectExcelRead.readExcel(filePath, fileName, 2, 0, 0);        //执行读EXCEL操作,读出的数据导入List 2:从第3行开始；0:从第A列开始；0:第0个sheet
                    /*存入数据库操作======================================*/
                    for (int i = 0; i < listPd.size(); i++) {
                        pd.put("id", getUUID32());
                        pd.put("name", listPd.get(i).getString("var1"));
                        pd.put("sex", listPd.get(i).getString("var2"));
                        pd.put("idcard", listPd.get(i).getString("var3"));
                        pd.put("recepdep", listPd.get(i).getString("var4"));
                        pd.put("clevel", listPd.get(i).getString("var5"));
                        pd.put("birthday", listPd.get(i).getString("var6"));
                        pd.put("position", listPd.get(i).getString("var7"));
                        pd.put("place", listPd.get(i).getString("var8"));
                        pd.put("waiter", listPd.get(i).getString("var9"));
                        pd.put("isimport", listPd.get(i).getString("var10"));
                        pd.put("isusecard", listPd.get(i).getString("var11"));
                        pd.put("ortherinfo", listPd.get(i).getString("var12"));
                        pd.put("ctype", listPd.get(i).getString("var13"));
                        pd.put("favorite", listPd.get(i).getString("var14"));
                        pd.put("result", listPd.get(i).getString("var15"));
                        vipInfoManager.insertVipInfo(pd);

                    }
                    json.put("success", "true");
                }
            } else {
                json.put("success", "false");
                json.put("msg", "登录超时，请重新登录");
            }


        } catch (Exception e) {
            json.put("success", "false");
        }
        return json.toString();
    }

    @RequestMapping(value = "/downComExcel")
    @CrossOrigin(allowedHeaders = "*", allowCredentials = "true")
    @ResponseBody()
    public void downComExcel(HttpServletResponse response) throws Exception {
        FileDownload.fileDownload(response, PathUtil.getClasspath() + Const.FILEPATHFILE + "ComExcel.xls", "ComExcel.xls");
    }

    @RequestMapping(value = "/downVipExcel")
    @CrossOrigin(allowedHeaders = "*", allowCredentials = "true")
    @ResponseBody()
    public void downVipExcel(HttpServletResponse response) throws Exception {
        FileDownload.fileDownload(response, PathUtil.getClasspath() + Const.FILEPATHFILE + "VipExcel.xls", "VipExcel.xls");
    }

    public String getUUID32() {
        String uuid = UUID.randomUUID().toString();
        uuid = uuid.replace("-", "");
        return uuid;
    }


    /**
     * 导出到Excel
     */
    @RequestMapping("/app_exportComExcel")
    @CrossOrigin(allowedHeaders = "*", allowCredentials = "true")
    @ResponseBody()
    public String exportExcel(HttpServletResponse response, HttpServletRequest request) throws Exception {

        JSONObject json = new JSONObject();
        try {
            PageData pd_stoken = new PageData();
            pd_stoken.put("TOKENID", request.getParameter("tokenid"));
            PageData pd_token = zxlbService.findByTokenId(pd_stoken);
            if (pd_token != null) {
                PageData pd = new PageData();
                Page page = new Page();
                URLDecoder urlDecoder = new URLDecoder();
                String name = pd.getString("name");
                String phone = pd.getString("phone");
                String idcard = pd.getString("idcard");
                String type = pd.getString("type");
                String keywords = pd.getString("keywords");
                String pageIndex = pd.getString("pageIndex");
                String pageSize = pd.getString("pageSize");
                String name1 = name == null ? "" : urlDecoder.decode(name, "utf-8");
                String phone1 = name == null ? "" : urlDecoder.decode(phone, "utf-8");
                String idcard1 = name == null ? "" : urlDecoder.decode(idcard, "utf-8");
                String type1 = name == null ? "" : urlDecoder.decode(type, "utf-8");
                String keywords1 = name == null ? "" : urlDecoder.decode(keywords, "utf-8");
                String pageIndex1 = name == null ? "" : urlDecoder.decode(pageIndex, "utf-8");
                String pageSize1 = name == null ? "" : urlDecoder.decode(pageSize, "utf-8");
                pd.put("name", name1);
                pd.put("phone", phone1);
                pd.put("idcard", idcard1);
                pd.put("type", type1);
                pd.put("keywords", keywords1);
                pd.put("pageIndex", pageIndex1);
                pd.put("pageSize", pageSize1);
                page.setPd(pd);
                System.out.println(pd);
                List<PageData> clist = commnoManager.findAlllistPage(page);
                System.out.println(clist);
                if (clist.size() > 0) {
                    //创建excel文件
                    HSSFWorkbook wb = new HSSFWorkbook();
                    //创建sheet页
                    HSSFSheet sheet = wb.createSheet("普客信息记录");
                    //创建标题行
                    HSSFRow titleRow = sheet.createRow(0);
                    titleRow.createCell((short) 0).setCellValue("客户姓名");
                    titleRow.createCell((short) 1).setCellValue("客户电话");
                    titleRow.createCell((short) 2).setCellValue("年龄");
                    titleRow.createCell((short) 3).setCellValue("性别");
                    titleRow.createCell((short) 4).setCellValue("证件类型");
                    titleRow.createCell((short) 5).setCellValue("证件号码");
                    titleRow.createCell((short) 6).setCellValue("所在区域");
                    for (PageData pd1 : clist) {
                        HSSFRow dataRow = sheet.createRow(sheet.getLastRowNum() + 1);
                        dataRow.createCell((short) 0).setCellValue(pd1.getString("name"));
                        dataRow.createCell((short) 1).setCellValue(pd1.getString("phone"));
                        dataRow.createCell((short) 2).setCellValue(pd1.getString("age"));
                        dataRow.createCell((short) 3).setCellValue(pd1.getString("sex"));
                        dataRow.createCell((short) 4).setCellValue(pd1.getString("cardtype"));
                        dataRow.createCell((short) 5).setCellValue(pd1.getString("idcard"));
                        dataRow.createCell((short) 6).setCellValue(pd1.getString("address"));
                    }
                    // 设置下载时客户端Excel的名称
                    String filename = new SimpleDateFormat("yyyyMMdd").format(new Date()) + "-CUSTINFO.xls";
                    //设置下载的文件
                    System.out.println(filename);
                    response.setCharacterEncoding("UTF-8");
                    response.setContentType("application/vnd.ms-excel");
                    response.setHeader("Content-disposition", "attachment;filename=" + filename);
                    OutputStream ouputStream = response.getOutputStream();//打开流
                    wb.write(ouputStream); //在excel内写入流
                    ouputStream.flush();// 刷新流
                    ouputStream.close();// 关闭流
                }

            } else {
                json.put("success", "false");
                json.put("msg", "登录超时，请重新登录");
            }

        } catch (Exception e) {
            json.put("success", "false");
        }
        return json.toString();
    }

    @RequestMapping(value = "/exportgraduateExcel", produces = {"application/json;charset=UTF-8"})
    @CrossOrigin(allowedHeaders = "*", allowCredentials = "true")
    @ResponseBody()
    public String exportgraduateExcel(HttpServletResponse response, HttpServletRequest request) throws Exception {

        JSONObject json = new JSONObject();
        try {
            PageData pd_stoken = new PageData();
            pd_stoken.put("TOKENID", request.getParameter("tokenid"));
            PageData pd_token = zxlbService.findByTokenId(pd_stoken);
            if (pd_token != null) {
                PageData pd = new PageData();
                Page page = new Page();
                URLDecoder urlDecoder = new URLDecoder();
                String jobtype = pd.getString("jobtype");
                String starttime = pd.getString("starttime");
                String endtime = pd.getString("endtime");
                String pageIndex = "0";
                String pageSize = "999999999";
                String jobtype1 = jobtype == null ? "" : urlDecoder.decode(jobtype, "utf-8");
                String starttime1 = starttime == null ? "" : urlDecoder.decode(starttime, "utf-8");
                String endtime1 = endtime == null ? "" : urlDecoder.decode(endtime, "utf-8");

                String pageIndex1 = pageIndex == null ? "" : urlDecoder.decode(pageIndex, "utf-8");
                String pageSize1 = pageSize == null ? "" : urlDecoder.decode(pageSize, "utf-8");
                pd.put("jobtype", jobtype1);
                pd.put("starttime", starttime1);
                pd.put("endtime", endtime1);
                pd.put("pageIndex", pageIndex1);
                pd.put("pageSize", pageSize1);
                page.setPd(pd);
                System.out.println(pd);
                List<PageData> clist = consumerManager.findgraduate(pd);
                System.out.println(clist);

                //创建excel文件
                HSSFWorkbook wb = new HSSFWorkbook();
                //创建sheet页
                HSSFSheet sheet = wb.createSheet("高校毕业生");
                //创建标题行
                HSSFRow titleRow = sheet.createRow(0);
                titleRow.createCell((short) 0).setCellValue("报到时间");
                titleRow.createCell((short) 1).setCellValue("姓名");
                titleRow.createCell((short) 2).setCellValue("性别");
                titleRow.createCell((short) 3).setCellValue("身份证号码");
                titleRow.createCell((short) 4).setCellValue("毕业院校");
                titleRow.createCell((short) 5).setCellValue("毕业日期");
                titleRow.createCell((short) 6).setCellValue("学历");
                titleRow.createCell((short) 7).setCellValue("所学专业");
                titleRow.createCell((short) 8).setCellValue("入学前户口所在地");
                titleRow.createCell((short) 9).setCellValue("联系电话");
                titleRow.createCell((short) 10).setCellValue("应急联系电话");
                titleRow.createCell((short) 11).setCellValue("就业地意向");
                titleRow.createCell((short) 12).setCellValue("就业状态");
                titleRow.createCell((short) 13).setCellValue("就业单位");
                titleRow.createCell((short) 14).setCellValue("备注");
                if (clist.size() > 0) {



                    for (PageData pd1 : clist) {
                        HSSFRow dataRow = sheet.createRow(sheet.getLastRowNum() + 1);
                        dataRow.createCell((short) 0).setCellValue(pd1.getString("arrtime"));
                        dataRow.createCell((short) 1).setCellValue(pd1.getString("name"));
                        dataRow.createCell((short) 2).setCellValue(pd1.getString("sex"));
                        dataRow.createCell((short) 3).setCellValue(pd1.getString("cardid"));
                        dataRow.createCell((short) 4).setCellValue(pd1.getString("school"));
                        dataRow.createCell((short) 5).setCellValue(pd1.getString("gradate"));
                        dataRow.createCell((short) 6).setCellValue(pd1.getString("edubg"));
                        dataRow.createCell((short) 7).setCellValue(pd1.getString("major"));
                        dataRow.createCell((short) 8).setCellValue(pd1.getString("address"));
                        dataRow.createCell((short) 9).setCellValue(pd1.getString("tel"));
                        dataRow.createCell((short) 10).setCellValue(pd1.getString("extel"));
                        dataRow.createCell((short) 11).setCellValue(pd1.getString("jobadd"));
                        String jobtype2 = pd1.getString("jobtype");
                        if (jobtype2.equals("0")){
                            dataRow.createCell((short) 12).setCellValue("失业");
                        }else if (jobtype2.equals("1")){
                            dataRow.createCell((short) 12).setCellValue("就业");
                        }

                        dataRow.createCell((short) 13).setCellValue(pd1.getString("jobunit"));
                        dataRow.createCell((short) 14).setCellValue(pd1.getString("remark"));

                    }

                }
                // 设置下载时客户端Excel的名称
                String filename = new SimpleDateFormat("yyyyMMdd").format(new Date()) + "-gxbys.xls";
                //设置下载的文件
                System.out.println(filename);
                response.setCharacterEncoding("UTF-8");
                response.setContentType("application/vnd.ms-excel");
                response.setHeader("Content-disposition", "attachment;filename=" + filename);
                OutputStream ouputStream = response.getOutputStream();//打开流
                wb.write(ouputStream); //在excel内写入流
                ouputStream.flush();// 刷新流
                ouputStream.close();// 关闭流

            } else {
                json.put("success", "false");
                json.put("msg", "登录超时，请重新登录");
            }

        } catch (Exception e) {
            json.put("success", "false");
        }
        return json.toString();
    }

    @RequestMapping(value = "/readgraduateExcel", produces = {"application/json;charset=UTF-8"})
    @CrossOrigin(allowedHeaders = "*", allowCredentials = "true")
    @ResponseBody()
    public String readgraduateExcel(@RequestParam(value = "files", required = false) MultipartFile file, HttpServletRequest request) throws Exception {
        PageData pd = new PageData();
        JSONObject json = new JSONObject();
        try {
            PageData pd_stoken = new PageData();
            pd_stoken.put("TOKENID", request.getParameter("tokenid"));
            System.out.println(request.getParameter("tokenid"));
            PageData pd_token = zxlbService.findByTokenId(pd_stoken);
            if (pd_token != null) {
                if (null != file && !file.isEmpty()) {
                    String filePath = PathUtil.getClasspath() + Const.FILEPATHFILE;                                //文件上传路径
                    String fileName = FileUpload.fileUp(file, filePath, "ComExcel");                            //执行上传
                    List<PageData> listPd = (List) ObjectExcelRead2.readExcel(filePath, fileName, 1, 0, 0);        //执行读EXCEL操作,读出的数据导入List 2:从第3行开始；0:从第A列开始；0:第0个sheet
                    /*检查字段操作======================================*/
                    boolean check = true;
                    String str = "";
                    for (int i = 0; i < listPd.size(); i++) {
                        String var0 = listPd.get(i).getString("var0");
                        String var1 = listPd.get(i).getString("var1");
                        String var3 = listPd.get(i).getString("var3");
                        String var9 = listPd.get(i).getString("var9");
                        String var10 = listPd.get(i).getString("var10");
                        String var12 = listPd.get(i).getString("var12");

                        if (var0.equals("")) {
                            check = false;
                            str = str + "报到时间不能为空;";
                            break;
                        } else if (var1.equals("")) {
                            check = false;
                            str = str + "姓名不能为空;";
                            break;
                        } else if (var3.equals("")) {
                            check = false;
                            str = str + "身份证号码不能为空;";
                            break;
                        } else if (var9.equals("")) {
                            check = false;
                            str = str + "联系电话不能为空;";
                            break;
                        } else if (var10.equals("")) {
                            check = false;
                            str = str + "应急联系电话不能为空;";
                            break;
                        } else if (var12.equals("")) {
                            check = false;
                            str = str + "就业状态不能为空;";
                            break;
                        }
//                        PageData pd1 = new PageData();
//                        pd1.put("name",var12);
//                        PageData dic = consumerManager.getDIC(pd1);
//                        if (dic==null){
//                            str = str + "无此就业状态;";
//                            check = false;
//                            break;
//                        }

                    }
                    /*存入数据库操作======================================*/

                    if (check == true) {
                        for (int i = 0; i < listPd.size(); i++) {
                            pd.put("arrtime", listPd.get(i).getString("var0"));
                            pd.put("name", listPd.get(i).getString("var1"));
                            pd.put("sex", listPd.get(i).getString("var2"));
                            pd.put("cardid", listPd.get(i).getString("var3"));
                            pd.put("school", listPd.get(i).getString("var4"));
                            pd.put("gradate", listPd.get(i).getString("var5"));
                            pd.put("edubg", listPd.get(i).getString("var6"));
                            pd.put("major", listPd.get(i).getString("var7"));
                            pd.put("address", listPd.get(i).getString("var8"));
                            pd.put("tel", listPd.get(i).getString("var9"));
                            pd.put("extel", listPd.get(i).getString("var10"));
                            pd.put("jobadd", listPd.get(i).getString("var11"));
                            String var12 = listPd.get(i).getString("var12");
                            if (var12.equals("就业")){
                                pd.put("jobtype", "1");
                            }else if(var12.equals("失业")){
                                pd.put("jobtype", "0");
                            }
//                            PageData pd1 = new PageData();
//                            pd1.put("name",var12);
//                            PageData dic = consumerManager.getDIC(pd1);
//                            if (dic!=null){
//                                pd.put("jobtype", dic.getString("DICTIONARIES_ID"));
//                            }else {
//                                str = str + "无此就业状态;";
//                                json.put("msg", str);
//                                break;
//                            }
                            pd.put("jobunit", listPd.get(i).getString("var13"));
                            pd.put("remark", listPd.get(i).getString("var14"));
                            pd.put("czdate", getTime());
                            consumerManager.insertgraduate(pd);
                        }
                        json.put("success", "true");
                    } else if (check == false) {
                        json.put("msg", str);
                    }
                }

            } else {
                json.put("success", "false");
                json.put("msg", "登录超时，请重新登录");
            }
        } catch (Exception e) {
            json.put("success", "false");
        }
        return json.toString();
    }

    @RequestMapping(value = "/exportpovertyExcel", produces = {"application/json;charset=UTF-8"})
    @CrossOrigin(allowedHeaders = "*", allowCredentials = "true")
    @ResponseBody()
    public String exportpovertyExcel(HttpServletResponse response, HttpServletRequest request) throws Exception {

        JSONObject json = new JSONObject();
        try {
            PageData pd_stoken = new PageData();
            pd_stoken.put("TOKENID", request.getParameter("tokenid"));
            PageData pd_token = zxlbService.findByTokenId(pd_stoken);
            if (pd_token != null) {
                PageData pd = new PageData();
                Page page = new Page();
                URLDecoder urlDecoder = new URLDecoder();
                String starttime = pd.getString("starttime");
                String endtime = pd.getString("endtime");
                String pageIndex = "0";
                String pageSize = "999999999";
                String starttime1 = starttime == null ? "" : urlDecoder.decode(starttime, "utf-8");
                String endtime1 = endtime == null ? "" : urlDecoder.decode(endtime, "utf-8");
                String pageIndex1 = pageIndex == null ? "" : urlDecoder.decode(pageIndex, "utf-8");
                String pageSize1 = pageSize == null ? "" : urlDecoder.decode(pageSize, "utf-8");
                pd.put("starttime", starttime1);
                pd.put("endtime", endtime1);
                pd.put("pageIndex", pageIndex1);
                pd.put("pageSize", pageSize1);
                page.setPd(pd);
                System.out.println(pd);
                List<PageData> clist = consumerManager.findpoverty(pd);
                System.out.println(clist);
                //创建excel文件
                HSSFWorkbook wb = new HSSFWorkbook();
                //创建sheet页
                HSSFSheet sheet = wb.createSheet("建档立卡贫困人员");
                //创建标题行
                HSSFRow titleRow = sheet.createRow(0);
                titleRow.createCell((short) 0).setCellValue("入库时间");
                titleRow.createCell((short) 1).setCellValue("姓名");
                titleRow.createCell((short) 2).setCellValue("联系电话");
                titleRow.createCell((short) 3).setCellValue("备注");
                if (clist.size() > 0) {

                    for (PageData pd1 : clist) {
                        HSSFRow dataRow = sheet.createRow(sheet.getLastRowNum() + 1);
                        dataRow.createCell((short) 0).setCellValue(pd1.getString("cztime"));
                        dataRow.createCell((short) 1).setCellValue(pd1.getString("name"));
                        dataRow.createCell((short) 2).setCellValue(pd1.getString("tel"));
                        dataRow.createCell((short) 3).setCellValue(pd1.getString("remark"));
                    }

                }
                // 设置下载时客户端Excel的名称
                String filename = new SimpleDateFormat("yyyyMMdd").format(new Date()) + "-jdlkry.xls";
                //设置下载的文件
                System.out.println(filename);
                response.setCharacterEncoding("UTF-8");
                response.setContentType("application/vnd.ms-excel");
                response.setHeader("Content-disposition", "attachment;filename=" + filename);
                OutputStream ouputStream = response.getOutputStream();//打开流
                wb.write(ouputStream); //在excel内写入流
                ouputStream.flush();// 刷新流
                ouputStream.close();// 关闭流

            } else {
                json.put("success", "false");
                json.put("msg", "登录超时，请重新登录");
            }

        } catch (Exception e) {
            json.put("success", "false");
        }
        return json.toString();
    }

    @RequestMapping(value = "/readpovertyExcel", produces = {"application/json;charset=UTF-8"})
    @CrossOrigin(allowedHeaders = "*", allowCredentials = "true")
    @ResponseBody()
    public String readpovertyExcel(@RequestParam(value = "files", required = false) MultipartFile file, HttpServletRequest request) throws Exception {
        PageData pd = new PageData();
        JSONObject json = new JSONObject();
        try {
            PageData pd_stoken = new PageData();
            pd_stoken.put("TOKENID", request.getParameter("tokenid"));
            System.out.println(request.getParameter("tokenid"));
            PageData pd_token = zxlbService.findByTokenId(pd_stoken);
            if (pd_token != null) {
                if (null != file && !file.isEmpty()) {
                    String filePath = PathUtil.getClasspath() + Const.FILEPATHFILE;                                //文件上传路径
                    String fileName = FileUpload.fileUp(file, filePath, "ComExcel");                            //执行上传
                    List<PageData> listPd = (List) ObjectExcelRead2.readExcel(filePath, fileName, 1, 0, 0);        //执行读EXCEL操作,读出的数据导入List 2:从第3行开始；0:从第A列开始；0:第0个sheet
                    /*检查字段操作======================================*/
                    boolean check = true;
                    String str = "";
                    for (int i = 0; i < listPd.size(); i++) {
                        String var0 = listPd.get(i).getString("var0");
                        String var1 = listPd.get(i).getString("var1");
                         if ("".equals(var0)) {
                            check = false;
                            str = str + "姓名不能为空;";
                            break;
                        } else if ("".equals(var1)) {
                            check = false;
                            str = str + "联系方式不能为空;";
                            break;
                        }
                    }

                    /*存入数据库操作======================================*/
                    if (check == true) {
                        for (int i = 0; i < listPd.size(); i++) {
                            pd.put("cztime", getTime());
                            pd.put("name", listPd.get(i).getString("var0"));
                            pd.put("tel", listPd.get(i).getString("var1"));
                            pd.put("remark", listPd.get(i).getString("var2"));
                            consumerManager.insertpoverty(pd);
                        }
                        json.put("success", "true");
                    } else if (check == false) {
                        json.put("msg", str);
                    }

                }

            } else {
                json.put("success", "false");
                json.put("msg", "登录超时，请重新登录");
            }
        } catch (Exception e) {
            json.put("success", "false");
        }
        return json.toString();
    }

    @RequestMapping(value = "/exportsbbtryExcel", produces = {"application/json;charset=UTF-8"})
    @CrossOrigin(allowedHeaders = "*", allowCredentials = "true")
    @ResponseBody()
    public String exportsbbtryExcel(HttpServletResponse response, HttpServletRequest request) throws Exception {

        JSONObject json = new JSONObject();
        try {
            PageData pd_stoken = new PageData();
            pd_stoken.put("TOKENID", request.getParameter("tokenid"));
            PageData pd_token = zxlbService.findByTokenId(pd_stoken);
            if (pd_token != null) {
                PageData pd = new PageData();
                Page page = new Page();
                URLDecoder urlDecoder = new URLDecoder();
                String starttime = pd.getString("starttime");
                String endtime = pd.getString("endtime");
                String pageIndex = "0";
                String pageSize = "999999999";
                String starttime1 = starttime == null ? "" : urlDecoder.decode(starttime, "utf-8");
                String endtime1 = endtime == null ? "" : urlDecoder.decode(endtime, "utf-8");
                String pageIndex1 = pageIndex == null ? "" : urlDecoder.decode(pageIndex, "utf-8");
                String pageSize1 = pageSize == null ? "" : urlDecoder.decode(pageSize, "utf-8");
                pd.put("starttime", starttime1);
                pd.put("endtime", endtime1);
                pd.put("pageIndex", pageIndex1);
                pd.put("pageSize", pageSize1);
                page.setPd(pd);
                System.out.println(pd);
                List<PageData> clist = consumerManager.findsbbtry(pd);
                System.out.println(clist);
                //创建excel文件
                HSSFWorkbook wb = new HSSFWorkbook();
                //创建sheet页
                HSSFSheet sheet = wb.createSheet("社保补贴人员");
                //创建标题行
                HSSFRow titleRow = sheet.createRow(0);
                titleRow.createCell((short) 0).setCellValue("入库时间");
                titleRow.createCell((short) 1).setCellValue("姓名");
                titleRow.createCell((short) 2).setCellValue("联系电话");
                titleRow.createCell((short) 3).setCellValue("备注");

                if (clist.size() > 0) {


                    for (PageData pd1 : clist) {
                        HSSFRow dataRow = sheet.createRow(sheet.getLastRowNum() + 1);
                        dataRow.createCell((short) 0).setCellValue(pd1.getString("cztime"));
                        dataRow.createCell((short) 1).setCellValue(pd1.getString("name"));
                        dataRow.createCell((short) 2).setCellValue(pd1.getString("tel"));
                        dataRow.createCell((short) 3).setCellValue(pd1.getString("remark"));
                    }

                }
                // 设置下载时客户端Excel的名称
                String filename = new SimpleDateFormat("yyyyMMdd").format(new Date()) + "-sbbtry.xls";
                //设置下载的文件
                System.out.println(filename);
                response.setCharacterEncoding("UTF-8");
                response.setContentType("application/vnd.ms-excel");
                response.setHeader("Content-disposition", "attachment;filename=" + filename);
                OutputStream ouputStream = response.getOutputStream();//打开流
                wb.write(ouputStream); //在excel内写入流
                ouputStream.flush();// 刷新流
                ouputStream.close();// 关闭流

            } else {
                json.put("success", "false");
                json.put("msg", "登录超时，请重新登录");
            }

        } catch (Exception e) {
            json.put("success", "false");
        }
        return json.toString();
    }

    @RequestMapping(value = "/readsbbtryExcel", produces = {"application/json;charset=UTF-8"})
    @CrossOrigin(allowedHeaders = "*", allowCredentials = "true")
    @ResponseBody()
    public String readsbbtryExcel(@RequestParam(value = "files", required = false) MultipartFile file, HttpServletRequest request) throws Exception {
        PageData pd = new PageData();
        JSONObject json = new JSONObject();
        try {
            PageData pd_stoken = new PageData();
            pd_stoken.put("TOKENID", request.getParameter("tokenid"));
            System.out.println(request.getParameter("tokenid"));
            PageData pd_token = zxlbService.findByTokenId(pd_stoken);
            if (pd_token != null) {
                if (null != file && !file.isEmpty()) {
                    String filePath = PathUtil.getClasspath() + Const.FILEPATHFILE;                                //文件上传路径
                    String fileName = FileUpload.fileUp(file, filePath, "ComExcel");                            //执行上传
                    List<PageData> listPd = (List) ObjectExcelRead2.readExcel(filePath, fileName, 1, 0, 0);        //执行读EXCEL操作,读出的数据导入List 2:从第3行开始；0:从第A列开始；0:第0个sheet
                    /*检查字段操作======================================*/
                    boolean check = true;
                    String str = "";
                    for (int i = 0; i < listPd.size(); i++) {
                        String var0 = listPd.get(i).getString("var0");
                        String var1 = listPd.get(i).getString("var1");
                        if ("".equals(var0) || var0 == null) {
                            check = false;
                            str = str + "姓名不能为空;";
                            break;
                        } else if ("".equals(var1) || var1 == null) {
                            check = false;
                            str = str + "联系电话不能为空;";
                            break;
                        }

                    }
                    /*存入数据库操作======================================*/
                    if (check == true) {
                        for (int i = 0; i < listPd.size(); i++) {
                            pd.put("cztime", getTime());
                            pd.put("name", listPd.get(i).getString("var0"));
                            pd.put("tel", listPd.get(i).getString("var1"));
                            pd.put("remark", listPd.get(i).getString("var2"));
                            consumerManager.insertsbbtry(pd);
                        }
                        json.put("success", "true");
                    } else if (check == false) {
                        json.put("msg", str);
                    }

                }

            } else {
                json.put("success", "false");
                json.put("msg", "登录超时，请重新登录");
            }
        } catch (Exception e) {
            json.put("success", "false");
        }
        return json.toString();
    }

    @RequestMapping(value = "/exportjzbtryExcel", produces = {"application/json;charset=UTF-8"})
    @CrossOrigin(allowedHeaders = "*", allowCredentials = "true")
    @ResponseBody()
    public String exportjzbtryExcel(HttpServletResponse response, HttpServletRequest request) throws Exception {

        JSONObject json = new JSONObject();
        try {
            PageData pd_stoken = new PageData();
            pd_stoken.put("TOKENID", request.getParameter("tokenid"));
            PageData pd_token = zxlbService.findByTokenId(pd_stoken);
            if (pd_token != null) {
                PageData pd = new PageData();
                Page page = new Page();
                URLDecoder urlDecoder = new URLDecoder();
                String starttime = pd.getString("starttime");
                String endtime = pd.getString("endtime");
                String level = pd.getString("level");
                String pageIndex = "0";
                String pageSize = "999999999";
                String starttime1 = starttime == null ? "" : urlDecoder.decode(starttime, "utf-8");
                String endtime1 = endtime == null ? "" : urlDecoder.decode(endtime, "utf-8");
                String level1 = level == null ? "" : urlDecoder.decode(level, "utf-8");
                String pageIndex1 = pageIndex == null ? "" : urlDecoder.decode(pageIndex, "utf-8");
                String pageSize1 = pageSize == null ? "" : urlDecoder.decode(pageSize, "utf-8");
                pd.put("starttime", starttime1);
                pd.put("endtime", endtime1);
                pd.put("level", level1);
                pd.put("pageIndex", pageIndex1);
                pd.put("pageSize", pageSize1);
                page.setPd(pd);
                System.out.println(pd);
                List<PageData> clist = consumerManager.findjzbtry(pd);
                System.out.println(clist);

                //创建excel文件
                HSSFWorkbook wb = new HSSFWorkbook();
                //创建sheet页
                HSSFSheet sheet = wb.createSheet("见证补贴人员");
                //创建标题行
                HSSFRow titleRow = sheet.createRow(0);
                titleRow.createCell((short) 0).setCellValue("入库时间");
                titleRow.createCell((short) 1).setCellValue("姓名");
                titleRow.createCell((short) 2).setCellValue("身份证号码");
                titleRow.createCell((short) 3).setCellValue("工种");
                titleRow.createCell((short) 4).setCellValue("证书");
                titleRow.createCell((short) 5).setCellValue("等级");
                titleRow.createCell((short) 6).setCellValue("联系电话");
                titleRow.createCell((short) 7).setCellValue("所属地区");
                titleRow.createCell((short) 8).setCellValue("备注");
                if (clist.size() > 0) {


                    for (PageData pd1 : clist) {
                        HSSFRow dataRow = sheet.createRow(sheet.getLastRowNum() + 1);
                        dataRow.createCell((short) 0).setCellValue(pd1.getString("cztime"));
                        dataRow.createCell((short) 1).setCellValue(pd1.getString("name"));
                        dataRow.createCell((short) 2).setCellValue(pd1.getString("cardid"));
                        dataRow.createCell((short) 3).setCellValue(pd1.getString("jobvar"));
                        dataRow.createCell((short) 4).setCellValue(pd1.getString("credenname"));
                        dataRow.createCell((short) 5).setCellValue(pd1.getString("levelname"));
                        dataRow.createCell((short) 6).setCellValue(pd1.getString("tel"));
                        dataRow.createCell((short) 7).setCellValue(pd1.getString("address"));
                        dataRow.createCell((short) 8).setCellValue(pd1.getString("remark"));

                    }

                }
                // 设置下载时客户端Excel的名称
                String filename = new SimpleDateFormat("yyyyMMdd").format(new Date()) + "-jzbtry.xls";
                //设置下载的文件
                System.out.println(filename);
                response.setCharacterEncoding("UTF-8");
                response.setContentType("application/vnd.ms-excel");
                response.setHeader("Content-disposition", "attachment;filename=" + filename);
                OutputStream ouputStream = response.getOutputStream();//打开流
                wb.write(ouputStream); //在excel内写入流
                ouputStream.flush();// 刷新流
                ouputStream.close();// 关闭流

            } else {
                json.put("success", "false");
                json.put("msg", "登录超时，请重新登录");
            }

        } catch (Exception e) {
            json.put("success", "false");
        }
        return json.toString();
    }

    @RequestMapping(value = "/readjzbtryExcel", produces = {"application/json;charset=UTF-8"})
    @CrossOrigin(allowedHeaders = "*", allowCredentials = "true")
    @ResponseBody()
    public String readjzbtryExcel(@RequestParam(value = "files", required = false) MultipartFile file, HttpServletRequest request) throws Exception {
        PageData pd = new PageData();
        JSONObject json = new JSONObject();
        try {
            PageData pd_stoken = new PageData();
            pd_stoken.put("TOKENID", request.getParameter("tokenid"));
            System.out.println(request.getParameter("tokenid"));
            PageData pd_token = zxlbService.findByTokenId(pd_stoken);
            if (pd_token != null) {
                if (null != file && !file.isEmpty()) {
                    String filePath = PathUtil.getClasspath() + Const.FILEPATHFILE;                                //文件上传路径
                    String fileName = FileUpload.fileUp(file, filePath, "ComExcel");                            //执行上传
                    List<PageData> listPd = (List) ObjectExcelRead2.readExcel(filePath, fileName, 1, 0, 0);        //执行读EXCEL操作,读出的数据导入List 2:从第3行开始；0:从第A列开始；0:第0个sheet
                    /*检查字段操作======================================*/
                    boolean check = true;
                    String str = "";
                    for (int i = 0; i < listPd.size(); i++) {
                        String var0 = listPd.get(i).getString("var0");
                        String var1 = listPd.get(i).getString("var1");
                        String var3 = listPd.get(i).getString("var3");
                        String var4 = listPd.get(i).getString("var4");
                        if ("".equals(var0) || var0 == null) {
                            check = false;
                            str = str + "姓名不能为空;";
                            break;
                        } else if ("".equals(var1) || var1 == null) {
                            check = false;
                            str = str + "身份证号码不能为空;";
                            break;
                        } else if ("".equals(var3) || var3 == null) {
                            check = false;
                            str = str + "证书不能为空;";
                            break;
                        } else if ("".equals(var4) || var4 == null) {
                            check = false;
                            str = str + "等级不能为空;";
                            break;
                        }

                        PageData pd1 = new PageData();
                        pd1.put("name",var3);
                        pd1.put("level","031-___");
                        PageData dic = consumerManager.getDIC(pd1);
                        if (dic==null){
                            str = str + "查无此证书;";
                            check = false;
                            break;
                        }
                        PageData pd2 = new PageData();
                        pd2.put("name",var4);
                        pd2.put("level",dic.getString("BIANMA")+"-__");
                        PageData dic2 = consumerManager.getDIC(pd2);
                        if (dic2==null){
                            str = str + "查无此等级;";
                            check = false;
                            break;
                        }
                    }

                    /*存入数据库操作======================================*/
                    if (check == true) {
                        for (int i = 0; i < listPd.size(); i++) {
                            pd.put("cztime", getTime());
                            pd.put("name", listPd.get(i).getString("var0"));
                            pd.put("cardid", listPd.get(i).getString("var1"));
                            pd.put("jobvar", listPd.get(i).getString("var2"));
                            String var3 = listPd.get(i).getString("var3");
                            PageData pd1 = new PageData();
                            pd1.put("name",var3);
                            pd1.put("level","031-___");
                            PageData dic = consumerManager.getDIC(pd1);
                            if (dic!=null){
                                pd.put("creden", dic.getString("DICTIONARIES_ID"));
                            }else {
                                str = str + "查无此证书;";
                                json.put("msg", str);
                                break;
                            }
                            String var4 = listPd.get(i).getString("var4");
                            PageData pd2 = new PageData();
                            pd2.put("level",dic.getString("BIANMA")+"-__");
                            pd2.put("name",var4);
                            PageData dic2 = consumerManager.getDIC(pd2);
                            if (dic2!=null){
                                pd.put("level", dic2.getString("DICTIONARIES_ID"));
                            }else {
                                str = str + "查无此等级;";
                                json.put("msg", str);
                                break;
                            }
                            pd.put("tel", listPd.get(i).getString("var5"));
                            pd.put("address", listPd.get(i).getString("var6"));
                            pd.put("remark", listPd.get(i).getString("var7"));
                            consumerManager.insertjzbtry(pd);
                        }
                        json.put("success", "true");
                    } else if (check == false) {
                        json.put("msg", str);
                    }

                }

            } else {
                json.put("success", "false");
                json.put("msg", "登录超时，请重新登录");
            }
        } catch (Exception e) {
            json.put("success", "false");
        }
        return json.toString();
    }

    @RequestMapping(value = "/exportcompanyExcel", produces = {"application/json;charset=UTF-8"})
    @CrossOrigin(allowedHeaders = "*", allowCredentials = "true")
    @ResponseBody()
    public String exportcompanyExcel(HttpServletResponse response, HttpServletRequest request) throws Exception {

        JSONObject json = new JSONObject();
        try {
            PageData pd_stoken = new PageData();
            pd_stoken.put("TOKENID", request.getParameter("tokenid"));
            PageData pd_token = zxlbService.findByTokenId(pd_stoken);
            if (pd_token != null) {
                PageData pd = new PageData();
                Page page = new Page();
                URLDecoder urlDecoder = new URLDecoder();
                String name = pd.getString("name");
                String qytype = pd.getString("qytype");
                String lxr = pd.getString("lxr");
                String lxtel = pd.getString("lxtel");
                String keywords = pd.getString("keywords");
                String pageIndex = "0";
                String pageSize = "999999999";
                String name1 = name == null ? "" : urlDecoder.decode(name, "utf-8");
                String qytype1 = qytype == null ? "" : urlDecoder.decode(qytype, "utf-8");
                String lxr1 = lxr == null ? "" : urlDecoder.decode(lxr, "utf-8");
                String lxtel1 = lxtel == null ? "" : urlDecoder.decode(lxtel, "utf-8");
                String keywords1 = keywords == null ? "" : urlDecoder.decode(keywords, "utf-8");

                String pageIndex1 = name == null ? "" : urlDecoder.decode(pageIndex, "utf-8");
                String pageSize1 = name == null ? "" : urlDecoder.decode(pageSize, "utf-8");
                pd.put("name", name1);
                pd.put("qytype", qytype1);
                pd.put("lxr", lxr1);
                pd.put("lxtel", lxtel1);
                pd.put("keywords", keywords1);

                pd.put("pageIndex", pageIndex1);
                pd.put("pageSize", pageSize1);
                page.setPd(pd);
                System.out.println(pd);
                List<PageData> clist = consumerManager.findcompany(pd);

                //创建excel文件
                HSSFWorkbook wb = new HSSFWorkbook();
                //创建sheet页
                HSSFSheet sheet = wb.createSheet("企业招聘信息");
                //创建标题行
                HSSFRow titleRow = sheet.createRow(0);
                titleRow.createCell((short) 0).setCellValue("企业编号");
                titleRow.createCell((short) 1).setCellValue("企业名称");
                titleRow.createCell((short) 2).setCellValue("企业类型");
                titleRow.createCell((short) 3).setCellValue("联系人");
                titleRow.createCell((short) 4).setCellValue("联系电话");
                titleRow.createCell((short) 5).setCellValue("备用联系人");
                titleRow.createCell((short) 6).setCellValue("备用联系电话");
                titleRow.createCell((short) 7).setCellValue("企业地址");
                titleRow.createCell((short) 8).setCellValue("企业邮箱");

                titleRow.createCell((short) 9).setCellValue("招聘工种");
                titleRow.createCell((short) 10).setCellValue("岗位性质");
                titleRow.createCell((short) 11).setCellValue("招工人数");
                titleRow.createCell((short) 12).setCellValue("岗位要求");
                titleRow.createCell((short) 13).setCellValue("学历要求");
                titleRow.createCell((short) 14).setCellValue("专业要求");
                titleRow.createCell((short) 15).setCellValue("性别要求");
                titleRow.createCell((short) 16).setCellValue("年龄要求");
                titleRow.createCell((short) 17).setCellValue("工资待遇");
                titleRow.createCell((short) 18).setCellValue("其他说明");
                if (clist.size() > 0) {


                    for (PageData pageData : clist) {
                        String uid = pageData.getString("uid");
                        PageData data = new PageData();
                        data.put("uid", uid);
                        List<PageData> employ = consumerManager.findemployreg(data);
                        List<PageData> company = consumerManager.findcompany(data);
                        for (PageData pd1 : employ) {
                            HSSFRow dataRow = sheet.createRow(sheet.getLastRowNum() + 1);
                            dataRow.createCell((short) 0).setCellValue(pd1.size());
                            dataRow.createCell((short) 1).setCellValue(company.get(0).getString("name"));
                            dataRow.createCell((short) 2).setCellValue(company.get(0).getString("qytypename"));
                            dataRow.createCell((short) 3).setCellValue(company.get(0).getString("lxr"));
                            dataRow.createCell((short) 4).setCellValue(company.get(0).getString("lxtel"));
                            dataRow.createCell((short) 5).setCellValue(company.get(0).getString("bylxr"));
                            dataRow.createCell((short) 6).setCellValue(company.get(0).getString("bylxtel"));
                            dataRow.createCell((short) 7).setCellValue(company.get(0).getString("addr"));
                            dataRow.createCell((short) 8).setCellValue(company.get(0).getString("email"));

                            dataRow.createCell((short) 9).setCellValue(pd1.getString("gwflname"));
                            dataRow.createCell((short) 10).setCellValue(pd1.getString("jobtypename"));
                            dataRow.createCell((short) 11).setCellValue(pd1.getString("zgrs"));
                            dataRow.createCell((short) 12).setCellValue(pd1.getString("gwyq"));
                            dataRow.createCell((short) 13).setCellValue(pd1.getString("xlname"));
                            dataRow.createCell((short) 14).setCellValue(pd1.getString("zyyq"));
                            String sex = pd1.getString("sex");
                            if(sex.equals("1")){
                                sex="男";
                            }else if (sex.equals("2")){
                                sex="女";
                            }else{
                                sex="";
                            }
                            dataRow.createCell((short) 15).setCellValue(sex);
                            dataRow.createCell((short) 16).setCellValue(pd1.getString("age"));
                            dataRow.createCell((short) 17).setCellValue(pd1.getString("gzdyname"));
                            dataRow.createCell((short) 18).setCellValue(pd1.getString("remark"));

                        }
                    }


                }
                // 设置下载时客户端Excel的名称
                String filename = new SimpleDateFormat("yyyyMMdd").format(new Date()) + "-company.xls";
                //设置下载的文件
                System.out.println(filename);
                response.setCharacterEncoding("UTF-8");
                response.setContentType("application/vnd.ms-excel");
                response.setHeader("Content-disposition", "attachment;filename=" + filename);
                OutputStream ouputStream = response.getOutputStream();//打开流
                wb.write(ouputStream); //在excel内写入流
                ouputStream.flush();// 刷新流
                ouputStream.close();// 关闭流

            } else {
                json.put("success", "false");
                json.put("msg", "登录超时，请重新登录");
            }

        } catch (Exception e) {
            json.put("success", "false");
        }
        return json.toString();
    }

    @RequestMapping(value = "/readcompanyExcel", produces = {"application/json;charset=UTF-8"})
    @CrossOrigin(allowedHeaders = "*", allowCredentials = "true")
    @ResponseBody()
    public String readcompanyExcel(@RequestParam(value = "files", required = false) MultipartFile file, HttpServletRequest request) throws Exception {
        PageData pd = new PageData();
        JSONObject json = new JSONObject();
//        try {
            PageData pd_stoken = new PageData();
            pd_stoken.put("TOKENID", request.getParameter("tokenid"));
            System.out.println(request.getParameter("tokenid"));
            PageData pd_token = zxlbService.findByTokenId(pd_stoken);
            String czman = pd_stoken.getString("ZXYH");
        if (pd_token != null) {
                System.out.println(file);
                if (null != file && !file.isEmpty()) {
                    String filePath = PathUtil.getClasspath() + Const.FILEPATHFILE;                                //文件上传路径
                    String fileName = FileUpload.fileUp(file, filePath, "ComExcel");                            //执行上传
                    List<PageData> listPd = (List) ObjectExcelRead2.readExcel(filePath, fileName, 1, 0, 0);        //执行读EXCEL操作,读出的数据导入List 2:从第3行开始；0:从第A列开始；0:第0个sheet
                    /*检查字段操作======================================*/
                    boolean check = true;
                    String str = "";

                    for (int i = 0; i < listPd.size(); i++) {
                        String var1 = listPd.get(i).getString("var1");
                        String var3 = listPd.get(i).getString("var3");
                        String var4 = listPd.get(i).getString("var4");
                        String var9 = listPd.get(i).getString("var9");
                        String var16 = listPd.get(i).getString("var16");
                        if ("".equals(var1) || var1 == null) {
                            check = false;
                            str = str + "企业名称不能为空;";
                            break;
                        } else if ("".equals(var3) || var3 == null) {
                            check = false;
                            str = str + "联系人不能为空;";
                            break;
                        } else if ("".equals(var4) || var4 == null) {
                            check = false;
                            str = str + "联系电话不能为空;";
                            break;
                        } else if ("".equals(var9) || var9 == null) {
                            check = false;
                            str = str + "招聘工种不能为空;";
                            break;
                        } else if (var16.equals("") ) {
                            check = false;
                            str = str + "年龄不能为空;";
                            break;
                        }
//                        String var2 = listPd.get(i).getString("var2");
//                        PageData pd1 = new PageData();
//                        pd1.put("name",var2);
//                        PageData dic = consumerManager.getDIC(pd1);
//                        if (dic==null){
//                            str = str + "查无此企业类型;";
//                            check = false;
//                            break;
//                        }
//
//                        String var10 = listPd.get(i).getString("var10");
//                        PageData pd2 = new PageData();
//                        pd2.put("name",var10);
//                        System.out.println(var10);
//                        PageData dic3 = consumerManager.getDIC(pd2);
//                        if (dic3==null){
//                            str = str + "查无此岗位性质;";
//                            check = false;
//                            break;
//                        }
//
//                        PageData pd3 = new PageData();
//                        pd3.put("gwflname",var9);
//
//                        PageData getjobtype = consumerManager.getjobtype(pd3);
//                        if (getjobtype==null) {
//                            str = str + "查无此岗位工种;";
//                            check = false;
//                            break;
//                        }
//                        String var13 = listPd.get(i).getString("var13");
//                        PageData pd4 = new PageData();
//                        pd4.put("name",var13);
//                        PageData dic4 = consumerManager.getDIC(pd4);
//                        if (dic4==null) {
//                            str = str + "查无此学历;";
//                            check = false;
//                            break;
//                        }
//                        String var17 = listPd.get(i).getString("var17");
//                        PageData pd5 = new PageData();
//                        pd5.put("name",var17);
//                        PageData dic5 = consumerManager.getDIC(pd5);
//                        if (dic5==null) {
//                            str = str + "查无此工资待遇;";
//                            check = false;
//                            break;
//                        }

                    }

                    if (check == true) {
                        System.out.println("执行了2");

                        /*存入数据库操作======================================*/
                        for (int i = 0; i < listPd.size(); i++) {
                            PageData pageData = new PageData();
                            String var4 = listPd.get(i).getString("var4").trim();
                            String var1 = listPd.get(i).getString("var1").trim();
                            pageData.put("tel", var4);
                            pageData.put("name", var1);
                            List<PageData> findcompany = consumerManager.findcompany(pageData);
                            System.out.println(findcompany);

                            if (findcompany.isEmpty() ) {
                                PageData data1 = new PageData();
                                data1.put("uid", this.getUUID32());
                                data1.put("name", listPd.get(i).getString("var1"));

                                String var2 = listPd.get(i).getString("var2");
                                PageData pd1 = new PageData();
                                pd1.put("name",var2);
                                PageData dic = consumerManager.getDIC(pd1);
                                if (dic!=null){
                                    data1.put("qytype", dic.getString("DICTIONARIES_ID"));
                                }else {
//                                    str = str + "查无此企业类型;";
//                                    json.put("msg", str);
//                                    break;
                                    data1.put("qytype", "暂无");
                                }
                                data1.put("lxr", listPd.get(i).getString("var3"));
                                data1.put("tel", listPd.get(i).getString("var4"));
                                data1.put("lxtel", listPd.get(i).getString("var4"));
                                data1.put("bylxr", listPd.get(i).getString("var5"));
                                data1.put("bylxtel", listPd.get(i).getString("var6"));
                                data1.put("addr", listPd.get(i).getString("var7"));
                                data1.put("email", listPd.get(i).getString("var8"));
                                data1.put("czman", czman);
                                data1.put("czdate", getTime());
                                data1.put("isimpot", "1");
                                System.out.println(data1);
                                consumerManager.insertcompany(data1);

                            }

                        }
                        for (int i = 0; i < listPd.size(); i++) {
                            PageData pageData = new PageData();
                            String var4 = listPd.get(i).getString("var4").trim();
                            String var1 = listPd.get(i).getString("var1").trim();
                            pageData.put("tel", var4);
                            pageData.put("name", var1);
                            List<PageData> findcompany = consumerManager.findcompany(pageData);
                            if (!findcompany.isEmpty()) {
                                PageData data1 = new PageData();
                                data1.put("uid", findcompany.get(0).getString("uid"));
                                String var9 = listPd.get(i).getString("var9");

                                PageData pd1 = new PageData();
                                pd1.put("gwflname",var9);
                                PageData getjobtype = consumerManager.getjobtype(pd1);

                                if (getjobtype!=null){
                                    data1.put("jobname", Integer.parseInt(getjobtype.get("code").toString()));
                                }else {
//                                    str = str + "查无此岗位工种;";
//                                    json.put("msg", str);
//                                    break;
                                    data1.put("jobname", "暂无");
                                }
                                String var10 = listPd.get(i).getString("var10");
                                PageData pd2 = new PageData();
                                pd2.put("name",var10);
                                pd2.put("bianma","022");
                                PageData dic = consumerManager.getDIC(pd2);
                                if (dic!=null){
                                    data1.put("jobtype", dic.getString("DICTIONARIES_ID"));
                                }else {
//                                    str = str + "查无此岗位性质;";
//                                    json.put("msg", str);
//                                    break;
                                    data1.put("jobtype", "暂无");
                                }
                                data1.put("zgrs", listPd.get(i).getString("var11"));
                                data1.put("gwyq", listPd.get(i).getString("var12"));
                                String var13 = listPd.get(i).getString("var13");
                                PageData pd3 = new PageData();
                                pd3.put("name",var13);
                                PageData dic3 = consumerManager.getDIC(pd3);
                                if (dic3!=null){
                                    data1.put("xl", dic3.getString("DICTIONARIES_ID"));
                                }else {
//                                    str = str + "查无此学历;";
//                                    json.put("msg", str);
//                                    break;
                                    data1.put("xl", "暂无");
                                }
                                data1.put("zyyq", listPd.get(i).getString("var14"));
                                String var15 = listPd.get(i).getString("var15");
                                if (var15.equals("男")){
                                    data1.put("sex", "1");
                                }else if (var15.equals("女")){
                                    data1.put("sex", "2");
                                }else if (var15.equals("均可")){
                                    data1.put("sex", "0");
                                }
//                                PageData pd4 = new PageData();
//                                pd4.put("name",var15);
//                                PageData dic4 = consumerManager.getDIC(pd4);
//                                if (dic4!=null){
//                                    data1.put("sex", dic4.getString("DICTIONARIES_ID"));
//                                }else {
//                                   str = str + "查无此学历;";
//                                   json.put("msg", str);
//                                   break;
//                                    data1.put("sex", "");
//                                }
                                String var16 = listPd.get(i).getString("var16");
                                if (var16.contains("-")){
                                    String[] split = var16.split("-");
                                    data1.put("agestart", split[0]);
                                    data1.put("ageend", split[1]);
                                }else if (var16.equals("不限")){
                                    data1.put("agestart", 0);
                                    data1.put("ageend", 100);
                                }else {

                                }


                                String var17 = listPd.get(i).getString("var17");
                                PageData pd5 = new PageData();
                                pd5.put("name",var17);
                                PageData dic5 = consumerManager.getDIC(pd5);
                                if (dic5!=null){
                                    data1.put("gzdy", dic5.getString("DICTIONARIES_ID"));
                                }else {
//                                    str = str + "查无此工资待遇;";
//                                    json.put("msg", str);
//                                    break;
                                    data1.put("gzdy", "暂无");
                                }

                                data1.put("remark", listPd.get(i).getString("var18"));
                                data1.put("czman", czman);
                                data1.put("czdate", getTime());
                                data1.put("isimpot", "1");
                                System.out.println(data1);
                                consumerManager.insertemployreg(data1);
                                System.out.println("执行了3");
                            }
                        }

                        json.put("success", "true");
                    } else if (check == false) {
                        json.put("msg", str);
                    }
                }

            } else {
                json.put("success", "false");
                json.put("msg", "登录超时，请重新登录");
            }
//        } catch (Exception e) {
//            System.out.println("执行了4");
//            json.put("success", "false");
//        }
        return json.toString();
    }


    @RequestMapping(value = "/exportpersonExcel", produces = {"application/json;charset=UTF-8"})
    @CrossOrigin(allowedHeaders = "*", allowCredentials = "true")
    @ResponseBody()
    public JSONObject exportpersonExcel(HttpServletResponse response, HttpServletRequest request) throws Exception {

        JSONObject json = new JSONObject();
        System.out.println(request.getParameter("tokenid"));
        try {
            PageData pd_stoken = new PageData();
            pd_stoken.put("TOKENID", request.getParameter("tokenid"));
            PageData pd_token = zxlbService.findByTokenId(pd_stoken);
            if (pd_token != null) {
                PageData pd = new PageData();
                Page page = new Page();
                URLDecoder urlDecoder = new URLDecoder();
                String name = pd.getString("name");
                String age = pd.getString("age");
                String sex = pd.getString("sex");
                String xl = pd.getString("xl");
                String isjob = pd.getString("isjob");
                String jobtype = pd.getString("jobtype");
                String jobname = pd.getString("jobname");
                String qwxz = pd.getString("qwxz");
                String pageIndex = "0";
                String pageSize = "999999999";
                String name1 = name == null ? "" : urlDecoder.decode(name, "utf-8");
                String age1 = age == null ? "" : urlDecoder.decode(age, "utf-8");
                String sex1 = sex == null ? "" : urlDecoder.decode(sex, "utf-8");
                String xl1 = xl == null ? "" : urlDecoder.decode(xl, "utf-8");
                String isjob1 = isjob == null ? "" : urlDecoder.decode(isjob, "utf-8");
                String jobtype1 = jobtype == null ? "" : urlDecoder.decode(jobtype, "utf-8");
                String jobname1 = jobname == null ? "" : urlDecoder.decode(jobname, "utf-8");
                String qwxz1 = qwxz == null ? "" : urlDecoder.decode(qwxz, "utf-8");
                String pageIndex1 = name == null ? "" : urlDecoder.decode(pageIndex, "utf-8");
                String pageSize1 = name == null ? "" : URLDecoder.decode(pageSize, "utf-8");
                pd.put("name", name1);
                pd.put("age", age1);
                pd.put("sex", sex1);
                pd.put("xl", xl1);
                pd.put("isjob", isjob1);
                pd.put("jobtype", jobtype1);
                pd.put("jobname", jobname1);
                pd.put("qwxz", qwxz1);
                pd.put("pageIndex", pageIndex1);
                pd.put("pageSize", pageSize1);
                page.setPd(pd);
                System.out.println(pd);
                List<PageData> clist = jobReferManager.getjob(pd);

                System.out.println(clist);
                //创建excel文件
                HSSFWorkbook wb = new HSSFWorkbook();
                //创建sheet页
                HSSFSheet sheet = wb.createSheet("求职登记汇总");
                //创建标题行
                HSSFRow titleRow = sheet.createRow(0);
                titleRow.createCell((short) 0).setCellValue("姓名");
                titleRow.createCell((short) 1).setCellValue("身份证号");
                titleRow.createCell((short) 2).setCellValue("性别");
                titleRow.createCell((short) 3).setCellValue("年龄");
                titleRow.createCell((short) 4).setCellValue("联系电话");
                titleRow.createCell((short) 5).setCellValue("学历");
                titleRow.createCell((short) 6).setCellValue("专业");
                titleRow.createCell((short) 7).setCellValue("籍贯");
                titleRow.createCell((short) 8).setCellValue("就业状态");
                titleRow.createCell((short) 9).setCellValue("邮箱");
                titleRow.createCell((short) 10).setCellValue("岗位性质");
                titleRow.createCell((short) 11).setCellValue("岗位名称");
                titleRow.createCell((short) 12).setCellValue("期望薪资");
                titleRow.createCell((short) 13).setCellValue("工作地点");
                titleRow.createCell((short) 14).setCellValue("其他要求");
                if (clist.size() > 0) {


                    for (PageData pd1 : clist) {

                        HSSFRow dataRow = sheet.createRow(sheet.getLastRowNum() + 1);
                        dataRow.createCell((short) 0).setCellValue(pd1.getString("name"));
                        dataRow.createCell((short) 1).setCellValue(pd1.getString("cardid"));
                        String sex2 = pd1.getString("sex");
                        if(sex2.equals("1")){
                            sex2="男";
                        }else if (sex2.equals("2")){
                            sex2="女";
                        }else{
                            sex2="";
                        }
                        dataRow.createCell((short) 2).setCellValue(sex2);
                        dataRow.createCell((short) 3).setCellValue(pd1.getString("age"));
                        dataRow.createCell((short) 4).setCellValue(pd1.getString("lxtel"));
                        dataRow.createCell((short) 5).setCellValue(pd1.getString("xlname"));
                        dataRow.createCell((short) 6).setCellValue(pd1.getString("zy"));
                        dataRow.createCell((short) 7).setCellValue(pd1.getString("jg"));
                        String isjob2 = pd1.getString("isjob");
                        if (isjob2.equals("0")){
                            isjob2="失业";
                        }else if (isjob2.equals("1")){
                            isjob2="就业";
                        }else {
                            isjob2="";
                        }
                        dataRow.createCell((short) 8).setCellValue(isjob2);
                        dataRow.createCell((short) 9).setCellValue(pd1.getString("email"));
                        dataRow.createCell((short) 10).setCellValue(pd1.getString("jobtypename"));
                        dataRow.createCell((short) 11).setCellValue(pd1.getString("gwflname"));
                        dataRow.createCell((short) 12).setCellValue(pd1.getString("qwxzname"));
                        dataRow.createCell((short) 13).setCellValue(pd1.getString("jobaddr"));
                        dataRow.createCell((short) 14).setCellValue(pd1.getString("remark"));
                    }



                }
                // 设置下载时客户端Excel的名称
                String filename = new SimpleDateFormat("yyyyMMdd").format(new Date()) + "-qzdj.xls";
                //设置下载的文件
                System.out.println(filename);
                response.setCharacterEncoding("UTF-8");
                response.setContentType("application/vnd.ms-excel");
                response.setHeader("Content-disposition", "attachment;filename=" + filename);
                OutputStream ouputStream = response.getOutputStream();//打开流
                wb.write(ouputStream); //在excel内写入流
                ouputStream.flush();// 刷新流
                ouputStream.close();// 关闭流

            } else {
                json.put("success", "false");
                json.put("msg", "登录超时，请重新登录");
            }

        } catch (Exception e) {
            json.put("success", "false");
        }
        return json;
    }


    @RequestMapping(value = "/readpersonExcel", produces = {"application/json;charset=UTF-8"})
    @CrossOrigin(allowedHeaders = "*", allowCredentials = "true")
    @ResponseBody()
    public String readpersonExcel(@RequestParam(value = "files", required = false) MultipartFile file, HttpServletRequest request) throws Exception {
        PageData pd = new PageData();
        JSONObject json = new JSONObject();
        try {
            PageData pd_stoken = new PageData();
            pd_stoken.put("TOKENID", request.getParameter("tokenid"));
            System.out.println(request.getParameter("tokenid"));
            PageData pd_token = zxlbService.findByTokenId(pd_stoken);
            String czman = pd_stoken.getString("ZXYH");
            if (pd_token != null) {
                if (null != file && !file.isEmpty()) {
                    String filePath = PathUtil.getClasspath() + Const.FILEPATHFILE;                                //文件上传路径
                    String fileName = FileUpload.fileUp(file, filePath, "Excel");                            //执行上传
                    List<PageData> listPd = (List) ObjectExcelRead2.readExcel(filePath, fileName, 1, 0, 0);        //执行读EXCEL操作,读出的数据导入List 2:从第3行开始；0:从第A列开始；0:第0个sheet
                    /*检查字段操作======================================*/
                    boolean check = true;
                    String str = "";
                    System.out.println("执行了1");
                    for (int i = 0; i < listPd.size(); i++) {

                        String var0 = listPd.get(i).getString("var0");
                        String var2 = listPd.get(i).getString("var2");
                        String var3 = listPd.get(i).getString("var3");
                        String var4 = listPd.get(i).getString("var4");
                        String var11 = listPd.get(i).getString("var11");
                        System.out.println(var0);
                        System.out.println(var2);
                        System.out.println(var3);
                        System.out.println(var4);
                        System.out.println(var11);
                        if ("".equals(var0) || var0 == null) {
                            check = false;
                            str = str + "姓名不能为空;";
                            break;
                        } else if ("".equals(var2) || var2 == null) {
                            check = false;
                            str = str + "性别不能为空;";
                            break;
                        } else if ("".equals(var3) || var3 == null) {
                            check = false;
                            str = str + "年龄不能为空;";
                            break;
                        } else if ("".equals(var4) || var4 == null) {
                            check = false;
                            str = str + "联系电话不能为空;";
                            break;
                        } else if ("".equals(var11) || var11 == null) {
                            check = false;
                            str = str + "岗位名称不能为空;";
                            break;
                        }

//                        String var5 = listPd.get(i).getString("var5");
//                        PageData pd1 = new PageData();
//                        pd1.put("name",var5);
//                        PageData dic1 = consumerManager.getDIC(pd1);
//                        if (dic1==null){
//                            str = str + "查无此学历;";
//                            check = false;
//                            break;
//                        }
//                        String var8 = listPd.get(i).getString("var8");
//                        PageData pd2 = new PageData();
//                        pd2.put("name",var8);
//                        PageData dic2 = consumerManager.getDIC(pd2);
//                        if (dic2==null){
//                            str = str + "查无此就业状态;";
//                            check = false;
//                            break;
//                        }
//                        String var10 = listPd.get(i).getString("var10");
//                        PageData pd9 = new PageData();
//                        pd9.put("name",var10);
//                        PageData dic = consumerManager.getDIC(pd9);
//
//                        if (dic==null){
//                            str = str + "查无此岗位性质;";
//                            check = false;
//                            break;
//                        }
//
//                        PageData pd3 = new PageData();
//                        pd3.put("gwflname",var11);
//                        PageData getjobtype = consumerManager.getjobtype(pd3);
//
//                        if (getjobtype==null){
//                            str = str + "查无此岗位名称;";
//                            check = false;
//                            break;
//                        }
//                        String var12 = listPd.get(i).getString("var12");
//                        PageData pd4 = new PageData();
//                        pd4.put("name",var12);
//                        PageData dic3 = consumerManager.getDIC(pd4);
//                        if (dic3!=null){
//                            str = str + "查无此期望薪资;";
//                            check = false;
//                            break;
//                        }
                    }
                    System.out.println(check);
                    if (check == true) {
                        /*存入数据库操作======================================*/
                        for (int i = 0; i < listPd.size(); i++) {
                            PageData pageData = new PageData();
                            String var4 = listPd.get(i).getString("var4").trim();
                            String var0 = listPd.get(i).getString("var0").trim();
                            pageData.put("tel", var4);
                            pageData.put("name", var0);
                            System.out.println(pageData);
                            List<PageData> findperson = jobReferManager.findperson(pageData);
                            System.out.println(findperson);
                            if (findperson.isEmpty()) {
                                PageData data1 = new PageData();
                                data1.put("uid", this.getUUID32());
                                data1.put("name", listPd.get(i).getString("var0"));
                                data1.put("cardid", listPd.get(i).getString("var1"));
                                String var2 = listPd.get(i).getString("var2");
                                String sex ="";
                                if (var2.equals("男")){
                                    sex="1";
                                }else if(var2.equals("女")){
                                    sex="2";
                                }
                                data1.put("sex", sex);
                                data1.put("age", listPd.get(i).getString("var3"));
                                data1.put("tel", listPd.get(i).getString("var4"));
                                data1.put("lxtel", listPd.get(i).getString("var4"));
                                String var5 = listPd.get(i).getString("var5");
                                PageData pd1 = new PageData();
                                pd1.put("name",var5);
                                PageData dic1 = consumerManager.getDIC(pd1);
                                if (dic1!=null){
                                    data1.put("xl", dic1.getString("DICTIONARIES_ID"));
                                }else {
//                                    str = str + "查无此学历;";
//                                    json.put("msg", str);
//                                    break;
                                    data1.put("xl", "暂无");
                                }

                                data1.put("zy", listPd.get(i).getString("var6"));
                                data1.put("jg", listPd.get(i).getString("var7"));
                                String var8 = listPd.get(i).getString("var8");
                                if (var8.equals("就业")){
                                    data1.put("isjob", "1");
                                }else if (var8.equals("失业")){
                                    data1.put("isjob", "0");
                                }else {
                                    data1.put("isjob", "暂无");
                                }

//                                PageData pd2 = new PageData();
//                                pd2.put("name",var8);
//                                PageData dic2 = consumerManager.getDIC(pd2);
//                                if (dic2!=null){
//                                    data1.put("isjob", dic2.getString("DICTIONARIES_ID"));
//                                }else {
//                                    str = str + "查无此就业;";
//                                    json.put("msg", str);
//                                    break;
//                                    data1.put("isjob", "");
//                                }
                                data1.put("email", listPd.get(i).getString("var9"));
                                data1.put("czman", czman);
                                data1.put("czdate", getTime());
                                data1.put("isimpot", "1");
                                jobReferManager.insertperson(data1);
                                System.out.println("执行了2");
                            }

                        }
                        for (int i = 0; i < listPd.size(); i++) {
                            PageData pageData = new PageData();
                            String var4 = listPd.get(i).getString("var4").trim();
                            String var0 = listPd.get(i).getString("var0").trim();
                            pageData.put("tel", var4);
                            pageData.put("name", var0);
                            List<PageData> findperson = jobReferManager.findperson(pageData);
                            System.out.println(findperson);

                            if (!findperson.isEmpty()) {
                                PageData data1 = new PageData();
                                data1.put("uid", findperson.get(0).getString("uid"));
                                String var10 = listPd.get(i).getString("var10");
                                PageData pd1 = new PageData();
                                pd1.put("name",var10);
                                PageData dic = consumerManager.getDIC(pd1);

                                if (dic!=null){
                                    data1.put("jobtype", dic.getString("DICTIONARIES_ID"));
                                }else {
//                                    str = str + "查无此岗位工种;";
//                                    json.put("msg", str);
//                                    break;
                                    data1.put("jobtype", "暂无");
                                }

                                String var11 = listPd.get(i).getString("var11");
                                PageData pd2 = new PageData();
                                pd2.put("gwflname",var11);
                                PageData getjobtype = consumerManager.getjobtype(pd2);

                                if (getjobtype!=null){
                                    data1.put("jobname", Integer.parseInt(getjobtype.get("code").toString()));
                                }else {
//                                    str = str + "查无此岗位性质;";
//                                    json.put("msg", str);
//                                    break;
                                    data1.put("jobname", "暂无");
                                }
                                String var12 = listPd.get(i).getString("var12");
                                PageData pd3 = new PageData();
                                pd3.put("name",var12);
                                PageData dic2 = consumerManager.getDIC(pd3);
                                if (dic2!=null){
                                    data1.put("qwxz", dic2.getString("DICTIONARIES_ID"));
                                }else {
//                                    str = str + "查无此期望薪资;";
//                                    json.put("msg", str);
//                                    break;
                                    data1.put("qwxz", "暂无");
                                }


                                data1.put("jobaddr", listPd.get(i).getString("var13"));
                                data1.put("remark", listPd.get(i).getString("var14"));
                                data1.put("isvalid", "1");
                                data1.put("czman", czman);
                                data1.put("czdate", getTime());
                                data1.put("isimpot", "1");
                                jobReferManager.insertjobreg(data1);
                                System.out.println("执行了3");
                            }
                        }
                        json.put("success", "true");

                    } else if (check == false) {
                        json.put("msg", str);
                    }
                }else {
                    json.put("msg", "暂无数据");
                }

            } else {
                json.put("success", "false");
                json.put("msg", "登录超时，请重新登录");
            }
        } catch (Exception e) {
            json.put("success", "false");
        }
        return json.toString();
    }

    //通讯录导入
    @RequestMapping(value = "/readaddrExcel", produces = {"application/json;charset=UTF-8"})
    @CrossOrigin(allowedHeaders = "*", allowCredentials = "true")
    @ResponseBody()
    public String readaddrExcel(@RequestParam(value = "files", required = false) MultipartFile file, HttpServletRequest request) throws Exception {
        PageData pd = new PageData();
        JSONObject json = new JSONObject();
        try {
            PageData pd_stoken = new PageData();
            pd_stoken.put("TOKENID", request.getParameter("tokenid"));
            System.out.println(request.getParameter("tokenid"));
            PageData pd_token = zxlbService.findByTokenId(pd_stoken);
            if (pd_token != null) {
                System.out.println(file);
                if (null != file && !file.isEmpty()) {
                    String filePath = PathUtil.getClasspath() + Const.FILEPATHFILE;                                //文件上传路径
                    String fileName = FileUpload.fileUp(file, filePath, "Excel");                            //执行上传
                    List<PageData> listPd = (List) ObjectExcelRead2.readExcel(filePath, fileName, 1, 0, 0);        //执行读EXCEL操作,读出的数据导入List 2:从第3行开始；0:从第A列开始；0:第0个sheet
                    /*存入数据库操作======================================*/
                    for (int i = 0; i < listPd.size(); i++) {
                        pd.put("office", listPd.get(i).getString("var1"));
                        pd.put("duty", listPd.get(i).getString("var2"));
                        pd.put("name", listPd.get(i).getString("var3"));
                        pd.put("tel1", listPd.get(i).getString("var4"));
                        pd.put("tel2", listPd.get(i).getString("var5"));
                        jobReferManager.insertaddr(pd);
                    }
                    json.put("success", "true");
                }

            } else {
                json.put("success", "false");
                json.put("msg", "登录超时，请重新登录");
            }
        } catch (Exception e) {
            json.put("success", "false");
        }
        return json.toString();
    }

    @RequestMapping(value = "/exportaddrExcel", produces = {"application/json;charset=UTF-8"})
    @CrossOrigin(allowedHeaders = "*", allowCredentials = "true")
    @ResponseBody()
    public String exportaddrExcel(HttpServletResponse response, HttpServletRequest request) throws Exception {

        JSONObject json = new JSONObject();
//        try {
            PageData pd_stoken = new PageData();
            pd_stoken.put("TOKENID", request.getParameter("tokenid"));
            PageData pd_token = zxlbService.findByTokenId(pd_stoken);
            if (pd_token != null) {
                PageData pd = new PageData();
                Page page = new Page();
                URLDecoder urlDecoder = new URLDecoder();
                String starttime = pd.getString("starttime");
                String endtime = pd.getString("endtime");
                String pageIndex = "0";
                String pageSize = "999999999";
                String starttime1 = starttime == null ? "" : urlDecoder.decode(starttime, "utf-8");
                String endtime1 = endtime == null ? "" : urlDecoder.decode(endtime, "utf-8");
                String pageIndex1 = pageIndex == null ? "" : urlDecoder.decode(pageIndex, "utf-8");
                String pageSize1 = pageSize == null ? "" : urlDecoder.decode(pageSize, "utf-8");
                pd.put("starttime", starttime1);
                pd.put("endtime", endtime1);
                pd.put("pageIndex", pageIndex1);
                pd.put("pageSize", pageSize1);
                page.setPd(pd);
                System.out.println(pd);
                List<PageData> clist = jobReferManager.findaddr(pd);
                //创建excel文件
                HSSFWorkbook wb = new HSSFWorkbook();
                //创建sheet页
                HSSFSheet sheet = wb.createSheet("通讯录");
                //创建标题行
                HSSFRow titleRow = sheet.createRow(0);
                titleRow.createCell((short) 0).setCellValue("序号");
                titleRow.createCell((short) 1).setCellValue("办公室");
                titleRow.createCell((short) 2).setCellValue("职责范围");
                titleRow.createCell((short) 3).setCellValue("姓名");
                titleRow.createCell((short) 4).setCellValue("办公电话1");
                titleRow.createCell((short) 5).setCellValue("办公电话2");
                System.out.println(clist);
                if (clist.size() > 0) {


                    int count = 1;
                    for (PageData pd1 : clist) {
                        HSSFRow dataRow = sheet.createRow(sheet.getLastRowNum() + 1);
                        dataRow.createCell((short) 0).setCellValue(count);
                        count++;
                        dataRow.createCell((short) 1).setCellValue(pd1.getString("office"));
                        dataRow.createCell((short) 2).setCellValue(pd1.getString("duty"));
                        dataRow.createCell((short) 3).setCellValue(pd1.getString("name"));
                        dataRow.createCell((short) 4).setCellValue(pd1.getString("tel1"));
                        dataRow.createCell((short) 5).setCellValue(pd1.getString("tel2"));
                    }

                }
                // 设置下载时客户端Excel的名称
                String filename = new SimpleDateFormat("yyyyMMdd").format(new Date()) + "-txl.xls";
                //设置下载的文件
                System.out.println(filename);
                response.setCharacterEncoding("UTF-8");
                response.setContentType("application/vnd.ms-excel");
                response.setHeader("Content-disposition", "attachment;filename=" + filename);
                OutputStream ouputStream = response.getOutputStream();//打开流
                wb.write(ouputStream); //在excel内写入流
                ouputStream.flush();// 刷新流
                ouputStream.close();// 关闭流

            } else {
                json.put("success", "false");
                json.put("msg", "登录超时，请重新登录");
            }

//        } catch (Exception e) {
//            json.put("success", "false");
//        }
        return json.toString();
    }

    //知识库导入
    @RequestMapping(value = "/readdocExcel", produces = {"application/json;charset=UTF-8"})
    @CrossOrigin(allowedHeaders = "*", allowCredentials = "true")
    @ResponseBody()
    public String readdocExcel(@RequestParam(value = "files", required = false) MultipartFile file, HttpServletRequest request) throws Exception {
        PageData pd = new PageData();
        JSONObject json = new JSONObject();
        try {
            PageData pd_stoken = new PageData();
            pd_stoken.put("TOKENID", request.getParameter("tokenid"));
            String createman = request.getParameter("czman");
            String doctype_id = request.getParameter("doctype_id");
            System.out.println(request.getParameter("tokenid"));
            PageData pd_token = zxlbService.findByTokenId(pd_stoken);
        System.out.println("执行了");
            if (pd_token != null) {
                System.out.println(file);
                if (null != file && !file.isEmpty()) {
                    String filePath = PathUtil.getClasspath() + Const.FILEPATHFILE;                                //文件上传路径
                    String fileName = FileUpload.fileUp(file, filePath, "Excel");                            //执行上传
                    List<PageData> listPd = (List) ObjectExcelRead.readExcel(filePath, fileName, 1, 0, 0);        //执行读EXCEL操作,读出的数据导入List 2:从第3行开始；0:从第A列开始；0:第0个sheet

                    /*检查字段操作======================================*/
                    boolean check = true;
                    String str = "";
                    for (int i = 0; i < listPd.size(); i++) {
                        String var0 = listPd.get(i).getString("var0");
                        String var1 = listPd.get(i).getString("var1");
                        String var2 = listPd.get(i).getString("var2");
                        String var3 = listPd.get(i).getString("var3");
                        if ("".equals(var0) || var0 == null) {
                            check = false;
                            str = str + "知识标题不能为空";
                            break;
                        }
                        if ("".equals(var1) || var1 == null) {
                            check = false;
                            str = str + "知识内容不能为空";
                            break;
                        }
                        if ("".equals(var2) || var2 == null) {
                            check = false;
                            str = str + "有效期不能为空";
                            break;
                        }
                        if ("".equals(var3) || var3 == null) {
                            check = false;
                            str = str + "是否热点不能为空";
                            break;
                        }
                        if (doctype_id==null){
                            check = false;
                            str = str + "请先选择知识库分类";
                            break;
                        }
                    }

                    if (check==true){
                        /*存入数据库操作======================================*/
                        for (int i = 0; i < listPd.size(); i++) {
                            pd.put("doctype_id", doctype_id);
                            pd.put("doctitle", listPd.get(i).getString("var0"));
                            pd.put("doccont", listPd.get(i).getString("var1"));
                            pd.put("validate", listPd.get(i).getString("var2"));
                            String var3 = listPd.get(i).getString("var3");
                            String ishot = var3.equals("是") ? "1" : "0";
                            pd.put("ishot", ishot);
                            pd.put("createman",createman);
                            pd.put("createdate",getTime());
                            jobReferManager.importdoc(pd);
                        }
                        json.put("success", "true");
                    } else if (check == false) {
                        json.put("msg", str);
                    }

                }

            } else {
                json.put("success", "false");
                json.put("msg", "登录超时，请重新登录");
            }
        } catch (Exception e) {
            json.put("success", "false");
        }
        return json.toString();
    }
    //短息记录导出
    @RequestMapping(value = "/exportmsglogExcel", produces = {"application/json;charset=UTF-8"})
    @CrossOrigin(allowedHeaders = "*", allowCredentials = "true")
    @ResponseBody()
    public void exportmsglogExcel(HttpServletResponse response, HttpServletRequest request) throws Exception {

        JSONObject json = new JSONObject();
//        try {
            PageData pd_stoken = new PageData();
            pd_stoken.put("TOKENID", request.getParameter("tokenid"));
            PageData pd_token = zxlbService.findByTokenId(pd_stoken);
            if (pd_token != null) {
                PageData pd = new PageData();
                Page page = new Page();
                URLDecoder urlDecoder = new URLDecoder();
                String starttime = pd.getString("starttime");
                String endtime = pd.getString("endtime");
                String sendman = pd.getString("sendman");
                String phone = pd.getString("phone");
                String acceptman = pd.getString("acceptman");
                String keywords = pd.getString("keywords");
                String starttime1 = starttime == null ? "" : urlDecoder.decode(starttime, "utf-8");
                String endtime1 = endtime == null ? "" : urlDecoder.decode(endtime, "utf-8");
                String sendman1 = sendman == null ? "" : urlDecoder.decode(sendman, "utf-8");
                String phone1 = phone == null ? "" : urlDecoder.decode(phone, "utf-8");
                String acceptman1 = acceptman == null ? "" : urlDecoder.decode(acceptman, "utf-8");
                String keywords1 = keywords == null ? "" : urlDecoder.decode(keywords, "utf-8");
                pd.put("starttime", starttime1);
                pd.put("endtime", endtime1);
                pd.put("sendman", sendman1);
                pd.put("phone", phone1);
                pd.put("acceptman", acceptman1);
                pd.put("keywords", keywords1);
                pd.put("pageIndex", 0);
                pd.put("pageSize", 9999);
                page.setPd(pd);
                System.out.println(pd);
                List<PageData> clist = msgTempManager.findMsgLogAll(pd);
                System.out.println(clist);
                //创建excel文件
                HSSFWorkbook wb = new HSSFWorkbook();
                //创建sheet页
                HSSFSheet sheet = wb.createSheet("短信发送记录");
                //创建标题行
                HSSFRow titleRow = sheet.createRow(0);
                titleRow.createCell((short) 0).setCellValue("序号");
                titleRow.createCell((short) 1).setCellValue("发送人");
                titleRow.createCell((short) 2).setCellValue("短信模板");
                titleRow.createCell((short) 3).setCellValue("联系方式");
                titleRow.createCell((short) 4).setCellValue("接受人");
                titleRow.createCell((short) 5).setCellValue("发送时间");
                titleRow.createCell((short) 6).setCellValue("发送方式");
                titleRow.createCell((short) 7).setCellValue("短信内容");
//                titleRow.createCell((short) 5).setCellValue("客户名称");
//                titleRow.createCell((short) 6).setCellValue("客户类别");

                if (clist.size() > 0) {


                    int count = 1;
                    for (PageData pd1 : clist) {
                        HSSFRow dataRow = sheet.createRow(sheet.getLastRowNum() + 1);
                        dataRow.createCell((short) 0).setCellValue(count);
                        count++;
                        dataRow.createCell((short) 1).setCellValue(pd1.getString("sendman"));
                        dataRow.createCell((short) 2).setCellValue(pd1.getString("tempname"));
                        dataRow.createCell((short) 3).setCellValue(pd1.getString("phone"));
                        dataRow.createCell((short) 4).setCellValue(pd1.getString("acceptman"));
                        dataRow.createCell((short) 5).setCellValue(pd1.getString("sendtime"));
                        dataRow.createCell((short) 6).setCellValue(pd1.getString("way"));
                        dataRow.createCell((short) 7).setCellValue(pd1.getString("content"));
//                        dataRow.createCell((short) 5).setCellValue(pd1.getString("clientname"));
//                        dataRow.createCell((short) 6).setCellValue(pd1.getString("clientcate"));
                    }

                }
                // 设置下载时客户端Excel的名称
                String filename = new SimpleDateFormat("yyyyMMddHHmmss").format(new Date()) + "-Messagelog.xls";
                //设置下载的文件
                System.out.println(filename);
                response.setCharacterEncoding("UTF-8");
                response.setContentType("application/vnd.ms-excel");
                response.setHeader("Content-disposition", "attachment;filename=" + filename);
                OutputStream ouputStream = response.getOutputStream();//打开流
                wb.write(ouputStream); //在excel内写入流
                ouputStream.flush();// 刷新流
                ouputStream.close();// 关闭流

            } else {
                json.put("success", "false");
                json.put("msg", "登录超时，请重新登录");
            }

//        } catch (Exception e) {
//            json.put("success", "false");
//        }

    }

    public String getTime() {
        Date date = new Date();
        SimpleDateFormat dateFormat = new SimpleDateFormat("yyyy-MM-dd HH:mm:ss");
        return dateFormat.format(date);
    }



}
